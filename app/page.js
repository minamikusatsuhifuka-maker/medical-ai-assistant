"use client";
import { useState, useRef, useEffect, useCallback } from "react";
import { supabase } from "./lib/supabase";

// === RESPONSIVE HOOK ===
function useResponsive(){
const[w,setW]=useState(1024);
useEffect(()=>{setW(window.innerWidth);const h=()=>setW(window.innerWidth);window.addEventListener("resize",h);return()=>window.removeEventListener("resize",h)},[]);
return{isMobile:w<640,isTablet:w>=640&&w<1024,w};
}

// === COLOR THEME (Mint) ===
const C={p:"#7ba83e",pD:"#567d2a",pDD:"#3d5a1e",pL:"#d4e8b8",pLL:"#f3f9ea",acc:"#a0c96a",w:"#fff",g50:"#fafbf8",g100:"#f0f3ec",g200:"#d8ddd0",g300:"#b8c0ad",g400:"#7a846e",g500:"#555e4a",g700:"#333b28",g900:"#1a1f14",rG:"#6a9e3a",warn:"#e6a817",err:"#d94f4f"};

// === TEMPLATES ===
const T=[
{id:"soap",name:"ðŸ“‹ ASOP",prompt:`ã‚ãªãŸã¯çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã§ã™ã€‚ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚«ãƒ«ãƒ†å½¢å¼ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚

ã€è©±è€…åˆ†é›¢ãƒ«ãƒ¼ãƒ«ã€‘
- ã€Œã§ã™ã€ã€Œã¾ã™ã€ã€Œãã ã•ã„ã€ç­‰ã®ä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«/åŒ»ç™‚å¾“äº‹è€…ã®ç™ºè¨€ã¨åˆ¤æ–­
- ã€Œç—›ã„ã€ã€Œã‹ã‚†ã„ã€ã€Œæ°—ã«ãªã‚‹ã€ã€Œã€œã—ã¦ã»ã—ã„ã€ç­‰ã®è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã®ç™ºè¨€ã¨åˆ¤æ–­
- ã€Œå¡—ã£ã¦ãã ã•ã„ã€ã€Œé£²ã‚“ã§ãã ã•ã„ã€ã¯åŒ»å¸«ã®æŒ‡ç¤º
- ã€Œå¡—ã£ã¦ã„ã¾ã™ã€ã€Œé£²ã‚“ã§ã„ã¾ã™ã€ã¯æ‚£è€…ã®å ±å‘Š
- è¨ºæ–­åãƒ»å‡¦æ–¹ã®æ±ºå®šã¯åŒ»å¸«ã€ç—‡çŠ¶ã®è¨´ãˆã¯æ‚£è€…ã¨ã—ã¦åˆ†é›¢

ã€è¤‡æ•°ç–¾æ‚£ã¸ã®å¯¾å¿œã€‘
- ä¼šè©±ä¸­ã«è¤‡æ•°ã®ç–¾æ‚£ãƒ»ç—‡çŠ¶ãŒè©±é¡Œã«ãªã£ãŸå ´åˆã€ç–¾æ‚£ã”ã¨ã«ASOPã‚’ã¾ã¨ã‚ã‚‹
- å„ç–¾æ‚£ãƒ–ãƒ­ãƒƒã‚¯ã‚’ --- ã§åŒºåˆ‡ã‚‹

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
# ç–¾æ‚£å
Sï¼‰ä¸»è¨´å†…å®¹
Oï¼‰æ‰€è¦‹å†…å®¹
Pï¼‰è¨ˆç”»å†…å®¹
æ‚£è€…æƒ…å ±ï¼‰èƒŒæ™¯ã‚„ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±

ã€è¤‡æ•°ç–¾æ‚£ã®å ´åˆã®ä¾‹ã€‘
# æŽ¥è§¦æ€§çš®è†šç‚Ž
Sï¼‰ä¸¡å‰è…•ã®ç—’ã¿
Oï¼‰ç´…æ–‘æ€§ä¸˜ç–¹ã‚’æ•£åœ¨æ€§ã«èªã‚ã‚‹
Pï¼‰ãƒªãƒ³ãƒ‡ãƒ­ãƒ³-VGè»Ÿè† 1æ—¥2å›ž
---
# è¶³ç™½ç™¬
Sï¼‰è¶³æŒ‡ã®é–“ãŒã‚¸ãƒ¥ã‚¯ã‚¸ãƒ¥ã‚¯ã™ã‚‹
Oï¼‰ç¬¬3-4è¶¾é–“ã«æµ¸è»Ÿãƒ»é±—å±‘
Pï¼‰ãƒ«ãƒªã‚³ãƒ³æ¶² 1æ—¥1å›ž

ã€ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã®åŽ³å¯†ãªãƒ«ãƒ¼ãƒ«ã€‘
- # ã®å¾Œã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹1ã¤ã€ãã®å¾Œã«ç–¾æ‚£åã®ã¿
- Sï¼‰Oï¼‰Pï¼‰æ‚£è€…æƒ…å ±ï¼‰ã®ç›´å¾Œã«å†…å®¹ã‚’ç¶šã‘ã‚‹ï¼ˆæ”¹è¡Œã—ãªã„ï¼‰
- å„è¡Œã®é–“ã«ç©ºè¡Œã‚’å…¥ã‚Œãªã„
- ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ï¼ˆçµå©šå¼ãƒ»æ—…è¡Œç­‰ï¼‰ã¯æ‚£è€…æƒ…å ±ï¼‰ã«è¨˜è¼‰
- ä¼šè©±ã«ãªã„æƒ…å ±ã¯æŽ¨æ¸¬ã—ãªã„
- ä¼šè©±ã«å«ã¾ã‚Œãªã„é …ç›®ã¯å‡ºåŠ›ã—ãªã„ï¼ˆã€Œè¨€åŠãªã—ã€ã¨æ›¸ã‹ãªã„ï¼‰
- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«è©°ã‚ã¦è¨˜è¼‰`},
{id:"disease",name:"ðŸ¥ ç–¾æ‚£å",prompt:`çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦ç–¾æ‚£æƒ…å ±ã‚’æŠ½å‡ºã€‚è©±è€…åˆ†é›¢ï¼šä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«ã€è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
â–  ç–¾æ‚£åï¼ˆæ­£å¼åŒ»å­¦ç”¨èªžã€‚è¤‡æ•°ã‚ã‚Œã°æ”¹è¡Œã§åˆ—æŒ™ï¼‰
â–  éƒ¨ä½
â–  é‡ç—‡åº¦ãƒ»ç¯„å›²
â–  æ—¢å¾€æ­´
â–  é‘‘åˆ¥è¨ºæ–­ï¼ˆåŒ»å¸«ãŒè¨€åŠã—ãŸå ´åˆã®ã¿ï¼‰

ä¿—ç§°ã¯æ­£å¼åç§°ã«å¤‰æ›ï¼ˆæ°´è™«â†’è¶³ç™½ç™¬ã€ãƒ‹ã‚­ãƒ“â†’ã–ç˜¡ï¼‰ã€‚æŽ¨æ¸¬ã—ãªã„ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚`},
{id:"cosmetic",name:"âœ¨ ç¾Žå®¹",prompt:`ç¾Žå®¹çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦æ–½è¡“è¨˜éŒ²ã‚’è¦ç´„ã€‚è©±è€…åˆ†é›¢ï¼šä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«ã€è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
â–  æ–½è¡“å
â–  æ–½è¡“éƒ¨ä½
â–  æ‚£è€…ã®å¸Œæœ›ãƒ»ä¸»è¨´
â–  æ–½è¡“å†…å®¹ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
â–  ä½¿ç”¨è–¬å‰¤ãƒ»æ©Ÿå™¨
â–  æ–½è¡“å¾Œæ³¨æ„äº‹é …
â–  æ¬¡å›žäºˆå®š
â–  æ‚£è€…æƒ…å ±ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç­‰ï¼‰

æ–½è¡“æ©Ÿå™¨åã¯æ­£å¼åç§°ï¼ˆãƒŽãƒ¼ãƒªã‚¹ã€ãƒãƒ†ãƒ³ãƒ„ã‚¡ã€ãƒ¡ã‚½ãƒŠJã€MIINãƒ¬ãƒ¼ã‚¶ãƒ¼ã€AGNESï¼‰ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚`},
{id:"procedure",name:"ðŸ”§ å‡¦ç½®",prompt:`çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦å‡¦ç½®è¨˜éŒ²ã‚’è¦ç´„ã€‚è©±è€…åˆ†é›¢ï¼šä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«ã€è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
â–  å‡¦ç½®å
â–  éƒ¨ä½ãƒ»ç¯„å›²
â–  éº»é…”ï¼ˆç¨®é¡žãƒ»é‡ï¼‰
â–  å‡¦ç½®å†…å®¹ï¼ˆæ™‚ç³»åˆ—ï¼‰
â–  ä½¿ç”¨å™¨å…·ãƒ»ææ–™
â–  æ¤œä½“æå‡º
â–  è¡“å¾ŒæŒ‡ç¤ºãƒ»å‡¦æ–¹
â–  æ¬¡å›žäºˆå®š

ã‚µã‚¤ã‚ºmmã€é‡mL/gã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚`},
{id:"followup",name:"ðŸ”„ çµŒéŽ",prompt:`çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦çµŒéŽè¨˜éŒ²ã‚’è¦ç´„ã€‚è©±è€…åˆ†é›¢ï¼šä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«ã€è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã€‚è¤‡æ•°ç–¾æ‚£ãŒã‚ã‚Œã°ç–¾æ‚£ã”ã¨ã«ã¾ã¨ã‚ã€---ã§åŒºåˆ‡ã‚‹ã€‚

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆåŽ³å®ˆï¼‰ã€‘
â–  ç–¾æ‚£å
â–  å‰å›žã‹ã‚‰ã®çµŒéŽ
â–  ç¾åœ¨ã®ç—‡çŠ¶ï¼ˆæ‚£è€…ï¼‰
â–  ç¾åœ¨ã®æ‰€è¦‹ï¼ˆåŒ»å¸«ï¼‰
â–  æ²»ç™‚åŠ¹æžœåˆ¤å®šï¼ˆæ”¹å–„/ä¸å¤‰/æ‚ªåŒ–ï¼‰
â–  ä»Šå¾Œã®æ–¹é‡
â–  æ¬¡å›žäºˆå®š

å‰å›žæ¯”è¼ƒã‚’æ˜Žç¢ºã«ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚`},
{id:"free",name:"ðŸ“ ãƒ•ãƒªãƒ¼",prompt:`çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦ç°¡æ½”ã«è¦ç´„ã€‚è©±è€…åˆ†é›¢ï¼šä¸å¯§èªžãƒ»æŒ‡ç¤ºèªžã¯åŒ»å¸«ã€è¨´ãˆãƒ»å¸Œæœ›ã¯æ‚£è€…ã€‚åŒ»å­¦ç”¨èªžã¯æ­£å¼åç§°ã€‚æ™‚ç³»åˆ—ã§æ•´ç†ã€‚æŽ¨æ¸¬ã—ãªã„ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚`}
];

const R=[{id:"r1",l:"è¨ºå¯Ÿå®¤1",i:"1"},{id:"r2",l:"è¨ºå¯Ÿå®¤2",i:"2"},{id:"r3",l:"è¨ºå¯Ÿå®¤3",i:"3"},{id:"r4",l:"æ–½è¡“å®¤1",i:"â‘ "},{id:"r5",l:"æ–½è¡“å®¤2",i:"â‘¡"},{id:"r6",l:"æ–½è¡“å®¤3",i:"â‘¢"},{id:"r7",l:"ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°",i:"ðŸ’¬"}];

const DEFAULT_SHORTCUTS=[
{id:"rec",label:"ðŸŽ™ éŒ²éŸ³é–‹å§‹/åœæ­¢",key:"F1",enabled:true,showOnTop:true},
{id:"sum",label:"âœ“ è¦ç´„",key:"F2",enabled:true,showOnTop:true},
{id:"clear",label:"ðŸ—‘ ã‚¯ãƒªã‚¢",key:"F3",enabled:true,showOnTop:false},
{id:"next",label:"â–¶ æ¬¡ã¸",key:"F4",enabled:true,showOnTop:true},
{id:"copy",label:"ðŸ“‹ ã‚³ãƒ”ãƒ¼",key:"F5",enabled:true,showOnTop:false},
{id:"pip",label:"ðŸŒŸ å°çª“",key:"F6",enabled:true,showOnTop:false},
{id:"doc",label:"ðŸ“„ è³‡æ–™ä½œæˆ",key:"F7",enabled:true,showOnTop:false},
{id:"counsel",label:"ðŸ§  åˆ†æž",key:"F8",enabled:true,showOnTop:false},
{id:"undo",label:"â†© å…ƒã«æˆ»ã™",key:"Ctrl+Z",enabled:true,showOnTop:false},
{id:"room1",label:"è¨ºå¯Ÿå®¤1",key:"Ctrl+1",enabled:true,showOnTop:false},
{id:"room2",label:"è¨ºå¯Ÿå®¤2",key:"Ctrl+2",enabled:true,showOnTop:false},
{id:"room3",label:"è¨ºå¯Ÿå®¤3",key:"Ctrl+3",enabled:true,showOnTop:false},
{id:"room4",label:"æ–½è¡“å®¤1",key:"Ctrl+4",enabled:true,showOnTop:false},
{id:"room5",label:"æ–½è¡“å®¤2",key:"Ctrl+5",enabled:true,showOnTop:false},
{id:"room6",label:"æ–½è¡“å®¤3",key:"Ctrl+6",enabled:true,showOnTop:false},
{id:"room7",label:"ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°",key:"Ctrl+7",enabled:true,showOnTop:false},
];

const DEFAULT_DICT=[
["ã‚Šã‚“ã§ã‚ã‚“","ãƒªãƒ³ãƒ‡ãƒ­ãƒ³"],["ãƒªãƒ³ãƒ‡ãƒ­ãƒ³VG","ãƒªãƒ³ãƒ‡ãƒ­ãƒ³-VG"],["ã‚Šã‚“ã§ã‚ã‚“ã¶ã„ã˜ãƒ¼","ãƒªãƒ³ãƒ‡ãƒ­ãƒ³-VG"],["ã‚¢ãƒ³ãƒ†ãƒ™ãƒ¼ãƒˆ","ã‚¢ãƒ³ãƒ†ãƒ™ãƒ¼ãƒˆ"],["ã§ã‚‹ã‚‚ã¹ãƒ¼ã¨","ãƒ‡ãƒ«ãƒ¢ãƒ™ãƒ¼ãƒˆ"],["ãƒ­ã‚³ã‚¤ãƒ‰","ãƒ­ã‚³ã‚¤ãƒ‰"],["ãƒ—ãƒ­ãƒˆãƒ”ãƒƒã‚¯","ãƒ—ãƒ­ãƒˆãƒ”ãƒƒã‚¯"],["ã‚­ãƒ³ãƒ€ãƒ™ãƒ¼ãƒˆ","ã‚­ãƒ³ãƒ€ãƒ™ãƒ¼ãƒˆ"],["ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰","ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰"],["ã²ã‚‹ã©ã„ã©","ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰"],["ãƒ—ãƒ­ãƒšãƒˆ","ãƒ—ãƒ­ãƒšãƒˆ"],
["ã‚¢ã‚¯ã‚¢ãƒãƒ ","ã‚¢ã‚¯ã‚¢ãƒãƒ ã‚¯ãƒªãƒ¼ãƒ "],["ãƒ€ãƒ©ã‚·ãƒ³","ãƒ€ãƒ©ã‚·ãƒ³Tã‚²ãƒ«"],["ã‚¼ãƒ“ã‚¢ãƒƒã‚¯ã‚¹","ã‚¼ãƒ“ã‚¢ãƒƒã‚¯ã‚¹ãƒ­ãƒ¼ã‚·ãƒ§ãƒ³"],["ãƒ‡ãƒ¥ã‚¢ãƒƒã‚¯","ãƒ‡ãƒ¥ã‚¢ãƒƒã‚¯é…åˆã‚²ãƒ«"],["ã¹ãƒ”ã‚ª","ãƒ™ãƒ”ã‚ªã‚²ãƒ«"],["ã‚¨ãƒ”ãƒ‡ãƒ¥ã‚ª","ã‚¨ãƒ”ãƒ‡ãƒ¥ã‚ªã‚²ãƒ«"],["ãƒ‡ã‚£ãƒ•ã‚§ãƒªãƒ³","ãƒ‡ã‚£ãƒ•ã‚§ãƒªãƒ³ã‚²ãƒ«"],["ã‚¢ãƒ€ãƒ‘ãƒ¬ãƒ³","ã‚¢ãƒ€ãƒ‘ãƒ¬ãƒ³"],
["ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³","ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³"],["ã„ãã¨ã‚Œã¡ã®ã„ã‚“","ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³"],["ãƒˆãƒ©ãƒã‚­ã‚µãƒ é…¸","ãƒˆãƒ©ãƒã‚­ã‚µãƒ é…¸"],["ã¨ã‚‰ã­ãã•ã‚€ã•ã‚“","ãƒˆãƒ©ãƒã‚­ã‚µãƒ é…¸"],["ãƒã‚¤ãƒ‰ãƒ­ã‚­ãƒŽãƒ³","ãƒã‚¤ãƒ‰ãƒ­ã‚­ãƒŽãƒ³"],["ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³","ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³"],
["ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆ","ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆ"],["ã§ã‚…ã´ãã›ã‚“ã¨","ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆ"],["ãƒŸãƒãƒ¼ã‚¬","ãƒŸãƒãƒ¼ã‚¬"],["ã‚ªãƒ«ãƒŸã‚¨ãƒ³ãƒˆ","ã‚ªãƒ«ãƒŸã‚¨ãƒ³ãƒˆ"],["ãƒªãƒ³ãƒ´ã‚©ãƒƒã‚¯","ãƒªãƒ³ãƒ´ã‚©ãƒƒã‚¯"],["ã‚µã‚¤ãƒã‚¤ãƒ³ã‚³","ã‚µã‚¤ãƒã‚¤ãƒ³ã‚³"],["ã‚³ãƒ¬ã‚¯ãƒãƒ ","ã‚³ãƒ¬ã‚¯ãƒãƒ è»Ÿè†"],["ãƒ¢ã‚¤ã‚¼ãƒ«ãƒˆ","ãƒ¢ã‚¤ã‚¼ãƒ«ãƒˆè»Ÿè†"],
["ãƒ«ãƒŸã‚»ãƒ•","ãƒ«ãƒŸã‚»ãƒ•"],["ã‚³ã‚»ãƒ³ãƒ†ã‚£ã‚¯ã‚¹","ã‚³ã‚»ãƒ³ãƒ†ã‚£ã‚¯ã‚¹"],["ã‚¹ã‚­ãƒªãƒ¼ã‚¸","ã‚¹ã‚­ãƒªãƒ¼ã‚¸"],["ãƒˆãƒ«ãƒ„","ãƒˆãƒ«ãƒ„"],["ã‚ªãƒ†ã‚ºãƒ©","ã‚ªãƒ†ã‚ºãƒ©"],["ã‚½ãƒ¼ãƒ†ã‚£ã‚¯ãƒ„","ã‚½ãƒ¼ãƒ†ã‚£ã‚¯ãƒ„"],
["ã‚¾ãƒ¬ã‚¢","ã‚¾ãƒ¬ã‚¢"],["ãƒ“ãƒ©ãƒŽã‚¢","ãƒ“ãƒ©ãƒŽã‚¢"],["ãƒ‡ã‚¶ãƒ¬ãƒƒã‚¯ã‚¹","ãƒ‡ã‚¶ãƒ¬ãƒƒã‚¯ã‚¹"],["ãƒ«ãƒ‘ãƒ•ã‚£ãƒ³","ãƒ«ãƒ‘ãƒ•ã‚£ãƒ³"],["ã‚¢ãƒ¬ã‚°ãƒ©","ã‚¢ãƒ¬ã‚°ãƒ©"],
["ã‚ã¨ã´ãƒ¼","ã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Ž"],["ã‹ã‚“ã›ã‚“","ä¹¾ç™¬"],["ã˜ã‚“ã¾ã—ã‚“","è•éº»ç–¹"],["ãŸã„ã˜ã‚‡ã†ã»ã†ã—ã‚“","å¸¯çŠ¶ç–±ç–¹"],["ã¯ãã›ã‚“","ç™½ç™¬"],["ãµã‚“ã‚Šã‚…ã†","ç²‰ç˜¤"],["ã—ã‚ã†ã›ã„","è„‚æ¼æ€§çš®è†šç‚Ž"],["ã—ã‚…ã•","é…’ã•"],["ã»ã†ã‹ã—ããˆã‚“","èœ‚çª©ç¹”ç‚Ž"],["ã¨ã³ã²","ä¼æŸ“æ€§è†¿ç—‚ç–¹"],["ã«ãã³","ã–ç˜¡"],["ãƒ‹ã‚­ãƒ“","ã–ç˜¡"],["ã‹ã‚“ã±ã‚“","è‚æ–‘"],["ãã°ã‹ã™","é›€åµæ–‘"],
["ãƒŽãƒ¼ãƒªã‚¹","ãƒŽãƒ¼ãƒªã‚¹ï¼ˆIPLå…‰æ²»ç™‚ï¼‰"],["ã®ãƒ¼ã‚Šã™","ãƒŽãƒ¼ãƒªã‚¹ï¼ˆIPLå…‰æ²»ç™‚ï¼‰"],["ãƒãƒ†ãƒ³ãƒ„ã‚¡","ãƒãƒ†ãƒ³ãƒ„ã‚¡"],["ã½ã¦ã‚“ã¤ã","ãƒãƒ†ãƒ³ãƒ„ã‚¡"],["ã‚¸ãƒ¥ãƒ™ãƒ«ãƒƒã‚¯","ã‚¸ãƒ¥ãƒ™ãƒ«ãƒƒã‚¯"],["ã˜ã‚…ã¹ã‚‹ã£ã","ã‚¸ãƒ¥ãƒ™ãƒ«ãƒƒã‚¯"],["ãƒ¡ã‚½ãƒŠJ","ãƒ¡ã‚½ãƒŠJ"],["ã‚ããª","ãƒ¡ã‚½ãƒŠJ"],["AGNES","AGNES"],["ã‚ãã­ã™","AGNES"],["MIIN","MIINãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ã¿ã„ã‚“","MIINãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ç¾Žäººãƒ¬ãƒ¼ã‚¶ãƒ¼","MIINãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ã‚µãƒªãƒãƒ«é…¸ãƒžã‚¯ãƒ­ã‚´ãƒ¼ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°","ã‚µãƒªãƒãƒ«é…¸ãƒžã‚¯ãƒ­ã‚´ãƒ¼ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°"],["ãƒžãƒƒã‚µãƒ¼ã‚¸ãƒ”ãƒ¼ãƒ«","ãƒžãƒƒã‚µãƒ¼ã‚¸ãƒ”ãƒ¼ãƒ«"],["ãƒªãƒãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ«","ãƒªãƒãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ«"],
["ã‚¼ã‚ªã‚¹ã‚­ãƒ³","ã‚¼ã‚ªã‚¹ã‚­ãƒ³ãƒ˜ãƒ«ã‚¹"],["ãœãŠã™ãã‚“","ã‚¼ã‚ªã‚¹ã‚­ãƒ³ãƒ˜ãƒ«ã‚¹"],["ãƒŸãƒ©ãƒŸãƒ³","ãƒŸãƒ©ãƒŸãƒ³"],["ãƒŸãƒ©ãƒŸãƒƒã‚¯ã‚¹","ãƒŸãƒ©ãƒŸãƒƒã‚¯ã‚¹"],
["ã‚«ãƒ¬ã‚·ãƒ ","ã‚«ãƒ¬ã‚·ãƒ ç¾Žå®¹æ¶²"],["ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ¼ãƒ³","ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ¼ãƒ³"],["ã©ã‚ã£ã·ã™ãã‚Šãƒ¼ã‚“","ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ¼ãƒ³"],
["ãˆãƒ¼ã˜ãƒ¼ãˆãƒ¼","AGAï¼ˆç”·æ€§åž‹è„±æ¯›ç—‡ï¼‰"],["ã‚¨ã‚­ã‚·ãƒž","ã‚¨ã‚­ã‚·ãƒžãƒ©ã‚¤ãƒˆ"],["ãƒŠãƒ­ãƒ¼ãƒãƒ³ãƒ‰","ãƒŠãƒ­ãƒ¼ãƒãƒ³ãƒ‰UVB"],
["æ¶²ä½“çª’ç´ ","æ¶²ä½“çª’ç´ å‡çµç™‚æ³•"],["ãˆããŸã„ã¡ã£ã","æ¶²ä½“çª’ç´ å‡çµç™‚æ³•"],["ç”Ÿæ¤œ","çš®è†šç”Ÿæ¤œ"],["ã›ã„ã‘ã‚“","çš®è†šç”Ÿæ¤œ"],
["ã²ã‚‹ã¾ã„ã©","ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰"],["ã²ã‚‹ã¾ã„ã©ãƒ­ãƒ¼ã‚·ãƒ§ãƒ³","ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰ãƒ­ãƒ¼ã‚·ãƒ§ãƒ³"],["ã§ã‚…ã´ãã›ã‚“ã¨","ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆ"],["ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆæ³¨å°„","ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆçš®ä¸‹æ³¨"],["ãŠã¦ãšã‚‰","ã‚ªãƒ†ã‚ºãƒ©"],
["ã˜ã‡ã‚“ã¨ã‚‹ã¾ã£ãã™","ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒžãƒƒã‚¯ã‚¹ãƒ—ãƒ­ãƒ—ãƒ©ã‚¹"],["ã˜ã‡ã‚“ã¨ã‚‹","ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒžãƒƒã‚¯ã‚¹ãƒ—ãƒ­ãƒ—ãƒ©ã‚¹"],["ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒžãƒƒã‚¯ã‚¹","ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒžãƒƒã‚¯ã‚¹ãƒ—ãƒ­ãƒ—ãƒ©ã‚¹"],
["ãƒˆãƒ©ã‚¤ãƒ•ã‚£ãƒ«","ãƒˆãƒ©ã‚¤ãƒ•ã‚£ãƒ«ãƒ—ãƒ­"],["ã¨ã‚‰ã„ãµãƒã‚‹","ãƒˆãƒ©ã‚¤ãƒ•ã‚£ãƒ«ãƒ—ãƒ­"],["ã‚­ãƒ¥ã‚¢ã‚¸ã‚§ãƒƒãƒˆ","ã‚­ãƒ¥ã‚¢ã‚¸ã‚§ãƒƒãƒˆ"],["ãã‚…ã‚ã˜ã‡ã£ã¨","ã‚­ãƒ¥ã‚¢ã‚¸ã‚§ãƒƒãƒˆ"],
["ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¯ãƒ¼ãƒ«","ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¯ãƒ¼ãƒ«"],["ãŸãƒ¼ã’ã£ã¨ããƒ¼ã‚‹","ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¯ãƒ¼ãƒ«"],["ãƒ–ãƒ«ãƒ¼ãƒ¬ãƒ¼ã‚¶ãƒ¼","ãƒ–ãƒ«ãƒ¼ãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ã¶ã‚‹ãƒ¼ã‚Œãƒ¼ã–ãƒ¼","ãƒ–ãƒ«ãƒ¼ãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ãƒ—ãƒ©ã‚ºãƒžãƒšãƒ³","ãƒ—ãƒ©ã‚ºãƒžãƒšãƒ³"],["ã·ã‚‰ãšã¾ãºã‚“","ãƒ—ãƒ©ã‚ºãƒžãƒšãƒ³"],
["ã‚¹ã‚­ãƒ³ãƒžãƒªã‚¢","ã‚¹ã‚­ãƒ³ãƒžãƒªã‚¢"],["ã™ãã‚“ã¾ã‚Šã‚","ã‚¹ã‚­ãƒ³ãƒžãƒªã‚¢"],
["ã‚ã–ãã‚Šã‚","AZAã‚¯ãƒªã‚¢ã‚¯ãƒªãƒ¼ãƒ "],["AZAã‚¯ãƒªã‚¢","AZAã‚¯ãƒªã‚¢ã‚¯ãƒªãƒ¼ãƒ "],
["ã‚¹ã‚­ãƒ³ãƒ”ãƒ¼ãƒ«ãƒãƒ¼","ã‚¹ã‚­ãƒ³ãƒ”ãƒ¼ãƒ«ãƒãƒ¼"],["ã™ãã‚“ã´ãƒ¼ã‚‹ã°ãƒ¼","ã‚¹ã‚­ãƒ³ãƒ”ãƒ¼ãƒ«ãƒãƒ¼"],
["ãƒŠãƒ‡ã‚£ã‚«ãƒ«","ãƒŠãƒ‡ã‚£ã‚«ãƒ«ãƒ•ã‚§ã‚¤ã‚¹ãƒ­ãƒ¼ã‚·ãƒ§ãƒ³"],["ãªã§ãƒã‹ã‚‹","ãƒŠãƒ‡ã‚£ã‚«ãƒ«ãƒ•ã‚§ã‚¤ã‚¹ãƒ­ãƒ¼ã‚·ãƒ§ãƒ³"],
["ãˆã™ãˆãƒ¼ã—ãƒ¼","S-ACã‚¯ãƒªãƒ¼ãƒ "],["SAC","S-ACã‚¯ãƒªãƒ¼ãƒ "],
["ã‚¹ãƒ†ãƒ ã‚¢ãƒ‰ãƒãƒ³ã‚¹","DRXã‚¹ãƒ†ãƒ ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚»ãƒ©ãƒ "],["ã™ã¦ã‚€ã‚ã©ã°ã‚“ã™","DRXã‚¹ãƒ†ãƒ ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚»ãƒ©ãƒ "],
["ãƒ‡ã‚¤ãƒªãƒ¼PD","ãƒ‡ã‚¤ãƒªãƒ¼PD"],["ã§ã„ã‚Šãƒ¼ã´ãƒ¼ã§ãƒãƒ¼","ãƒ‡ã‚¤ãƒªãƒ¼PD"],
["ãƒãƒ©ãƒ³ã‚µãƒ¼ãƒˆãƒŠãƒ¼","ãƒãƒ©ãƒ³ã‚µãƒ¼ãƒˆãƒŠãƒ¼"],["ã°ã‚‰ã‚“ã•ãƒ¼ã¨ãªãƒ¼","ãƒãƒ©ãƒ³ã‚µãƒ¼ãƒˆãƒŠãƒ¼"],
["ãƒªãƒãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ«","ãƒªãƒãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ«"],["ã‚Šã°ãƒ¼ã™ã´ãƒ¼ã‚‹","ãƒªãƒãƒ¼ã‚¹ãƒ”ãƒ¼ãƒ«"],
["ã¼ã¨ã£ãã™","ãƒœãƒˆãƒƒã‚¯ã‚¹"],["ãƒœãƒˆãƒƒã‚¯ã‚¹æ³¨å°„","ãƒœãƒˆãƒƒã‚¯ã‚¹æ³¨"],["ã²ã‚ã‚‹ã‚ã‚“ã•ã‚“","ãƒ’ã‚¢ãƒ«ãƒ­ãƒ³é…¸"],["ãƒ’ã‚¢ãƒ«ãƒ­ãƒ³é…¸æ³¨å…¥","ãƒ’ã‚¢ãƒ«ãƒ­ãƒ³é…¸æ³¨å…¥"],
["ã—ã¿ã¨ã‚Š","ã‚·ãƒŸå–ã‚Šãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ã»ãã‚ã¨ã‚Š","ãƒ›ã‚¯ãƒ­é™¤åŽ»"],
["ã ãƒ¼ã¾ãºã‚“","ãƒ€ãƒ¼ãƒžãƒšãƒ³"],["ãƒ€ãƒ¼ãƒžãƒšãƒ³","ãƒ€ãƒ¼ãƒžãƒšãƒ³4"],
["ã†ã‚‹ã›ã‚‰","ã‚¦ãƒ«ã‚»ãƒ©"],["ãƒã‚¤ãƒ•","HIFU"],["ã¯ã„ãµ","HIFU"],
["ã—ãƒ¼ãŠãƒ¼ã¤ãƒ¼ã‚Œãƒ¼ã–ãƒ¼","CO2ãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ç‚­é…¸ã‚¬ã‚¹ãƒ¬ãƒ¼ã‚¶ãƒ¼","CO2ãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ã¦ã„ã‚Œãƒ¼ã–ãƒ¼","Tå­—ãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«","ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ãµã‚‰ãã—ã‚‡ãªã‚‹","ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ã‚±ãƒŸã‚«ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°","ã‚±ãƒŸã‚«ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°"],["ã‘ã¿ã‹ã‚‹ã´ãƒ¼ã‚Šã‚“ã","ã‚±ãƒŸã‚«ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°"],
["ã„ãŠã‚“ã¨ãµã‰ã‚Œãƒ¼ã—ã™","ã‚¤ã‚ªãƒ³ãƒˆãƒ•ã‚©ãƒ¬ãƒ¼ã‚·ã‚¹"],["ã‚¤ã‚ªãƒ³å°Žå…¥","ã‚¤ã‚ªãƒ³ãƒˆãƒ•ã‚©ãƒ¬ãƒ¼ã‚·ã‚¹"],
["ãˆã‚Œãã¨ã‚ã½ã‚Œãƒ¼ã—ã‚‡ã‚“","ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"],["é›»æ°—ç©¿å­”æ³•","ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"],
["ã´ã“ã‚Œãƒ¼ã–ãƒ¼","ãƒ”ã‚³ãƒ¬ãƒ¼ã‚¶ãƒ¼"],["ã´ã“ã¨ãƒ¼ã«ã‚“ã","ãƒ”ã‚³ãƒˆãƒ¼ãƒ‹ãƒ³ã‚°"],
["ãã‚…ãƒ¼ã™ã„ã£ã¡","Qã‚¹ã‚¤ãƒƒãƒãƒ¬ãƒ¼ã‚¶ãƒ¼"],["Qã‚¹ã‚¤ãƒƒãƒ","Qã‚¹ã‚¤ãƒƒãƒãƒ¬ãƒ¼ã‚¶ãƒ¼"],
["ã³ãŸã¿ã‚“ã—ãƒ¼","ãƒ“ã‚¿ãƒŸãƒ³Cèª˜å°Žä½“"],["ã³ãŸã¿ã‚“C","ãƒ“ã‚¿ãƒŸãƒ³Cèª˜å°Žä½“"],
["ã‚Œã¡ã®ãƒ¼ã‚‹","ãƒ¬ãƒãƒŽãƒ¼ãƒ«"],["ã›ã‚‰ã¿ã©","ã‚»ãƒ©ãƒŸãƒ‰"],["ãªã„ã‚ã—ã‚“ã‚ã¿ã©","ãƒŠã‚¤ã‚¢ã‚·ãƒ³ã‚¢ãƒŸãƒ‰"],
["ã‚Šã©ã‹ã„ã‚“","ãƒªãƒ‰ã‚«ã‚¤ãƒ³"],["ãã—ã‚ã‹ã„ã‚“","ã‚­ã‚·ãƒ­ã‚«ã‚¤ãƒ³"],["ãƒšãƒ³ãƒ¬ã‚¹","ãƒšãƒ³ãƒ¬ã‚¹ãƒ†ãƒ¼ãƒ—"],["ãºã‚“ã‚Œã™","ãƒšãƒ³ãƒ¬ã‚¹ãƒ†ãƒ¼ãƒ—"],["ã‚¨ãƒ ãƒ©","ã‚¨ãƒ ãƒ©ã‚¯ãƒªãƒ¼ãƒ "],["ãˆã‚€ã‚‰","ã‚¨ãƒ ãƒ©ã‚¯ãƒªãƒ¼ãƒ "],
["SPF","SPF"],["ã´ãƒ¼ãˆãƒ¼","PA"],
["ã‚Šã‚‡ã†ã›ã„ã—ã‚…ã‚ˆã†","è‰¯æ€§è…«ç˜"],["ã‚ãã›ã„ã—ã‚…ã‚ˆã†","æ‚ªæ€§è…«ç˜"],["ãã¦ã„ã•ã„ã¼ã†ãŒã‚“","åŸºåº•ç´°èƒžç™Œ"],["ã‚†ã†ãã‚‡ãã•ã„ã¼ã†ãŒã‚“","æœ‰æ£˜ç´°èƒžç™Œ"],["ã‚ãã›ã„ã“ãã—ã‚‡ãã—ã‚…","æ‚ªæ€§é»’è‰²è…«"],["ãƒ¡ãƒ©ãƒŽãƒ¼ãƒž","æ‚ªæ€§é»’è‰²è…«"],["ã‚ã‚‰ã®ãƒ¼ã¾","æ‚ªæ€§é»’è‰²è…«"],
["ã‘ã‚ã„ã©","ã‚±ãƒ­ã‚¤ãƒ‰"],["ã²ã“ã†ã›ã„ã¯ã‚“ã“ã‚“","è‚¥åŽšæ€§ç˜¢ç—•"],
["ãŸã ","ãŸã ã‚Œï¼ˆã³ã‚‰ã‚“ï¼‰"],["ã³ã‚‰ã‚“","ã³ã‚‰ã‚“"],
["ã»ã£ã—ã‚“","ç™ºç–¹"],["ã“ã†ã¯ã‚“","ç´…æ–‘"],["ãã‚…ã†ã—ã‚“","ä¸˜ç–¹"],["ã™ã„ã»ã†","æ°´ç–±"],["ã®ã†ã»ã†","è†¿ç–±"],["ã‚Šã‚“ã›ã¤","é±—å±‘"],["ã‹ã²","ç—‚çš®"],
["ã‚ã¨ã´ãƒ¼","ã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Ž"],["ã‚ã¨ã´ãƒ¼ã›ã„ã²ãµãˆã‚“","ã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Ž"],["ã—ã‚ã›ã„ã²ãµãˆã‚“","è„‚æ¼æ€§çš®è†šç‚Ž"],["ã—ã‚ã›ã„","è„‚æ¼æ€§"],
["ã˜ã‚“ã¾ã—ã‚“","è•éº»ç–¹"],["ã˜ã‚“ã¾ã—ã‚“","è•éº»ç–¹"],["ã‹ã‚“ã±ã‚“","è‚æ–‘"],["ãã°ã‹ã™","é›€åµæ–‘"],
["ãŸã„ã˜ã‚‡ã†ã»ã†ã—ã‚“","å¸¯çŠ¶ç–±ç–¹"],["ãŸã„ã˜ã‚‡ã†","å¸¯çŠ¶ç–±ç–¹"],["ãƒ˜ãƒ«ãƒšã‚¹","å˜ç´”ãƒ˜ãƒ«ãƒšã‚¹"],["ã¸ã‚‹ãºã™","å˜ç´”ãƒ˜ãƒ«ãƒšã‚¹"],
["ã¿ãšã¼ã†ãã†","æ°´ç—˜"],["ã¨ã³ã²","ä¼æŸ“æ€§è†¿ç—‚ç–¹"],["ã¿ãšã„ã¼","ä¼æŸ“æ€§è»Ÿå±žè…«"],
["ã«ãã³","ã–ç˜¡"],["ãƒ‹ã‚­ãƒ“","ã–ç˜¡"],["ã«ãã³ã‚ã¨","ã–ç˜¡ç˜¢ç—•"],["ãƒ‹ã‚­ãƒ“è·¡","ã–ç˜¡ç˜¢ç—•"],["ã«ãã³ç—•","ã–ç˜¡ç˜¢ç—•"],
["ã—ã‚…ã•","é…’ã•"],["ã—ã‚…ã•ã‚ˆã†ã²ãµãˆã‚“","é…’ã•æ§˜çš®è†šç‚Ž"],["ãã¡ã¾ã‚ã‚Šã²ãµãˆã‚“","å£å›²çš®è†šç‚Ž"],
["ã‹ã‚“ã›ã‚“","ä¹¾ç™¬"],["ã˜ã‚‡ã†ã˜ã‚‡ã†ã›ã„ã‹ã‚“ã›ã‚“","å°‹å¸¸æ€§ä¹¾ç™¬"],["ã¦ãã˜ã‚‡ã†","æ»´çŠ¶ä¹¾ç™¬"],
["ã—ã‚‡ã†ã›ãã®ã†ã»ã†ã—ã‚‡ã†","æŽŒè¹ è†¿ç–±ç—‡"],["ã—ã‚‡ã†ã›ã","æŽŒè¹ è†¿ç–±ç—‡"],
["ãˆã‚“ã‘ã„ã ã¤ã‚‚ã†ã—ã‚‡ã†","å††å½¢è„±æ¯›ç—‡"],["ã ã¤ã‚‚ã†ã—ã‚‡ã†","è„±æ¯›ç—‡"],["AGA","ç”·æ€§åž‹è„±æ¯›ç—‡"],
["ã¯ãã¯ã‚“","ç™½æ–‘"],["ã˜ã‚“ã˜ã‚‡ã†ã›ã„ã¯ãã¯ã‚“","å°‹å¸¸æ€§ç™½æ–‘"],
["ã—ã¿","è‰²ç´ æ²ˆç€"],["ãã™ã¿","è‰²ç´ æ²ˆç€"],["ã»ãã‚","è‰²ç´ æ€§æ¯æ–‘"],["ã‚ã–","æ¯æ–‘"],
["ã„ã¼","ç–£è´…"],["ã˜ã‚“ã˜ã‚‡ã†ã›ã„ã‚†ã†ãœã„","å°‹å¸¸æ€§ç–£è´…"],["ã‚¦ã‚¤ãƒ«ã‚¹æ€§ã‚¤ãƒœ","ã‚¦ã‚¤ãƒ«ã‚¹æ€§ç–£è´…"],
["ãµã‚“ã‚Šã‚…ã†","ç²‰ç˜¤ï¼ˆã‚¢ãƒ†ãƒ­ãƒ¼ãƒ ï¼‰"],["ã‚ã¦ã‚ãƒ¼ã‚€","ç²‰ç˜¤ï¼ˆã‚¢ãƒ†ãƒ­ãƒ¼ãƒ ï¼‰"],["ã²ã®ã†ã»ã†","çš®è†šåš¢è…«"],
["ãŸã“","èƒ¼èƒ"],["ã†ãŠã®ã‚","é¶çœ¼"],["ã¹ã‚“ã¡","èƒ¼èƒ"],["ã‘ã„ãŒã‚“","é¶çœ¼"],
["ã¾ãã¥ã‚","å·»ãçˆª"],["ã‹ã‚“ã«ã‚…ã†ãã†","é™¥å…¥çˆª"],
["ã¿ãšã‚€ã—","è¶³ç™½ç™¬"],["ãŸã‚€ã—","ä½“éƒ¨ç™½ç™¬"],["ã„ã‚“ãã‚“ãŸã‚€ã—","è‚¡éƒ¨ç™½ç™¬"],["ã¤ã‚ã¿ãšã‚€ã—","çˆªç™½ç™¬"],
["ã²ãµã‹","çš®è†šç§‘"],["ã³ã‚ˆã†ã²ãµã‹","ç¾Žå®¹çš®è†šç§‘"],
["ã™ã¦ã‚ã„ã©","ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰å¤–ç”¨è–¬"],["ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰","ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰å¤–ç”¨è–¬"],
["ã§ã‚‹ã‚‚ã¹ãƒ¼ã¨","ãƒ‡ãƒ«ãƒ¢ãƒ™ãƒ¼ãƒˆ"],["ã‚ã‚“ã¦ã¹ãƒ¼ã¨","ã‚¢ãƒ³ãƒ†ãƒ™ãƒ¼ãƒˆ"],["ã¾ã„ã–ãƒ¼","ãƒžã‚¤ã‚¶ãƒ¼"],["ã‚Šã‚“ã§ã‚ã‚“","ãƒªãƒ³ãƒ‡ãƒ­ãƒ³"],["ã‚ã“ã„ã©","ãƒ­ã‚³ã‚¤ãƒ‰"],["ãã‚“ã ã¹ãƒ¼ã¨","ã‚­ãƒ³ãƒ€ãƒ™ãƒ¼ãƒˆ"],
["ã·ã‚ã¨ã´ã£ã","ãƒ—ãƒ­ãƒˆãƒ”ãƒƒã‚¯"],["ãŸãã‚ã‚Šã‚€ã™","ã‚¿ã‚¯ãƒ­ãƒªãƒ ã‚¹"],["ã“ã‚Œãã¡ã‚€","ã‚³ãƒ¬ã‚¯ãƒãƒ "],["ã‚‚ã„ãœã‚‹ã¨","ãƒ¢ã‚¤ã‚¼ãƒ«ãƒˆ"],
["ã²ã‚‹ã©ã„ã©","ãƒ’ãƒ«ãƒ‰ã‚¤ãƒ‰"],["ã‚ã›ã‚Šã‚“","ç™½è‰²ãƒ¯ã‚»ãƒªãƒ³"],["ãƒ—ãƒ­ãƒšãƒˆ","ãƒ—ãƒ­ãƒšãƒˆï¼ˆç™½è‰²ãƒ¯ã‚»ãƒªãƒ³ï¼‰"],
["ã¹ã´ãŠã’ã‚‹","ãƒ™ãƒ”ã‚ªã‚²ãƒ«"],["ã§ãƒãµã‡ã‚Šã‚“","ãƒ‡ã‚£ãƒ•ã‚§ãƒªãƒ³"],["ãˆã´ã§ã‚…ãŠ","ã‚¨ãƒ”ãƒ‡ãƒ¥ã‚ª"],["ã§ã‚…ã‚ã£ã","ãƒ‡ãƒ¥ã‚¢ãƒƒã‚¯"],
["ã‚ã ã±ã‚Œã‚“","ã‚¢ãƒ€ãƒ‘ãƒ¬ãƒ³"],["ãã‚Šã‚“ã ã¾ã„ã—ã‚“","ã‚¯ãƒªãƒ³ãƒ€ãƒžã‚¤ã‚·ãƒ³"],
["ã‚ãã‚ã¡ã‚€","ã‚¢ã‚¯ã‚¢ãƒãƒ "],["ãœã³ã‚ã£ãã™","ã‚¼ãƒ“ã‚¢ãƒƒã‚¯ã‚¹"],["ãªã˜ãµã‚","ãƒŠã‚¸ãƒ•ãƒ­"],
["ã§ã‚‹ã‚‚ãžãƒ¼ã‚‹","ãƒ‡ãƒ«ãƒ¢ã‚¾ãƒ¼ãƒ«"],["ã«ãžã‚‰ãƒ¼ã‚‹","ãƒ‹ã‚¾ãƒ©ãƒ¼ãƒ«"],["ã‚‹ã‚Šã“ã‚“","ãƒ«ãƒªã‚³ãƒ³"],
["ã¦ã‚‹ã³ãªãµãƒã‚“","ãƒ†ãƒ«ãƒ“ãƒŠãƒ•ã‚£ãƒ³"],["ã„ã¨ã‚‰ã“ãªãžãƒ¼ã‚‹","ã‚¤ãƒˆãƒ©ã‚³ãƒŠã‚¾ãƒ¼ãƒ«"],
["ãµã‡ãããµã‡ãªã˜ã‚“","ãƒ•ã‚§ã‚­ã‚½ãƒ•ã‚§ãƒŠã‚¸ãƒ³"],["ã‚ã‚Œãã‚‰","ã‚¢ãƒ¬ã‚°ãƒ©"],["ã³ã‚‰ã®ã‚","ãƒ“ãƒ©ãƒŽã‚¢"],["ã§ã–ã‚Œã£ãã™","ãƒ‡ã‚¶ãƒ¬ãƒƒã‚¯ã‚¹"],["ã‚‹ã±ãµãƒã‚“","ãƒ«ãƒ‘ãƒ•ã‚£ãƒ³"],["ãŸã‚ŠãŠã‚“","ã‚¿ãƒªã‚ªãƒ³"],["ã‚ã‚Œã‚ã£ã","ã‚¢ãƒ¬ãƒ­ãƒƒã‚¯"],["ã–ã„ã–ã‚‹","ã‚¶ã‚¤ã‚¶ãƒ«"],
["ã°ã‚‹ã¨ã‚Œã£ãã™","ãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹"],["ã‚ã‚ãªã‚Šãƒ¼ãµ","ã‚¢ãƒ¡ãƒŠãƒªãƒ¼ãƒ•"],["ã°ã‚‰ã—ãã‚ã³ã‚‹","ãƒãƒ©ã‚·ã‚¯ãƒ­ãƒ“ãƒ«"],
["ã‚ˆãã„ã«ã‚“","ãƒ¨ã‚¯ã‚¤ãƒ‹ãƒ³"],["ã¯ã¨ã‚€ãŽ","ãƒ¨ã‚¯ã‚¤ãƒ‹ãƒ³"],
["ã‚ã¨ã¨ã‚Œãã•ãƒ¼ã¨","ãƒ¡ãƒˆãƒˆãƒ¬ã‚­ã‚µãƒ¼ãƒˆ"],["ã—ãã‚ã™ã½ã‚Šã‚“","ã‚·ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ³"],["ã­ãŠãƒ¼ã‚‰ã‚‹","ãƒã‚ªãƒ¼ãƒ©ãƒ«"],
["ã‹ã‚ãªãƒ¼ã‚‹","ã‚«ãƒ­ãƒŠãƒ¼ãƒ«"],["ã‚ã›ã¨ã‚ã¿ã®ãµã‡ã‚“","ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒŽãƒ•ã‚§ãƒ³"],["ã‚ããã«ã‚“","ãƒ­ã‚­ã‚½ãƒ‹ãƒ³"],
["ã‚Šã‚Šã‹","ãƒªãƒªã‚«"],["ãŸã‚Šãƒ¼ã˜ã‡","ã‚¿ãƒªãƒ¼ã‚¸ã‚§"],["ã·ã‚ŒãŒã°ã‚Šã‚“","ãƒ—ãƒ¬ã‚¬ãƒãƒªãƒ³"],["ã¿ã‚ãŒã°ã‚Šã‚“","ãƒŸãƒ­ã‚¬ãƒãƒªãƒ³"],
["ã‚ãšã®ãƒ¼ã‚‹","ã‚¢ã‚ºãƒŽãƒ¼ãƒ«"],["ã’ã‚“ãŸã—ã‚“","ã‚²ãƒ³ã‚¿ã‚·ãƒ³"],["ãµã—ã˜ã‚“ã•ã‚“","ãƒ•ã‚·ã‚¸ãƒ³é…¸"],
];

// === MAIN COMPONENT ===
export default function Home(){
const{isMobile:mob,isTablet:tab,w:winW}=useResponsive();
const btn=(bg,color,extra)=>({padding:mob?"6px 12px":"8px 18px",borderRadius:mob?10:14,border:"none",background:bg,color,fontSize:mob?12:14,fontWeight:600,fontFamily:"inherit",cursor:"pointer",WebkitTapHighlightColor:"transparent",...extra});
const ib={padding:mob?"7px 10px":"8px 12px",borderRadius:mob?10:12,border:`1.5px solid ${C.g200}`,fontSize:mob?14:13,fontFamily:"inherit",outline:"none",background:C.w,color:C.g900,transition:"border-color 0.2s",WebkitAppearance:"none"};
const card={background:C.w,borderRadius:mob?14:20,padding:mob?"14px":"20px",boxShadow:"0 2px 16px rgba(13,148,136,.08)"};
const rb={width:mob?60:70,height:mob?60:70,borderRadius:"50%",border:"none",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,fontFamily:"inherit",fontWeight:700,fontSize:mob?9:10,cursor:"pointer",WebkitTapHighlightColor:"transparent"};
const[page,setPage]=useState("main"); // main|room|hist|settings|help|about
const[rs,sRS]=useState("inactive"),[inp,sInp]=useState(""),[out,sOut]=useState(""),[st,sSt]=useState("å¾…æ©Ÿä¸­"),[el,sEl]=useState(0),[ld,sLd]=useState(false),[lv,sLv]=useState(0),[md,sMd]=useState("gemini"),[geminiModel,setGeminiModel]=useState(""),[pc,sPC]=useState(0),[tid,sTid]=useState("soap"),[rid,sRid]=useState("r1");
const[hist,sHist]=useState([]),[search,setSearch]=useState(""),[pName,sPName]=useState(""),[pId,sPId]=useState("");
const[pipWin,setPipWin]=useState(null),[pipActive,setPipActive]=useState(false);
const[dict,setDict]=useState(DEFAULT_DICT),[newFrom,setNewFrom]=useState(""),[newTo,setNewTo]=useState(""),[dictEnabled,setDictEnabled]=useState(true);
const[logoUrl,setLogoUrl]=useState(""),[logoSize,setLogoSize]=useState(32);
const[shortcuts,setShortcuts]=useState(DEFAULT_SHORTCUTS);
useEffect(()=>{try{const l=localStorage.getItem("mk_logo");if(l)setLogoUrl(l);const s=localStorage.getItem("mk_logoSize");if(s)setLogoSize(parseInt(s));const d=localStorage.getItem("mk_dict");if(d)setDict(JSON.parse(d));const sn=localStorage.getItem("mk_snippets");if(sn)setSnippets(JSON.parse(sn));const ps=localStorage.getItem("mk_pipSnippets");if(ps)setPipSnippets(JSON.parse(ps));const as=localStorage.getItem("mk_audioSave");if(as)setAudioSave(as==="1");const de=localStorage.getItem("mk_dictEnabled");if(de)setDictEnabled(de==="1");const sc=localStorage.getItem("mk_shortcuts");if(sc)setShortcuts(JSON.parse(sc))}catch{}},[]);
const[micDevices,setMicDevices]=useState([]),[selectedMic,setSelectedMic]=useState("");
const loadMics=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:true}).then(s=>s.getTracks().forEach(t=>t.stop()));const devs=await navigator.mediaDevices.enumerateDevices();const mics=devs.filter(d=>d.kind==="audioinput");setMicDevices(mics);if(!selectedMic&&mics.length>0)setSelectedMic(mics[0].deviceId)}catch(e){console.error("Mic enumeration error:",e)}};
useEffect(()=>{loadMics();navigator.mediaDevices.addEventListener("devicechange",loadMics);return()=>navigator.mediaDevices.removeEventListener("devicechange",loadMics)},[]);
useEffect(()=>{if(!document.getElementById("spin-kf")){const s=document.createElement("style");s.id="spin-kf";s.textContent="@keyframes spin{to{transform:rotate(360deg)}}";document.head.appendChild(s)}},[]);
useEffect(()=>{if(!document.querySelector('meta[name="viewport"]')){const m=document.createElement("meta");m.name="viewport";m.content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no";document.head.appendChild(m)}},[]);
const DEFAULT_SNIPPETS=[
{title:"f/u 1w",text:"f/u 1wå¾Œï¼ˆ1é€±é–“å¾Œå†è¨ºï¼‰",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"f/u 2w",text:"f/u 2wå¾Œï¼ˆ2é€±é–“å¾Œå†è¨ºï¼‰",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"f/u 4w",text:"f/u 4wå¾Œï¼ˆ4é€±é–“å¾Œå†è¨ºï¼‰",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"f/u 2M",text:"f/u 2Må¾Œï¼ˆ2ãƒ¶æœˆå¾Œå†è¨ºï¼‰",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"f/u 3M",text:"f/u 3Må¾Œï¼ˆ3ãƒ¶æœˆå¾Œå†è¨ºï¼‰",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"çµŒéŽè¦³å¯Ÿ",text:"çµŒéŽè¦³å¯Ÿã€‚ç—‡çŠ¶å¢—æ‚ªæ™‚ã¯æ—©ã‚ã«å†è¨ºã€‚",cat:"ãƒ•ã‚©ãƒ­ãƒ¼"},
{title:"å‡¦æ–¹ç®‹ç™ºè¡Œ",text:"å‡¦æ–¹ç®‹ç™ºè¡Œæ¸ˆã¿",cat:"è¨˜éŒ²"},
{title:"èª¬æ˜ŽåŒæ„",text:"æ²»ç™‚å†…å®¹ãƒ»ãƒªã‚¹ã‚¯ãƒ»å‰¯ä½œç”¨ã«ã¤ã„ã¦èª¬æ˜Žã—ã€åŒæ„ã‚’å¾—ãŸã€‚",cat:"è¨˜éŒ²"},
{title:"å†™çœŸæ’®å½±",text:"è‡¨åºŠå†™çœŸæ’®å½±æ¸ˆã¿",cat:"è¨˜éŒ²"},
{title:"ç´¹ä»‹çŠ¶",text:"ç´¹ä»‹çŠ¶ä½œæˆï¼šã€€ç—…é™¢ã€€ç§‘å®›",cat:"è¨˜éŒ²"},
{title:"æ¤œæŸ»ã‚ªãƒ¼ãƒ€ãƒ¼",text:"æ¤œæŸ»ã‚ªãƒ¼ãƒ€ãƒ¼ï¼šè¡€æ¶²æ¤œæŸ»ï¼ˆCBC, CRPï¼‰",cat:"è¨˜éŒ²"},
{title:"ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ¤œæŸ»",text:"ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆ41ç¨®ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ¤œæŸ»ï¼‰æ–½è¡Œ",cat:"è¨˜éŒ²"},
{title:"çš®è†šç”Ÿæ¤œ",text:"çš®è†šç”Ÿæ¤œæ–½è¡Œã€‚æ¤œä½“ã‚’ç—…ç†çµ„ç¹”æ¤œæŸ»ã«æå‡ºã€‚çµæžœã¯ç´„2é€±é–“å¾Œã€‚",cat:"è¨˜éŒ²"},
{title:"ç²‰ç˜¤åˆ‡é™¤",text:"ã€æ‰‹è¡“è¨˜éŒ²ã€‘ç²‰ç˜¤æ‘˜å‡ºè¡“\néƒ¨ä½ï¼š\nã‚µã‚¤ã‚ºï¼šç´„ mm\néº»é…”ï¼š1%ã‚­ã‚·ãƒ­ã‚«ã‚¤ãƒ³ï¼ˆã‚¨ãƒ”å…¥ã‚Šï¼‰ mLå±€æ³¨\nè¡“å¼ï¼šç´¡éŒ˜å½¢åˆ‡é–‹ã«ã¦è¢«è†œã”ã¨æ‘˜å‡º\næ­¢è¡€ç¢ºèªå¾Œã€ -0ãƒŠã‚¤ãƒ­ãƒ³ã«ã¦ç¸«åˆï¼ˆ é‡ï¼‰\næ¤œä½“ï¼šç—…ç†æå‡º\nè¡“å¾Œï¼šã‚²ãƒ³ã‚¿ã‚·ãƒ³è»Ÿè†+ã‚¬ãƒ¼ã‚¼ä¿è­·\næŠœç³¸äºˆå®šï¼š7-10æ—¥å¾Œ",cat:"æ‰‹è¡“"},
{title:"çš®è†šè…«ç˜åˆ‡é™¤",text:"ã€æ‰‹è¡“è¨˜éŒ²ã€‘çš®è†šè…«ç˜åˆ‡é™¤è¡“\néƒ¨ä½ï¼š\nè‡¨åºŠè¨ºæ–­ï¼š\nã‚µã‚¤ã‚ºï¼šç´„ mmï¼ˆãƒžãƒ¼ã‚¸ãƒ³ mmå«ã‚€ï¼‰\néº»é…”ï¼š1%ã‚­ã‚·ãƒ­ã‚«ã‚¤ãƒ³ï¼ˆã‚¨ãƒ”å…¥ã‚Šï¼‰ mLå±€æ³¨\nè¡“å¼ï¼šãƒžãƒ¼ã‚­ãƒ³ã‚°å¾Œã€ç´¡éŒ˜å½¢ã«åˆ‡é™¤\næ­¢è¡€ç¢ºèªå¾Œã€çœŸçš®ç¸«åˆ+ -0ãƒŠã‚¤ãƒ­ãƒ³ã«ã¦ç¸«åˆ\næ¤œä½“ï¼šç—…ç†æå‡º\nè¡“å¾Œï¼šã‚¬ãƒ¼ã‚¼ä¿è­·\næŠœç³¸äºˆå®šï¼š7-14æ—¥å¾Œ",cat:"æ‰‹è¡“"},
{title:"åˆ‡é–‹æŽ’è†¿",text:"ã€æ‰‹è¡“è¨˜éŒ²ã€‘åˆ‡é–‹æŽ’è†¿è¡“\néƒ¨ä½ï¼š\néº»é…”ï¼š1%ã‚­ã‚·ãƒ­ã‚«ã‚¤ãƒ³ mLå±€æ³¨\næ‰€è¦‹ï¼šè†¿æ±æŽ’å‡ºã‚ã‚Šã€å†…å®¹ç‰©ã‚’ååˆ†ã«æŽ’å‡º\nãƒ‰ãƒ¬ãƒŠãƒ¼ã‚¸ï¼šã‚¬ãƒ¼ã‚¼ãƒ‰ãƒ¬ãƒ¼ãƒ³æŒ¿å…¥\nè¡“å¾Œï¼šã‚²ãƒ³ã‚¿ã‚·ãƒ³è»Ÿè†+ã‚¬ãƒ¼ã‚¼ä¿è­·ã€æ¯Žæ—¥æ´—æµ„äº¤æ›\næŠ—ç”Ÿå‰¤å‡¦æ–¹ï¼š",cat:"æ‰‹è¡“"},
{title:"æ¶²ä½“çª’ç´ ",text:"æ¶²ä½“çª’ç´ å‡çµç™‚æ³•æ–½è¡Œ\néƒ¨ä½ï¼š\nå›žæ•°ï¼šã€€å›žï¼ˆå„ ç§’ç¨‹åº¦ï¼‰\nå¯¾è±¡ï¼šå°‹å¸¸æ€§ç–£è´…\nf/u 2wå¾Œ",cat:"å‡¦ç½®"},
{title:"å…‰ç·šï¼ˆNB-UVBï¼‰",text:"ãƒŠãƒ­ãƒ¼ãƒãƒ³ãƒ‰UVBç…§å°„\nç…§å°„é‡ï¼š mJ/cmÂ²\néƒ¨ä½ï¼š\nå›žæ•°ï¼šæœ¬æ—¥ å›žç›®\nçš®è†šåå¿œï¼šç´…æ–‘ï¼ˆ-/Â±/+ï¼‰\næ¬¡å›žç…§å°„é‡ï¼šã€€mJ/cmÂ²ã«å¢—é‡äºˆå®š",cat:"å‡¦ç½®"},
{title:"å…‰ç·šï¼ˆã‚¨ã‚­ã‚·ãƒžï¼‰",text:"ã‚¨ã‚­ã‚·ãƒžãƒ©ã‚¤ãƒˆç…§å°„\nç…§å°„é‡ï¼š mJ/cmÂ²\néƒ¨ä½ï¼š\nå›žæ•°ï¼šæœ¬æ—¥ å›žç›®\nçš®è†šåå¿œï¼šç´…æ–‘ï¼ˆ-/Â±/+ï¼‰\næ¬¡å›žç…§å°„é‡ï¼šã€€mJ/cmÂ²",cat:"å‡¦ç½®"},
{title:"ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆ",text:"ãƒ‡ãƒ¥ãƒ”ã‚¯ã‚»ãƒ³ãƒˆçš®ä¸‹æ³¨å°„æ–½è¡Œ\næŠ•ä¸Žé‡ï¼š300mgï¼ˆåˆå›žã®ã¿600mgï¼‰\næŠ•ä¸Žéƒ¨ä½ï¼š\nå‰¯ä½œç”¨ç¢ºèªï¼šæ³¨å°„éƒ¨ä½åå¿œï¼ˆ-ï¼‰ã€çµè†œç‚Žï¼ˆ-ï¼‰\næ¬¡å›žæŠ•ä¸Žï¼š2wå¾Œ\nEASIã‚¹ã‚³ã‚¢ï¼š",cat:"ç”Ÿç‰©å­¦çš„è£½å‰¤"},
{title:"ãƒŸãƒãƒ¼ã‚¬",text:"ãƒŸãƒãƒ¼ã‚¬çš®ä¸‹æ³¨å°„æ–½è¡Œ\næŠ•ä¸Žé‡ï¼š60mg\næŠ•ä¸Žéƒ¨ä½ï¼š\nå‰¯ä½œç”¨ç¢ºèªï¼šæ³¨å°„éƒ¨ä½åå¿œï¼ˆ-ï¼‰\næ¬¡å›žæŠ•ä¸Žï¼š4wå¾Œ",cat:"ç”Ÿç‰©å­¦çš„è£½å‰¤"},
{title:"ã‚³ã‚»ãƒ³ãƒ†ã‚£ã‚¯ã‚¹",text:"ã‚³ã‚»ãƒ³ãƒ†ã‚£ã‚¯ã‚¹çš®ä¸‹æ³¨å°„æ–½è¡Œ\næŠ•ä¸Žé‡ï¼š150mg/300mg\næŠ•ä¸Žéƒ¨ä½ï¼š\nå‰¯ä½œç”¨ç¢ºèªï¼šæ³¨å°„éƒ¨ä½åå¿œï¼ˆ-ï¼‰\næ¬¡å›žæŠ•ä¸Žï¼šï¼ˆåˆæœŸã¯æ¯Žé€±â†’4wå¾Œï¼‰\nPASIã‚¹ã‚³ã‚¢ï¼š",cat:"ç”Ÿç‰©å­¦çš„è£½å‰¤"},
{title:"ã‚¾ãƒ¬ã‚¢",text:"ã‚¾ãƒ¬ã‚¢çš®ä¸‹æ³¨å°„æ–½è¡Œ\næŠ•ä¸Žé‡ï¼š300mg\næŠ•ä¸Žéƒ¨ä½ï¼š\nå‰¯ä½œç”¨ç¢ºèªï¼šæ³¨å°„éƒ¨ä½åå¿œï¼ˆ-ï¼‰ã€ã‚¢ãƒŠãƒ•ã‚£ãƒ©ã‚­ã‚·ãƒ¼ï¼ˆ-ï¼‰\næ¬¡å›žæŠ•ä¸Žï¼š4wå¾Œ\nUAS7ã‚¹ã‚³ã‚¢ï¼š",cat:"ç”Ÿç‰©å­¦çš„è£½å‰¤"},
{title:"ã‚¹ã‚­ãƒªãƒ¼ã‚¸",text:"ã‚¹ã‚­ãƒªãƒ¼ã‚¸çš®ä¸‹æ³¨å°„æ–½è¡Œ\næŠ•ä¸Žé‡ï¼š150mg\næŠ•ä¸Žéƒ¨ä½ï¼š\nå‰¯ä½œç”¨ç¢ºèªï¼šæ³¨å°„éƒ¨ä½åå¿œï¼ˆ-ï¼‰\næ¬¡å›žæŠ•ä¸Žï¼šï¼ˆåˆæœŸ12wâ†’8wå¾Œï¼‰\nPASIã‚¹ã‚³ã‚¢ï¼š",cat:"ç”Ÿç‰©å­¦çš„è£½å‰¤"},
{title:"ãƒŽãƒ¼ãƒªã‚¹",text:"ãƒŽãƒ¼ãƒªã‚¹ï¼ˆIPLå…‰æ²»ç™‚ï¼‰æ–½è¡Œ\nç…§å°„éƒ¨ä½ï¼šé¡”å…¨ä½“\nãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼š\nãƒ•ãƒ«ã‚¨ãƒ³ã‚¹ï¼š\nãƒ‘ã‚¹æ•°ï¼š\nå†·å´ï¼šæ–½è¡Œ\nè¡“å¾Œï¼šæ—¥ç„¼ã‘æ­¢ã‚å¡—å¸ƒãƒ»ä¿æ¹¿æŒ‡å°Ž",cat:"ç¾Žå®¹æ–½è¡“"},
{title:"ãƒãƒ†ãƒ³ãƒ„ã‚¡",text:"ãƒãƒ†ãƒ³ãƒ„ã‚¡æ–½è¡Œ\nãƒãƒƒãƒ—ï¼š\néƒ¨ä½ï¼š\nå‡ºåŠ›ï¼š\nãƒ‘ã‚¹æ•°ï¼š\néº»é…”ï¼šè¡¨é¢éº»é…”ã‚¯ãƒªãƒ¼ãƒ ï¼ˆ mmå¡—å¸ƒ åˆ†å¾…æ©Ÿï¼‰\nè¡“å¾Œï¼šéŽ®é™ãƒ‘ãƒƒã‚¯æ–½è¡Œã€ä¿æ¹¿ãƒ»é®å…‰æŒ‡å°Ž",cat:"ç¾Žå®¹æ–½è¡“"},
{title:"ãƒ¡ã‚½ãƒŠJ",text:"ãƒ¡ã‚½ãƒŠJæ–½è¡Œ\nã‚³ãƒ¼ã‚¹ï¼šãƒˆãƒ¼ã‚¿ãƒ«ç¾Žå®¹/ç¾Žè‚Œã‚³ãƒ¼ã‚¹\nå°Žå…¥æˆåˆ†ï¼š\néƒ¨ä½ï¼šé¡”å…¨ä½“ï¼ˆç›®å…ƒå«ã‚€ï¼‰\næ–½è¡“æ™‚é–“ï¼šç´„ åˆ†\nè¡“å¾Œï¼šç‰¹è¨˜äº‹é …ãªã—",cat:"ç¾Žå®¹æ–½è¡“"},
{title:"ãƒ”ãƒ¼ãƒªãƒ³ã‚°",text:"ã‚µãƒªãƒãƒ«é…¸ãƒžã‚¯ãƒ­ã‚´ãƒ¼ãƒ«ãƒ”ãƒ¼ãƒªãƒ³ã‚°æ–½è¡Œ\néƒ¨ä½ï¼šé¡”å…¨ä½“\nå¡—å¸ƒæ™‚é–“ï¼š5åˆ†\nçš®è†šåå¿œï¼šè»½åº¦ç™ºèµ¤ï¼ˆÂ±ï¼‰\nè¡“å¾Œï¼šä¿æ¹¿ãƒ»é®å…‰æŒ‡å°Ž",cat:"ç¾Žå®¹æ–½è¡“"},
{title:"å¤–ç”¨æŒ‡å°Ž",text:"å¤–ç”¨æŒ‡å°Žï¼š1æ—¥2å›žï¼ˆæœãƒ»å…¥æµ´å¾Œï¼‰æ‚£éƒ¨ã«è–„ãå¡—å¸ƒã€‚æ”¹å–„å¾Œã¯1æ—¥1å›žã«æ¸›é‡å¯ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"ä¿æ¹¿æŒ‡å°Ž",text:"ä¿æ¹¿æŒ‡å°Žï¼š1æ—¥2å›žä»¥ä¸Šã€å…¥æµ´å¾Œã™ãã«ä¿æ¹¿å‰¤ã‚’å…¨èº«ã«å¡—å¸ƒã€‚ã“ã™ã‚‰ãšæŠ¼ã•ãˆã‚‹ã‚ˆã†ã«ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"é®å…‰æŒ‡å°Ž",text:"é®å…‰æŒ‡å°Žï¼šæ—¥ç„¼ã‘æ­¢ã‚ï¼ˆSPF30ä»¥ä¸Šï¼‰ã‚’æ¯Žæ—¥å¡—å¸ƒã€‚2-3æ™‚é–“ãŠãã«å¡—ã‚Šç›´ã—ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"å¤–ç”¨FTU",text:"å¤–ç”¨é‡ç›®å®‰ï¼ˆFTUï¼‰ï¼šäººå·®ã—æŒ‡ã®å…ˆç«¯ã‹ã‚‰ç¬¬ä¸€é–¢ç¯€ã¾ã§ï¼ˆç´„0.5gï¼‰ã§æ‰‹ã®ã²ã‚‰2æžšåˆ†ã®é¢ç©ã«å¡—å¸ƒã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"é‡ã­å¡—ã‚Šé †åº",text:"å¤–ç”¨é †åºï¼šâ‘ ä¿æ¹¿å‰¤ã‚’åºƒç¯„å›²ã«å¡—å¸ƒâ†’â‘¡ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰å¤–ç”¨è–¬ã‚’æ‚£éƒ¨ã®ã¿ã«é‡ã­å¡—ã‚Š",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",text:"ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç™‚æ³•ï¼šç—‡çŠ¶æ”¹å–„å¾Œã‚‚é€±2-3å›žã®å¤–ç”¨ã‚’ç¶™ç¶šã€‚å†ç‡ƒäºˆé˜²ã®ãŸã‚è‡ªå·±åˆ¤æ–­ã§ä¸­æ­¢ã—ãªã„ã€‚å¾ã€…ã«é€±1å›žâ†’éš”é€±ã¨é–“éš”ã‚’å»¶é•·ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰æ¼¸æ¸›",text:"ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰æ¼¸æ¸›ï¼š\n1-2é€±ç›®ï¼š1æ—¥2å›ž\n3-4é€±ç›®ï¼š1æ—¥1å›ž\n5-6é€±ç›®ï¼š2æ—¥ã«1å›ž\nä»¥é™ï¼šé€±2-3å›žï¼ˆãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç™‚æ³•ã¸ç§»è¡Œï¼‰",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"æŠ—ãƒ’ã‚¹å†…æœæŒ‡å°Ž",text:"æŠ—ãƒ’ã‚¹ã‚¿ãƒŸãƒ³è–¬ï¼šæ¯Žæ—¥æ±ºã¾ã£ãŸæ™‚é–“ã«æœç”¨ã€‚ç—‡çŠ¶ãªãã¦ã‚‚è‡ªå·±åˆ¤æ–­ã§ä¸­æ­¢ã›ãšç¶™ç¶šã€‚çœ æ°—ã‚ã‚Œã°å°±å¯å‰ã«æœç”¨ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"å¸¯çŠ¶ç–±ç–¹æŒ‡å°Ž",text:"å¸¯çŠ¶ç–±ç–¹æŒ‡å°Žï¼šæŠ—ã‚¦ã‚¤ãƒ«ã‚¹è–¬5-7æ—¥é–“ç¢ºå®Ÿã«å†…æœã€‚æ°´ç–±ã¯æ¸…æ½”ã«ä¿ã¡ç ´ã‚‰ãªã„ã€‚ç–¼ç—›æŒç¶šæ™‚ã¯æ—©ã‚ã«ç›¸è«‡ã€‚æ°´ç—˜æœªç½¹æ‚£ã®ä¹³å¹¼å…ãƒ»å¦Šå©¦ã¨ã®æŽ¥è§¦ã‚’é¿ã‘ã‚‹ã€‚",cat:"æ‚£è€…æŒ‡å°Ž"},
{title:"è¡“å¾Œæ³¨æ„ï¼ˆç¸«åˆï¼‰",text:"è¡“å¾Œæ³¨æ„ï¼ˆç¸«åˆå‰µï¼‰ï¼š\nãƒ»å½“æ—¥ã¯å®‰é™ã€é£²é…’ãƒ»æ¿€ã—ã„é‹å‹•æŽ§ãˆã‚‹\nãƒ»ç¿Œæ—¥ã‹ã‚‰ã‚·ãƒ£ãƒ¯ãƒ¼å¯ï¼ˆæ´—æµ„å¾Œã€è»Ÿè†+ã‚¬ãƒ¼ã‚¼ä¿è­·ï¼‰\nãƒ»æ¹¯èˆ¹ã¯æŠœç³¸ã¾ã§ä¸å¯\nãƒ»å‡ºè¡€æ™‚ã¯æ¸…æ½”ãªã‚¬ãƒ¼ã‚¼ã§åœ§è¿«ã—é€£çµ¡\nãƒ»æŠœç³¸äºˆå®šï¼šã€€æ—¥å¾Œ",cat:"è¡“å¾Œæ³¨æ„"},
{title:"è¡“å¾Œæ³¨æ„ï¼ˆåˆ‡é–‹ï¼‰",text:"è¡“å¾Œæ³¨æ„ï¼ˆåˆ‡é–‹æŽ’è†¿å¾Œï¼‰ï¼š\nãƒ»æ¯Žæ—¥ã‚·ãƒ£ãƒ¯ãƒ¼ã§æ´—æµ„â†’è»Ÿè†+ã‚¬ãƒ¼ã‚¼äº¤æ›\nãƒ»è†¿ã‚„æµ¸å‡ºæ¶²ã¯æ­£å¸¸ãªçµŒéŽ\nãƒ»ç™ºç†±ãƒ»è…«ã‚Œæ‹¡å¤§æ™‚ã¯æ—©ã‚ã«å—è¨º\nãƒ»æŠ—ç”Ÿå‰¤ã¯æœ€å¾Œã¾ã§å†…æœ",cat:"è¡“å¾Œæ³¨æ„"},
{title:"æ–½è¡“å¾Œï¼ˆãƒ¬ãƒ¼ã‚¶ãƒ¼ï¼‰",text:"æ–½è¡“å¾Œæ³¨æ„ï¼ˆãƒ¬ãƒ¼ã‚¶ãƒ¼ï¼‰ï¼š\nãƒ»èµ¤ã¿è…«ã‚Œã¯æ•°æ—¥ã§æ”¹å–„\nãƒ»24hæ´—é¡”ãƒ»åŒ–ç²§æŽ§ãˆã‚‹\nãƒ»ã‹ã•ã¶ãŸã‚’å‰¥ãŒã•ãªã„\nãƒ»æ—¥ç„¼ã‘æ­¢ã‚å¿…é ˆ\nãƒ»ä¿æ¹¿ååˆ†ã«\nãƒ»ã“ã™ã‚‰ãªã„ï¼ˆè‰²ç´ æ²ˆç€äºˆé˜²ï¼‰",cat:"è¡“å¾Œæ³¨æ„"},
{title:"æ–½è¡“å¾Œï¼ˆIPLï¼‰",text:"æ–½è¡“å¾Œæ³¨æ„ï¼ˆãƒŽãƒ¼ãƒªã‚¹/IPLï¼‰ï¼š\nãƒ»ã‚·ãƒŸãŒä¸€æ™‚çš„ã«æ¿ƒããªã‚‹â†’1-2wã§å‰¥ãŒã‚Œã‚‹\nãƒ»å½“æ—¥ã‹ã‚‰æ´—é¡”ãƒ¡ã‚¤ã‚¯å¯\nãƒ»æ—¥ç„¼ã‘æ­¢ã‚å¿…é ˆ\nãƒ»1wåˆºæ¿€ã®å¼·ã„åŒ–ç²§å“ã‚’é¿ã‘ã‚‹",cat:"è¡“å¾Œæ³¨æ„"},
{title:"æ–½è¡“å¾Œï¼ˆãƒãƒ†ãƒ³ãƒ„ã‚¡ï¼‰",text:"æ–½è¡“å¾Œæ³¨æ„ï¼ˆãƒãƒ†ãƒ³ãƒ„ã‚¡ï¼‰ï¼š\nãƒ»èµ¤ã¿è…«ã‚Œç‚¹çŠ¶å‡ºè¡€â†’2-3æ—¥ã§æ”¹å–„\nãƒ»å½“æ—¥æ´—é¡”ãƒ¡ã‚¤ã‚¯ä¸å¯ã€ç¿Œæ—¥ã‹ã‚‰å¯\nãƒ»24hé£²é…’ãƒ»é‹å‹•ãƒ»å…¥æµ´æŽ§ãˆã‚‹\nãƒ»æ—¥ç„¼ã‘æ­¢ã‚å¿…é ˆ",cat:"è¡“å¾Œæ³¨æ„"},
{title:"æ–½è¡“å¾Œï¼ˆãƒ”ãƒ¼ãƒªãƒ³ã‚°ï¼‰",text:"æ–½è¡“å¾Œæ³¨æ„ï¼ˆãƒ”ãƒ¼ãƒªãƒ³ã‚°ï¼‰ï¼š\nãƒ»å½“æ—¥ã‹ã‚‰æ´—é¡”ãƒ¡ã‚¤ã‚¯å¯\nãƒ»æ•°æ—¥é–“çš®ã‚€ã‘ä¹¾ç‡¥ã‚ã‚Š\nãƒ»ä¿æ¹¿ååˆ†ã«ãƒ»æ—¥ç„¼ã‘æ­¢ã‚å¿…é ˆ\nãƒ»1wã‚¹ã‚¯ãƒ©ãƒ–ä½¿ç”¨ä¸å¯",cat:"è¡“å¾Œæ³¨æ„"},
{title:"ã‚¼ã‚ªã‚¹ã‚­ãƒ³é–‹å§‹",text:"ã‚¼ã‚ªã‚¹ã‚­ãƒ³ãƒ˜ãƒ«ã‚¹é–‹å§‹\nã‚³ãƒ¼ã‚¹ï¼š\nè£½å“ï¼š\næ³¨æ„ï¼šAåå¿œï¼ˆèµ¤ã¿çš®ã‚€ã‘ä¹¾ç‡¥ï¼‰ã¯2-6wã§æ”¹å–„ã€‚æ—¥ç„¼ã‘æ­¢ã‚å¿…é ˆã€‚å¦Šå¨ æŽˆä¹³ä¸­ã¯ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³ä½¿ç”¨ä¸å¯ã€‚",cat:"ãã®ä»–"},
{title:"ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³",text:"ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒŽã‚¤ãƒ³å†…æœé–‹å§‹ã€€mg/æ—¥\næ³¨æ„ï¼šé¿å¦Šå¿…é ˆï¼ˆå¥³æ€§ï¼šå‰1Mã€œå¾Œ1Mï¼‰ã€çŒ®è¡€ä¸å¯ã€å®šæœŸè¡€æ¶²æ¤œæŸ»ï¼ˆè‚æ©Ÿèƒ½ãƒ»è„‚è³ªï¼‰ã€ä¿æ¹¿ï¼ˆå”‡ãƒ»çš®è†šãƒ»çœ¼ã®ä¹¾ç‡¥å¯¾ç­–ï¼‰\næ¬¡å›žè¡€æ¶²æ¤œæŸ»ï¼š4wå¾Œ",cat:"ãã®ä»–"},
{title:"å¸¯çŠ¶ç–±ç–¹ãƒ¯ã‚¯ãƒãƒ³",text:"å¸¯çŠ¶ç–±ç–¹ãƒ¯ã‚¯ãƒãƒ³ï¼ˆã‚·ãƒ³ã‚°ãƒªãƒƒã‚¯ã‚¹ï¼‰èª¬æ˜Žï¼š\nãƒ»ä¸æ´»åŒ–ãƒ¯ã‚¯ãƒãƒ³ã€2å›žæŽ¥ç¨®ï¼ˆ2ãƒ¶æœˆé–“éš”ï¼‰\nãƒ»äºˆé˜²åŠ¹æžœ90%ä»¥ä¸Šã€50æ­³ä»¥ä¸Šå¯¾è±¡\nãƒ»æŽ¥ç¨®éƒ¨ä½ã®ç—›ã¿è…«ã‚Œã¯æ•°æ—¥ã§æ”¹å–„",cat:"ãã®ä»–"},
];
const[snippets,setSnippets]=useState(DEFAULT_SNIPPETS),[newSnTitle,setNewSnTitle]=useState(""),[newSnText,setNewSnText]=useState(""),[pipSnippets,setPipSnippets]=useState([0,1,2,3,4]),[openCats,setOpenCats]=useState([]);
const[docDisease,setDocDisease]=useState(""),[docOut,setDocOut]=useState(""),[docLd,setDocLd]=useState(false),[docFreePrompt,setDocFreePrompt]=useState("");
const[suggestLd,setSuggestLd]=useState(false),[suggestedSnippets,setSuggestedSnippets]=useState([]);
const[pastInput,setPastInput]=useState(""),[pastDisease,setPastDisease]=useState(""),[pastSource,setPastSource]=useState(""),[pastLd,setPastLd]=useState(false),[pastCount,setPastCount]=useState(0),[pastMsg,setPastMsg]=useState("");
const[csOut,setCsOut]=useState(""),[csLd,setCsLd]=useState(false),[csMode,setCsMode]=useState("full"),[csTx,setCsTx]=useState(""),[csCount,setCsCount]=useState(0);
const undoRef=useRef(null);
const loadCsCount=async()=>{if(!supabase)return;try{const{count}=await supabase.from("counseling_records").select("*",{count:"exact",head:true});setCsCount(count||0)}catch{}};
useEffect(()=>{loadCsCount()},[]);

// Keyboard shortcuts
const startRef=useRef(null),stopRef=useRef(null),sumRef=useRef(null),clrRef=useRef(null),undoFnRef=useRef(null),pipFnRef=useRef(null);
useEffect(()=>{
const handler=(e)=>{
if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;
const key=e.key;const ctrl=e.ctrlKey||e.metaKey;
const findSC=(id)=>shortcuts.find(s=>s.id===id);
const matchKey=(sc)=>{
if(!sc||!sc.enabled)return false;
const k=sc.key;
if(k.startsWith("Ctrl+")){return ctrl&&key===k.replace("Ctrl+","");}
if(k.startsWith("Alt+")){return e.altKey&&key===k.replace("Alt+","");}
return key===k;
};
const scs=[
{id:"rec",fn:()=>{if(rsRef.current==="recording"){if(stopRef.current)stopRef.current()}else{if(startRef.current)startRef.current()}}},
{id:"sum",fn:()=>{if(sumRef.current)sumRef.current()}},
{id:"clear",fn:()=>{if(typeof saveUndo==="function")saveUndo();sInp("");sOut("");sSt("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")}},
{id:"next",fn:()=>{if(clrRef.current)clrRef.current()}},
{id:"copy",fn:()=>{if(out){try{navigator.clipboard.writeText(out);sSt("ðŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}catch{}}}},
{id:"pip",fn:()=>{if(pipFnRef.current)pipFnRef.current()}},
{id:"doc",fn:()=>setPage("doc")},
{id:"counsel",fn:()=>setPage("counsel")},
{id:"undo",fn:()=>{if(undoFnRef.current)undoFnRef.current()}},
{id:"room1",fn:()=>sRid("r1")},{id:"room2",fn:()=>sRid("r2")},{id:"room3",fn:()=>sRid("r3")},
{id:"room4",fn:()=>sRid("r4")},{id:"room5",fn:()=>sRid("r5")},{id:"room6",fn:()=>sRid("r6")},
{id:"room7",fn:()=>sRid("r7")},
];
for(const sc of scs){
const cfg=findSC(sc.id);
if(matchKey(cfg)){e.preventDefault();sc.fn();return;}
}
};
window.addEventListener("keydown",handler);return()=>window.removeEventListener("keydown",handler)},[out,shortcuts]);
const[minRS,setMinRS]=useState("inactive"),[minInp,setMinInp]=useState(""),[minOut,setMinOut]=useState(""),[minLd,setMinLd]=useState(false),[minEl,setMinEl]=useState(0),[minPrompt,setMinPrompt]=useState("");
const[audioSave,setAudioSave]=useState(false),[audioChunks,setAudioChunks]=useState([]),[savedMsg,setSavedMsg]=useState("");
const audioSaveRef=useRef(false),allAudioChunks=useRef([]);
useEffect(()=>{audioSaveRef.current=audioSave},[audioSave]);
const saveAudio=async(blob)=>{if(!supabase||!blob||blob.size<1000)return;try{const ts=new Date().toISOString().replace(/[:.]/g,"-");const path=`audio/${rid}/${ts}_${pIdRef.current||"unknown"}.webm`;const{error}=await supabase.storage.from("audio").upload(path,blob,{contentType:"audio/webm"});if(error)console.error("Audio save error:",error);else console.log("Audio saved:",path)}catch(e){console.error("Audio save error:",e)}};
const mR=useRef(null),msR=useRef(null),acR=useRef(null),anR=useRef(null),laR=useRef(null),tR=useRef(null),cR=useRef(null),iR=useRef("");
const pipRef=useRef(null),elRef=useRef(0),lvRef=useRef(0),rsRef=useRef("inactive"),pNameRef=useRef(""),pIdRef=useRef(""),snippetsRef=useRef(DEFAULT_SNIPPETS),pipSnippetsRef=useRef([0,1,2,3,4]);
useEffect(()=>{iR.current=inp},[inp]);
useEffect(()=>{elRef.current=el},[el]);
useEffect(()=>{lvRef.current=lv},[lv]);
useEffect(()=>{rsRef.current=rs},[rs]);
useEffect(()=>{pNameRef.current=pName},[pName]);
useEffect(()=>{pIdRef.current=pId},[pId]);
useEffect(()=>{snippetsRef.current=snippets},[snippets]);
useEffect(()=>{pipSnippetsRef.current=pipSnippets},[pipSnippets]);
useEffect(()=>{if(rs==="recording"){tR.current=setInterval(()=>sEl(t=>t+1),1000)}else{clearInterval(tR.current);if(rs==="inactive")sEl(0)}return()=>clearInterval(tR.current)},[rs]);
useEffect(()=>{let lastSnHash="";const id=setInterval(()=>{if(!pipRef.current)return;const d=pipRef.current;const t=d.getElementById("pip-timer"),l=d.getElementById("pip-level"),s=d.getElementById("pip-status"),tr=d.getElementById("pip-transcript");if(t){const e=elRef.current;t.textContent=`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}if(l)l.style.width=`${lvRef.current}%`;if(s){const r=rsRef.current;s.textContent=r==="recording"?"éŒ²éŸ³ä¸­":r==="paused"?"ä¸€æ™‚åœæ­¢":"åœæ­¢";s.style.color=r==="recording"?C.rG:r==="paused"?C.warn:C.g400}if(tr){const txt=iR.current;if(txt){const lines=txt.split("\n");tr.textContent=lines[lines.length-1]}else{tr.textContent=""}}const c=d.getElementById("pip-snippets");if(c){const sn=snippetsRef.current;const ids=pipSnippetsRef.current;const hash=ids.join(",")+"|"+sn.length;if(hash!==lastSnHash){lastSnHash=hash;let html="";ids.forEach(idx=>{if(idx<sn.length){html+=`<button data-sn-idx="${idx}" style="padding:3px 10px;border-radius:6px;border:1px solid rgba(255,255,255,.4);background:rgba(255,255,255,.2);color:#fff;font-size:11px;font-weight:600;cursor:pointer">${sn[idx].title}</button>`}});c.innerHTML=html;c.querySelectorAll("button").forEach(b=>{b.onclick=()=>{const idx=parseInt(b.getAttribute("data-sn-idx"));const t2=snippetsRef.current[idx];if(t2)sOut(o=>o+(o?"\n":"")+t2.text)}})}}},500);return()=>clearInterval(id)},[]);

const fm=s=>`${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
const ct=T.find(t=>t.id===tid)||T[0],cr=R.find(r=>r.id===rid);

// Supabase
const saveRecord=async(input,output)=>{if(!supabase)return;try{await supabase.from("records").insert({room:rid,template:tid,ai_model:md,input_text:input,output_text:output,patient_name:pNameRef.current,patient_id:pIdRef.current});if(rid==="r7"){await supabase.from("counseling_records").insert({patient_name:pNameRef.current,patient_id:pIdRef.current,transcription:input,summary:output,room:"r7"})}}catch(e){console.error("Save error:",e)}};
const generateDoc=async()=>{if(!docDisease.trim())return;setDocLd(true);setDocOut("");try{let histData=[];if(supabase){const{data}=await supabase.from("records").select("output_text").order("created_at",{ascending:false}).limit(200);if(data)histData=data.map(r=>r.output_text).filter(Boolean)}
const related=histData.filter(s=>s.includes(docDisease)).slice(0,20);
let pastKarte="";if(supabase){try{const{data:pd}=await supabase.from("past_records").select("content").or(`content.ilike.%${docDisease}%,disease.ilike.%${docDisease}%`).limit(20);if(pd&&pd.length>0)pastKarte=pd.map(r=>r.content).join("\n---\n")}catch{}}
const histText=(related.length>0?related.join("\n---\n"):"")+(pastKarte?"\n\nã€éŽåŽ»ã®ã‚«ãƒ«ãƒ†è¨˜éŒ²ã€‘\n"+pastKarte:"");
const sysPrompt=`ã‚ãªãŸã¯çš®è†šç§‘å°‚é–€åŒ»ã§ã™ã€‚ä»¥ä¸‹ã®ç–¾æ‚£/ãƒ†ãƒ¼ãƒžã«ã¤ã„ã¦æ‚£è€…å‘ã‘ã®èª¬æ˜Žè³‡æ–™ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ã€ç–¾æ‚£å/ãƒ†ãƒ¼ãƒžã€‘${docDisease}
${docFreePrompt?`ã€è¿½åŠ æŒ‡ç¤ºã€‘${docFreePrompt}\n`:""}${histText?"ã€å½“é™¢ã®éŽåŽ»ã®è¨ºç™‚è¨˜éŒ²ï¼ˆå‚è€ƒï¼‰ã€‘\n"+histText+"\n":""}
ä»¥ä¸‹ã®æ§‹æˆã§æ‚£è€…ã•ã‚“ã«ã‚ã‹ã‚Šã‚„ã™ãä½œæˆï¼š
1. ç–¾æ‚£ã®æ¦‚è¦ï¼ˆã©ã‚“ãªç—…æ°—ã‹ã€åŽŸå› ï¼‰
2. ç—‡çŠ¶
3. å½“é™¢ã§ã®æ²»ç™‚æ–¹æ³•ï¼ˆéŽåŽ»è¨˜éŒ²ãŒã‚ã‚‹å ´åˆã€å½“é™¢ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹è–¬å‰¤ãƒ»æ–½è¡“ã‚’å„ªå…ˆã—ã¦è¨˜è¼‰ï¼‰
4. å¤–ç”¨è–¬ã®ä½¿ã„æ–¹ï¼ˆè©²å½“ã™ã‚‹å ´åˆã€FTUãƒ»å¡—ã‚Šæ–¹ãƒ»é »åº¦ãƒ»é‡ã­å¡—ã‚Šé †åºã‚’å«ã‚€ï¼‰
5. æ—¥å¸¸ç”Ÿæ´»ã§ã®æ³¨æ„ç‚¹ãƒ»ã‚¹ã‚­ãƒ³ã‚±ã‚¢
6. æ²»ç™‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»é€šé™¢é »åº¦ã®ç›®å®‰
7. è¡“å¾Œãƒ»æ–½è¡“å¾Œã®æ³¨æ„ç‚¹ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
8. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆQ&A 2-3å€‹ï¼‰
â€»éŽåŽ»è¨˜éŒ²ãŒã‚ã‚‹å ´åˆã€å½“é™¢ã§å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹è–¬å‰¤åãƒ»æ–½è¡“åãƒ»æ²»ç™‚ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’åæ˜ 
â€»å°‚é–€ç”¨èªžã¯å™›ã¿ç •ã„ã¦èª¬æ˜Ž
â€»ç¾Žå®¹æ–½è¡“ã®å ´åˆã¯ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ç”¨ã«åŠ¹æžœãƒ»ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ»æ–½è¡“é–“éš”ã‚‚å«ã‚ã‚‹
â€»å¤–ç”¨æ–¹æ³•ãŒé–¢ä¿‚ã™ã‚‹å ´åˆã¯FTUï¼ˆ1FTU=ç´„0.5gï¼‰ã€å¡—å¸ƒé †åºï¼ˆä¿æ¹¿å‰¤â†’ã‚¹ãƒ†ãƒ­ã‚¤ãƒ‰ç­‰ï¼‰ã€ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç™‚æ³•ã«ã¤ã„ã¦ã‚‚è¨˜è¼‰
â€»æ‰‹è¡“å¾Œã®æ³¨æ„ç‚¹ãŒé–¢ä¿‚ã™ã‚‹å ´åˆã¯ã‚·ãƒ£ãƒ¯ãƒ¼ãƒ»å…¥æµ´ãƒ»æŠœç³¸ãƒ»å‡ºè¡€æ™‚ã®å¯¾å¿œã‚‚è¨˜è¼‰`;
const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:sysPrompt,mode:"gemini",prompt:"ä»¥ä¸‹ã®æŒ‡ç¤ºã«å¾“ã£ã¦æ‚£è€…å‘ã‘èª¬æ˜Žè³‡æ–™ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"})});const d=await r.json();if(d.error){setDocOut("ã‚¨ãƒ©ãƒ¼: "+d.error)}else{setDocOut(d.summary)}}catch(e){setDocOut("ã‚¨ãƒ©ãƒ¼: "+e.message)}finally{setDocLd(false)}};

const minMR=useRef(null),minSR=useRef(null),minIR=useRef(null),minTI=useRef(null);minIR.current=minInp;
const minGo=async()=>{const s=await sAM();if(!s)return;const mr=new MediaRecorder(s,{mimeType:"audio/webm;codecs=opus"});minMR.current=mr;let ch=[];mr.ondataavailable=e=>{if(e.data.size>0)ch.push(e.data)};mr.onstop=async()=>{if(ch.length>0){const b=new Blob(ch,{type:"audio/webm"});ch=[];if(b.size<500)return;try{const f=new FormData();f.append("audio",b,"audio.webm");const r=await fetch("/api/transcribe",{method:"POST",body:f}),d=await r.json();if(d.text&&d.text.trim()){setMinInp(p=>p+(p?"\n":"")+d.text.trim())}}catch{}}};mr.start();setMinRS("recording");setMinEl(0);minTI.current=setInterval(()=>{setMinEl(t=>t+1);if(minMR.current&&minMR.current.state==="recording"){minMR.current.stop();setTimeout(()=>{if(minMR.current&&minSR.current!=="inactive"){minMR.current.start()}},200)}},10000)};
const minStop=()=>{if(minTI.current)clearInterval(minTI.current);if(minMR.current&&minMR.current.state==="recording")minMR.current.stop();setMinRS("inactive");minSR.current="inactive";xAM()};
const minSum=async()=>{minStop();if(!minIR.current?.trim()){return}setMinLd(true);
const p=minPrompt.trim()||"ä»¥ä¸‹ã®ä¼šè­°ãƒ»ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ›¸ãèµ·ã“ã—ã‹ã‚‰è­°äº‹éŒ²ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚";
const prompt=`${p}\n\nã€æ›¸ãèµ·ã“ã—å†…å®¹ã€‘\n${minIR.current}\n\nä»¥ä¸‹ã®æ§‹æˆã§ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ï¼š\n1. æ—¥æ™‚ãƒ»å‚åŠ è€…ï¼ˆã‚ã‹ã‚‹å ´åˆï¼‰\n2. è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€\n3. æ±ºå®šäº‹é …\n4. å„è­°é¡Œã®è¦ç‚¹\n5. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆæ‹…å½“è€…ãƒ»æœŸé™ï¼‰\n6. æ¬¡å›žäºˆå®š`;
try{const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:prompt,mode:"gemini",prompt:"è­°äº‹éŒ²ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"})});const d=await r.json();if(d.error){setMinOut("ã‚¨ãƒ©ãƒ¼: "+d.error)}else{setMinOut(d.summary)}}catch(e){setMinOut("ã‚¨ãƒ©ãƒ¼: "+e.message)}finally{setMinLd(false)}};
useEffect(()=>{minSR.current=minRS},[minRS]);
const suggestSnippets=async()=>{if(!supabase)return;setSuggestLd(true);setSuggestedSnippets([]);try{const{data}=await supabase.from("records").select("output_text").order("created_at",{ascending:false}).limit(200);if(!data||data.length<3){setSuggestedSnippets([{title:"å±¥æ­´ä¸è¶³",text:"è¦ç´„å±¥æ­´ãŒå°‘ãªã™ãŽã¾ã™ã€‚ã‚‚ã†å°‘ã—ä½¿ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"}]);return}
let summaries=data.map(r=>r.output_text).filter(Boolean).slice(0,50).join("\n---\n");
try{const{data:pd}=await supabase.from("past_records").select("content").order("created_at",{ascending:false}).limit(30);if(pd&&pd.length>0)summaries+="\n\nã€éŽåŽ»ã®ã‚«ãƒ«ãƒ†è¨˜éŒ²ã€‘\n"+pd.map(r=>r.content).join("\n---\n")}catch{}
const prompt=`ä»¥ä¸‹ã¯çš®è†šç§‘ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã®éŽåŽ»ã®è¨ºç™‚è¦ç´„è¨˜éŒ²ã§ã™ã€‚ã“ã®è¨˜éŒ²ã‚’åˆ†æžã—ã¦ã€ã‚ˆãç¹°ã‚Šè¿”ã—ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ•ãƒ¬ãƒ¼ã‚ºã€å®šåž‹æ–‡ã€æŒ‡ç¤ºå†…å®¹ã‚’æŠ½å‡ºã—ã€è¿½è¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ã€éŽåŽ»ã®è¦ç´„è¨˜éŒ²ã€‘
${summaries}

ä»¥ä¸‹ã®JSONå½¢å¼ã§10å€‹ç¨‹åº¦ææ¡ˆã—ã¦ãã ã•ã„ã€‚æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è¢«ã‚‰ãªã„ã€å®Ÿéš›ã®è¨˜éŒ²ã‹ã‚‰æŠ½å‡ºã—ãŸã‚‚ã®ã‚’å„ªå…ˆã—ã¦ãã ã•ã„ã€‚
ã‚«ãƒ†ã‚´ãƒªã¯ï¼šãƒ•ã‚©ãƒ­ãƒ¼ã€è¨˜éŒ²ã€å‡¦ç½®ã€æ‚£è€…æŒ‡å°Žã€å‡¦æ–¹ã€ãã®ä»– ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã€‚

[{"title":"çŸ­ã„ãƒœã‚¿ãƒ³å","text":"è¿½è¨˜ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹","cat":"ã‚«ãƒ†ã‚´ãƒª"}]

JSONé…åˆ—ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜Žæ–‡ã¯ä¸è¦ã§ã™ã€‚`;
const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:prompt,mode:"gemini",prompt:"JSONé…åˆ—ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚"})});const d=await r.json();
if(d.error){setSuggestedSnippets([{title:"ã‚¨ãƒ©ãƒ¼",text:d.error,cat:""}]);return}
try{const cleaned=d.summary.replace(/```json|```/g,"").trim();const arr=JSON.parse(cleaned);setSuggestedSnippets(arr)}catch{setSuggestedSnippets([{title:"è§£æžã‚¨ãƒ©ãƒ¼",text:d.summary,cat:""}])}
}catch(e){setSuggestedSnippets([{title:"ã‚¨ãƒ©ãƒ¼",text:e.message,cat:""}])}finally{setSuggestLd(false)}};

const analyzeCounseling=async()=>{const tx=csTx.trim()||iR.current;if(!tx){setCsOut("åˆ†æžã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚éŒ²éŸ³â†’æ›¸ãèµ·ã“ã—å¾Œã€ã¾ãŸã¯ç›´æŽ¥ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");return}setCsLd(true);setCsOut("");
let pastRef="";if(supabase){try{
const{data:csData}=await supabase.from("counseling_records").select("transcription,summary,patient_name").order("created_at",{ascending:false}).limit(20);
if(csData&&csData.length>0){pastRef="\n\nã€å½“é™¢ã®éŽåŽ»ã®ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°è¨˜éŒ²ï¼ˆ"+csData.length+"ä»¶ï¼‰ã€‘\n"+csData.map((r,i)=>`--- ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°${i+1}${r.patient_name?" ("+r.patient_name+")":""}---\næ›¸ãèµ·ã“ã—: ${r.transcription}\n${r.summary?"è¦ç´„: "+r.summary:""}`).join("\n")}
const{data:pd}=await supabase.from("past_records").select("content").order("created_at",{ascending:false}).limit(10);
if(pd&&pd.length>0)pastRef+="\n\nã€å½“é™¢ã®éŽåŽ»ã‚«ãƒ«ãƒ†ï¼ˆå‚è€ƒï¼‰ã€‘\n"+pd.map(r=>r.content).join("\n---\n")
}catch{}}
const modes={full:`ä»¥ä¸‹ã®çš®è†šç§‘ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã®ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°æ›¸ãèµ·ã“ã—ã‚’å¤šè§’çš„ã«åˆ†æžã—ã¦ãã ã•ã„ã€‚${pastRef}

ã€æ›¸ãèµ·ã“ã—ã€‘
${tx}

ä»¥ä¸‹ã®7é …ç›®ã™ã¹ã¦ã«ã¤ã„ã¦è©³ç´°ã«åˆ†æžãƒ»ææ¡ˆã—ã¦ãã ã•ã„ï¼š

â–  1. ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æž
- å‚¾è´åº¦ï¼ˆæ‚£è€…ã®ç™ºè¨€ã‚’ã©ã‚Œã ã‘æ‹¾ãˆã¦ã„ã‚‹ã‹ï¼‰
- å…±æ„Ÿè¡¨ç¾ã®æœ‰ç„¡ã¨é©åˆ‡ã•
- è³ªå•ã®è³ªï¼ˆã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰è³ªå•ã®ãƒãƒ©ãƒ³ã‚¹ï¼‰
- è©±ã™å‰²åˆï¼ˆåŒ»å¸« vs æ‚£è€…ï¼‰ã®è©•ä¾¡

â–  2. æ‚£è€…ãƒ‹ãƒ¼ã‚ºã®æŠŠæ¡åº¦
- æ‚£è€…ãŒæ˜Žç¤ºçš„ã«è¿°ã¹ãŸãƒ‹ãƒ¼ã‚º
- æ½œåœ¨çš„ãƒ‹ãƒ¼ã‚ºï¼ˆè¨€è‘‰ã®è£ã«ã‚ã‚‹æœ¬å½“ã®æ‚©ã¿ï¼‰
- è¦‹é€ƒã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãƒ‹ãƒ¼ã‚º
- å¿ƒç†çš„ãƒ‹ãƒ¼ã‚ºï¼ˆä¸å®‰ã€æœŸå¾…ã€è‡ªå·±ã‚¤ãƒ¡ãƒ¼ã‚¸ç­‰ï¼‰

â–  3. ææ¡ˆã®é©åˆ‡æ€§
- æ‚£è€…ã®ãƒ‹ãƒ¼ã‚ºã«åˆã£ãŸææ¡ˆãŒã§ãã¦ã„ã‚‹ã‹
- ææ¡ˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯é©åˆ‡ã‹
- ä»£æ›¿æ¡ˆã®æç¤ºã¯ã‚ã‚‹ã‹
- æŠ¼ã—å£²ã‚Šæ„ŸãŒãªã„ã‹

â–  4. å¿ƒç†å­¦çš„åˆ†æžï¼ˆãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è¦³ç‚¹ï¼‰
- æ‚£è€…ã®è³¼è²·å¿ƒç†æ®µéšŽï¼ˆèªçŸ¥â†’èˆˆå‘³â†’æ¬²æ±‚â†’è¡Œå‹•ï¼‰
- ä¿¡é ¼æ§‹ç¯‰ã®ãƒ¬ãƒ™ãƒ«
- ä¸å®‰è¦ç´ ã®è§£æ¶ˆåº¦
- æ„æ€æ±ºå®šã‚’å¾ŒæŠ¼ã—ã™ã‚‹è¦ç´ ã®æœ‰ç„¡

â–  5. ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å–„æ¡ˆ
- å…·ä½“çš„ãªæ”¹å–„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’5ã¤ä»¥ä¸Šææ¡ˆ
- NGãƒ¯ãƒ¼ãƒ‰ã¨ãã®æ”¹å–„ä¾‹
- ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒˆãƒ¼ã‚¯ã®ææ¡ˆ

â–  6. å¹´é–“æ²»ç™‚è¨ˆç”»ã®ææ¡ˆ
- ä»Šå›žã®ç›¸è«‡å†…å®¹ã‚’ã‚‚ã¨ã«12ãƒ¶æœˆã®æ²»ç™‚ãƒ»æ–½è¡“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ææ¡ˆ
- å„æœˆã®æ–½è¡“å†…å®¹ãƒ»ç›®çš„ãƒ»æœŸå¾…åŠ¹æžœ
- å­£ç¯€è¦å› ã®è€ƒæ…®ï¼ˆç´«å¤–ç·šã€ä¹¾ç‡¥ç­‰ï¼‰
- äºˆç®—æ„Ÿã®æ®µéšŽçš„ææ¡ˆ

â–  7. ç·åˆã‚¹ã‚³ã‚¢ã¨æ”¹å–„å„ªå…ˆåº¦
- å‚¾è´åŠ›: /10
- ãƒ‹ãƒ¼ã‚ºæŠŠæ¡: /10
- ææ¡ˆåŠ›: /10
- ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°: /10
- ç·åˆ: /10
- æœ€å„ªå…ˆã§æ”¹å–„ã™ã¹ãç‚¹TOP3`,

listening:`ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ã‹ã‚‰å‚¾è´ãƒ»å…±æ„Ÿã‚¹ã‚­ãƒ«ã‚’åˆ†æžã—ã¦ãã ã•ã„ã€‚${pastRef}\n\n${tx}\n\nåˆ†æžé …ç›®ï¼š\n1. æ‚£è€…ã®ç™ºè¨€ã«å¯¾ã™ã‚‹ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³\n2. å…±æ„Ÿè¡¨ç¾ã®å…·ä½“ä¾‹ã¨æ”¹å–„æ¡ˆ\n3. è¦‹é€ƒã—ã¦ã„ã‚‹æ‚£è€…ã®æ„Ÿæƒ…ãƒ»ãƒ‹ãƒ¼ã‚º\n4. ã‚ˆã‚Šè‰¯ã„å‚¾è´ã®ãŸã‚ã®å…·ä½“çš„ãƒ•ãƒ¬ãƒ¼ã‚ºææ¡ˆ10å€‹`,

needs:`ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ã‹ã‚‰æ‚£è€…ãƒ‹ãƒ¼ã‚ºã‚’åˆ†æžã—ã¦ãã ã•ã„ã€‚${pastRef}\n\n${tx}\n\nåˆ†æžé …ç›®ï¼š\n1. æ˜Žç¤ºçš„ãƒ‹ãƒ¼ã‚ºä¸€è¦§\n2. æ½œåœ¨çš„ãƒ‹ãƒ¼ã‚ºï¼ˆæŽ¨æ¸¬ï¼‰\n3. ãƒ‹ãƒ¼ã‚ºã«åˆã£ãŸææ¡ˆãŒã§ãã¦ã„ã‚‹ã‹è©•ä¾¡\n4. è¿½åŠ ã§ææ¡ˆã™ã¹ãæ–½è¡“ãƒ»æ²»ç™‚\n5. å¹´é–“è¨ˆç”»ã¸ã®å±•é–‹æ¡ˆ`,

marketing:`ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ã‚’ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å¿ƒç†å­¦ã®è¦³ç‚¹ã‹ã‚‰åˆ†æžã—ã¦ãã ã•ã„ã€‚${pastRef}\n\n${tx}\n\nåˆ†æžé …ç›®ï¼š\n1. AIDMAåˆ†æžï¼ˆæ‚£è€…ã®å¿ƒç†æ®µéšŽï¼‰\n2. ä¿¡é ¼æ§‹ç¯‰åº¦ã®è©•ä¾¡\n3. ä¸å®‰è§£æ¶ˆã®é©åˆ‡ã•\n4. ã‚¢ãƒƒãƒ—ã‚»ãƒ«ãƒ»ã‚¯ãƒ­ã‚¹ã‚»ãƒ«ã®æ©Ÿä¼š\n5. ãƒªãƒ”ãƒ¼ãƒˆçŽ‡å‘ä¸Šã®ãŸã‚ã®ææ¡ˆ\n6. å…·ä½“çš„ãªãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å–„æ¡ˆ`,

plan:`ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—å†…å®¹ã‹ã‚‰æ‚£è€…ã®å¹´é–“æ²»ç™‚è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚${pastRef}\n\n${tx}\n\nå‡ºåŠ›ï¼š\n1. æ‚£è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæŽ¨å®šã•ã‚Œã‚‹è‚Œæ‚©ã¿ãƒ»ç›®æ¨™ï¼‰\n2. 12ãƒ¶æœˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæœˆã”ã¨ã®æ–½è¡“ãƒ»æ²»ç™‚å†…å®¹ï¼‰\n3. å„æ–½è¡“ã®ç›®çš„ãƒ»æœŸå¾…åŠ¹æžœ\n4. ãƒ›ãƒ¼ãƒ ã‚±ã‚¢æŒ‡å°Ž\n5. æ¦‚ç®—è²»ç”¨æ„Ÿï¼ˆæ–½è¡“ã”ã¨ã®ç›®å®‰ï¼‰\n6. ç¶™ç¶šã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒç­–`};

try{const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:modes[csMode],mode:"gemini",prompt:"è©³ç´°ã«åˆ†æžã—ã¦ãã ã•ã„ã€‚"})});const d=await r.json();setCsOut(d.error?"ã‚¨ãƒ©ãƒ¼: "+d.error:d.summary)}catch(e){setCsOut("ã‚¨ãƒ©ãƒ¼: "+e.message)}finally{setCsLd(false)}};

const loadPastCount=async()=>{if(!supabase)return;try{const{count}=await supabase.from("past_records").select("*",{count:"exact",head:true});setPastCount(count||0)}catch{}};
const savePastRecords=async()=>{if(!supabase||!pastInput.trim())return;setPastLd(true);setPastMsg("");try{
const chunks=pastInput.split(/\n{2,}|\r\n{2,}/).map(c=>c.trim()).filter(c=>c.length>10);
if(chunks.length===0){setPastMsg("æœ‰åŠ¹ãªã‚«ãƒ«ãƒ†å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“");return}
const rows=chunks.map(c=>({content:c,source:pastSource.trim()||"æ‰‹å‹•å…¥åŠ›",disease:pastDisease.trim()||"",tags:""}));
const batchSize=50;let total=0;
for(let i=0;i<rows.length;i+=batchSize){const batch=rows.slice(i,i+batchSize);const{error}=await supabase.from("past_records").insert(batch);if(error){setPastMsg("ä¿å­˜ã‚¨ãƒ©ãƒ¼: "+error.message);return}total+=batch.length}
setPastMsg(`âœ“ ${total}ä»¶ã®ã‚«ãƒ«ãƒ†ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);setPastInput("");setPastDisease("");loadPastCount();
}catch(e){setPastMsg("ã‚¨ãƒ©ãƒ¼: "+e.message)}finally{setPastLd(false)}};
const importPastFile=async(file)=>{if(!file)return;setPastLd(true);setPastMsg("ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­...");try{const text=await file.text();setPastInput(text);setPastMsg(`ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆ${Math.round(text.length/1024)}KBï¼‰- å†…å®¹ã‚’ç¢ºèªã—ã¦ã€Œä¿å­˜ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„`)}catch(e){setPastMsg("ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: "+e.message)}finally{setPastLd(false)}};
useEffect(()=>{loadPastCount()},[]);

const loadHist=async()=>{if(!supabase)return;try{const{data}=await supabase.from("records").select("*").order("created_at",{ascending:false}).limit(50);if(data)sHist(data)}catch(e){console.error("Load error:",e)}};
const delRecord=async(id)=>{if(!supabase)return;try{await supabase.from("records").delete().eq("id",id);sHist(h=>h.filter(r=>r.id!==id))}catch(e){console.error("Delete error:",e)}};
const filteredHist=hist.filter(h=>{if(!search.trim())return true;const s=search.toLowerCase();return(h.patient_name||"").toLowerCase().includes(s)||(h.patient_id||"").toLowerCase().includes(s)||(h.output_text||"").toLowerCase().includes(s)});

// Dict
const applyDict=(text)=>{if(!dictEnabled||!text)return text;let r=text;for(const[from,to] of dict){if(from&&to&&from!==to){r=r.split(from).join(to)}}return r};

// Audio
const sAM=async()=>{try{const constraints=selectedMic?{audio:{deviceId:{exact:selectedMic}}}:{audio:true};const s=await navigator.mediaDevices.getUserMedia(constraints);msR.current=s;const c=new(window.AudioContext||window.webkitAudioContext)(),sr=c.createMediaStreamSource(s),a=c.createAnalyser();a.fftSize=256;a.smoothingTimeConstant=0.7;sr.connect(a);acR.current=c;anR.current=a;const d=new Uint8Array(a.frequencyBinCount),tk=()=>{if(!anR.current)return;anR.current.getByteFrequencyData(d);let sm=0;for(let i=0;i<d.length;i++)sm+=d[i];sLv(Math.min(100,Math.round((sm/d.length/128)*100)));laR.current=requestAnimationFrame(tk)};laR.current=requestAnimationFrame(tk);return s}catch(e){console.error("Mic error:",e);sSt("ãƒžã‚¤ã‚¯å–å¾—å¤±æ•—ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã®è¨±å¯è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„");return null}};
const xAM=()=>{if(laR.current)cancelAnimationFrame(laR.current);laR.current=null;if(acR.current){try{acR.current.close()}catch{}}acR.current=null;if(msR.current){msR.current.getTracks().forEach(t=>t.stop())}msR.current=null;anR.current=null;sLv(0)};
const tc=async(b)=>{if(b.size<500)return;if(audioSaveRef.current)allAudioChunks.current.push(b);sPC(p=>p+1);sSt("ðŸ”„ æ›¸ãèµ·ã“ã—ä¸­...");try{const f=new FormData();f.append("audio",b,"audio.webm");const r=await fetch("/api/transcribe",{method:"POST",body:f}),d=await r.json();if(d.text&&d.text.trim()){const fixed=applyDict(d.text.trim());sInp(p=>p+(p?"\n":"")+fixed);sSt("éŒ²éŸ³ä¸­ âœ“")}else{sSt("éŒ²éŸ³ä¸­")}}catch{sSt("éŒ²éŸ³ä¸­ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰")}finally{sPC(p=>Math.max(0,p-1))}};
const cMR=(s)=>{const m=new MediaRecorder(s,{mimeType:MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm"});m.ondataavailable=(e)=>{if(e.data.size>0)tc(e.data)};return m};
const go=async()=>{const s=await sAM();if(!s)return;sRS("recording");sSt("éŒ²éŸ³ä¸­");const m=cMR(s);m.start();mR.current=m;cR.current=setInterval(()=>{if(mR.current&&mR.current.state==="recording"){mR.current.stop();const m2=cMR(s);m2.start();mR.current=m2}},5000)};
const stop=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording")mR.current.stop();mR.current=null;xAM();sRS("inactive");sSt("å¾…æ©Ÿä¸­");if(audioSaveRef.current&&allAudioChunks.current.length>0){const blob=new Blob(allAudioChunks.current,{type:"audio/webm"});saveAudio(blob);allAudioChunks.current=[]}};
const pause=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording")mR.current.stop();sRS("paused");sSt("ä¸€æ™‚åœæ­¢")};
const resume=()=>{if(!msR.current)return;sRS("recording");sSt("éŒ²éŸ³ä¸­");const m=cMR(msR.current);m.start();mR.current=m;cR.current=setInterval(()=>{if(mR.current&&mR.current.state==="recording"){mR.current.stop();const m2=cMR(msR.current);m2.start();mR.current=m2}},5000)};
const sum=async(tx)=>{const t=tx||iR.current;if(!t.trim()){sSt("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}sLd(true);sSt("Gemini ã§è¦ç´„ä¸­...");try{
let pastExamples="";if(supabase){try{const{data}=await supabase.from("records").select("output_text,template").order("created_at",{ascending:false}).limit(100);if(data){const sameTpl=data.filter(r=>r.template===tid&&r.output_text).slice(0,5);if(sameTpl.length>0){pastExamples="\n\nã€å½“é™¢ã®éŽåŽ»ã®è¦ç´„ä¾‹ï¼ˆåŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰- ã“ã®æ›¸å¼ãƒ»è¡¨ç¾ã‚’å‚è€ƒã«ã—ã¦çµ±ä¸€æ„Ÿã‚’å‡ºã—ã¦ãã ã•ã„ã€‘\n"+sameTpl.map((r,i)=>`ä¾‹${i+1}:\n${r.output_text}`).join("\n---\n")}}
const{data:pastData}=await supabase.from("past_records").select("content").order("created_at",{ascending:false}).limit(30);if(pastData&&pastData.length>0){pastExamples+="\n\nã€å½“é™¢ã®éŽåŽ»ã®ã‚«ãƒ«ãƒ†è¨˜éŒ²ï¼ˆå‚è€ƒï¼‰- å½“é™¢ã®ç”¨èªžãƒ»è–¬å‰¤åãƒ»è¡¨ç¾æ–¹æ³•ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‘\n"+pastData.slice(0,10).map(r=>r.content).join("\n---\n")}
}catch(e){console.error("History fetch error:",e)}}
const enhancedPrompt=ct.prompt+pastExamples;
const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,mode:"gemini",prompt:enhancedPrompt})}),d=await r.json();if(d.error){sSt("ã‚¨ãƒ©ãƒ¼: "+d.error);return}if(d.model)setGeminiModel(d.model);sOut(d.summary);await saveRecord(t,d.summary);try{await navigator.clipboard.writeText(d.summary);sSt("è¦ç´„å®Œäº†ãƒ»ä¿å­˜æ¸ˆã¿ âœ“")}catch{sSt("è¦ç´„å®Œäº†ãƒ»ä¿å­˜æ¸ˆã¿")}}catch{sSt("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{sLd(false)}};
const stopSum=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording"){const cr2=mR.current;cr2.ondataavailable=async(e)=>{if(e.data.size>0){const f=new FormData();f.append("audio",e.data,"audio.webm");try{const r=await fetch("/api/transcribe",{method:"POST",body:f}),d=await r.json();if(d.text&&d.text.trim()){const ft=iR.current+(iR.current?"\n":"")+applyDict(d.text.trim());sInp(ft);setTimeout(()=>sum(ft),300)}else{sum()}}catch{sum()}}else{sum()}};cr2.stop()}else{sum()}mR.current=null;xAM();sRS("inactive")};
const saveUndo=()=>{undoRef.current={inp:iR.current||"",out:out,pName:pName,pId:pId}};
const undo=()=>{if(!undoRef.current)return;const u=undoRef.current;sInp(u.inp);sOut(u.out);sPName(u.pName);sPId(u.pId);undoRef.current=null;sSt("â†© å…ƒã«æˆ»ã—ã¾ã—ãŸ")};
const clr=()=>{saveUndo();sInp("");sOut("");sSt("å¾…æ©Ÿä¸­");sEl(0);sPName("");sPId("")};
const cp=async(t)=>{try{await navigator.clipboard.writeText(t);sSt("ã‚³ãƒ”ãƒ¼æ¸ˆã¿ âœ“")}catch{}};

// PiP
const openPip=useCallback(async()=>{try{if(!("documentPictureInPicture" in window)){sSt("Chrome 116ä»¥é™ã§åˆ©ç”¨å¯èƒ½ã§ã™");return}
const pw=await window.documentPictureInPicture.requestWindow({width:270,height:175});
const rm=R.find(r=>r.id===rid);const rmName=rm?`${rm.i}${rm.l}`:"";
pw.document.body.style.margin="0";pw.document.body.style.overflow="hidden";
pw.document.body.innerHTML=`<div style="font-family:sans-serif;background:linear-gradient(135deg,#3d5a1e,#567d2a);color:#fff;padding:5px 8px;height:100%;box-sizing:border-box;display:flex;flex-direction:column;gap:2px">
<div style="display:flex;align-items:center;gap:4px"><span style="font-size:9px;opacity:.5">${rmName}</span>
<input id="pip-pid" placeholder="æ‚£è€…ID" value="" style="flex:1;padding:1px 5px;border-radius:4px;border:none;font-size:9px;background:rgba(255,255,255,.15);color:#fff;outline:none"/>
<span id="pip-status" style="font-size:9px;font-weight:600;color:#94a3b8">åœæ­¢</span></div>
<div style="display:flex;align-items:center;gap:6px"><div id="pip-timer" style="font-size:15px;font-weight:700;font-variant-numeric:tabular-nums">00:00</div>
<div style="flex:1;height:3px;border-radius:2px;background:rgba(255,255,255,.12);overflow:hidden"><div id="pip-level" style="width:0%;height:100%;background:#22c55e;border-radius:2px;transition:width 0.15s"></div></div></div>
<div id="pip-transcript" style="height:18px;overflow:hidden;border-radius:4px;background:rgba(0,0,0,.2);padding:1px 6px;font-size:9px;color:#a0c96a;white-space:nowrap;text-overflow:ellipsis"></div>
<div style="display:flex;gap:4px;justify-content:center">
<button id="pip-rec" style="padding:2px 14px;border-radius:8px;border:2px solid #fff;background:rgba(255,255,255,.15);color:#fff;font-size:13px;font-weight:700;cursor:pointer">é–‹å§‹</button>
<button id="pip-pause" style="padding:2px 10px;border-radius:8px;border:none;background:#fbbf24;color:#78350f;font-size:13px;font-weight:700;cursor:pointer;display:none">ä¸€æ™‚åœæ­¢</button>
<button id="pip-sum" style="padding:2px 10px;border-radius:8px;border:none;background:#567d2a;color:#fff;font-size:13px;font-weight:700;cursor:pointer;display:none">è¦ç´„</button>
<button id="pip-stop" style="padding:2px 10px;border-radius:8px;border:none;background:#ef4444;color:#fff;font-size:13px;font-weight:700;cursor:pointer;display:none">åœæ­¢</button>
<button id="pip-next" style="padding:2px 12px;border-radius:8px;border:2px solid #fff;background:rgba(255,255,255,.15);color:#fff;font-size:12px;font-weight:700;cursor:pointer">æ¬¡ã¸â–¶</button></div>
<div id="pip-shortcuts" style="display:flex;gap:3px;flex-wrap:wrap;overflow:hidden;max-height:24px;margin-top:2px;padding-top:2px;border-top:1px solid rgba(255,255,255,.1)"></div>
<div id="pip-snippets" style="display:flex;gap:4px;flex-wrap:wrap;overflow:hidden;max-height:28px;margin-top:4px;padding-top:4px;border-top:1px solid rgba(255,255,255,.15)"></div></div>`;
pw.document.head.innerHTML=`<style>::placeholder{color:rgba(255,255,255,.35)}</style>`;
const pipPiEl=pw.document.getElementById("pip-pid");if(pipPiEl){pipPiEl.value=pId;pipPiEl.addEventListener("input",e=>{sPId(e.target.value)})}
const pipBtnUpdate=()=>{const d=pipRef.current;if(!d)return;const r=rsRef.current;const rb=d.getElementById("pip-rec"),pb=d.getElementById("pip-pause"),sb=d.getElementById("pip-stop"),smb=d.getElementById("pip-sum");if(!rb)return;rb.style.display=r==="inactive"?"inline-block":"none";pb.style.display=r!=="inactive"?"inline-block":"none";if(r==="recording"){pb.textContent="ä¸€æ™‚åœæ­¢";pb.style.background="#fbbf24";pb.style.color="#78350f"}else if(r==="paused"){pb.textContent="å†é–‹";pb.style.background="#22c55e";pb.style.color="#fff"}sb.style.display=r!=="inactive"?"inline-block":"none";smb.style.display=r!=="inactive"?"inline-block":"none"};
pw.document.getElementById("pip-rec").onclick=()=>{go();setTimeout(pipBtnUpdate,500)};
pw.document.getElementById("pip-pause").onclick=()=>{if(rsRef.current==="recording"){pause()}else{resume()}setTimeout(pipBtnUpdate,300)};
pw.document.getElementById("pip-stop").onclick=()=>{stop();setTimeout(pipBtnUpdate,300)};
pw.document.getElementById("pip-sum").onclick=()=>{stopSum();setTimeout(pipBtnUpdate,500)};
pw.document.getElementById("pip-next").onclick=()=>{clr();const d=pipRef.current;if(d){const pi=d.getElementById("pip-pid");if(pi)pi.value=""}setTimeout(pipBtnUpdate,300)};
const renderPipSnippets=()=>{const d=pipRef.current;if(!d)return;const c=d.getElementById("pip-snippets");if(!c)return;const sn=snippetsRef.current;const ids=pipSnippetsRef.current;let html="";ids.forEach(idx=>{if(idx<sn.length){html+=`<button data-sn-idx="${idx}" style="padding:1px 6px;border-radius:5px;border:1px solid rgba(255,255,255,.4);background:rgba(255,255,255,.15);color:#fff;font-size:9px;font-weight:600;cursor:pointer">${sn[idx].title}</button>`}});c.innerHTML=html;c.querySelectorAll("button").forEach(b=>{b.onclick=()=>{const idx=parseInt(b.getAttribute("data-sn-idx"));const t=snippetsRef.current[idx];if(t)sOut(o=>o+(o?"\n":"")+t.text)}})};
renderPipSnippets();
const renderPipShortcuts=()=>{const d=pipRef.current;if(!d)return;const c=d.getElementById("pip-shortcuts");if(!c)return;
const topSCs=shortcuts.filter(s=>s.showOnTop&&s.enabled);
let html="";topSCs.forEach(sc=>{html+=`<button data-sc-id="${sc.id}" style="padding:1px 5px;border-radius:4px;border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#a0c96a;font-size:8px;font-weight:600;cursor:pointer">${sc.label.split(" ")[0]} ${sc.key}</button>`});
c.innerHTML=html;
c.querySelectorAll("button").forEach(b=>{b.onclick=()=>{const id=b.getAttribute("data-sc-id");
const actions={rec:()=>{if(rsRef.current==="recording"){stop()}else{go()}},sum:()=>{stopSum()},clear:()=>{saveUndo();sInp("");sOut("");sSt("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")},next:()=>{clr();const d2=pipRef.current;if(d2){const pi=d2.getElementById("pip-pid");if(pi)pi.value=""}},copy:()=>{if(iR.current)navigator.clipboard.writeText(iR.current)},pip:()=>{closePip()},doc:()=>setPage("doc"),counsel:()=>setPage("counsel"),undo:()=>undo(),room1:()=>sRid("r1"),room2:()=>sRid("r2"),room3:()=>sRid("r3"),room4:()=>sRid("r4"),room5:()=>sRid("r5"),room6:()=>sRid("r6"),room7:()=>sRid("r7")};
const fn=actions[id];if(fn)fn();
}})};
renderPipShortcuts();
pipRef.current=pw.document;setPipWin(pw);setPipActive(true);
const btnLoop=setInterval(()=>{if(!pipRef.current){clearInterval(btnLoop);return}pipBtnUpdate()},600);
pw.addEventListener("pagehide",()=>{clearInterval(btnLoop);pipRef.current=null;setPipWin(null);setPipActive(false)});
}catch(e){console.error("PiP error:",e);sSt("å°çª“ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸ")}
},[rid,pId,pipSnippets,snippets,shortcuts]);
const closePip=useCallback(()=>{if(pipWin){pipWin.close()}pipRef.current=null;setPipWin(null);setPipActive(false)},[pipWin]);
startRef.current=go;stopRef.current=stop;sumRef.current=sum;clrRef.current=clr;undoFnRef.current=undo;pipFnRef.current=openPip;

// Helpers
const fmD=(d)=>{const dt=new Date(d);return `${dt.getMonth()+1}/${dt.getDate()} ${dt.getHours()}:${String(dt.getMinutes()).padStart(2,"0")}`};
const tn=(id)=>{const t=T.find(x=>x.id===id);return t?t.name:id};
const rn=(id)=>{const r=R.find(x=>x.id===id);return r?`${r.i}${r.l}`:id};

const titleRow=()=>(<div style={{display:"flex",alignItems:"center",gap:8}}>{logoUrl&&<img src={logoUrl} alt="logo" style={{width:logoSize,height:logoSize,borderRadius:8,objectFit:"contain"}}/>}<span style={{fontWeight:700,fontSize:15,color:C.w}}>å—è‰æ´¥çš®ãƒ•ç§‘AIã‚«ãƒ«ãƒ†è¦ç´„</span></div>);

// === SHORTCUTS PAGE ===
if(page==="shortcuts")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:mob?16:18,fontWeight:700,color:C.pDD,margin:0}}>âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆä¸€è¦§</h2><button onClick={()=>setPage("main")} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<p style={{fontSize:mob?12:13,color:C.g500,marginBottom:16}}>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ç´ æ—©ãæ“ä½œã§ãã¾ã™ã€‚â­ãƒžãƒ¼ã‚¯ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯ãƒˆãƒƒãƒ—ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
<div style={{display:"flex",flexDirection:"column",gap:6}}>
{shortcuts.map((sc,i)=>(<div key={sc.id} style={{display:"flex",alignItems:"center",gap:8,padding:mob?"8px 10px":"10px 14px",borderRadius:12,background:sc.enabled?C.g50:"#fafafa",border:`1px solid ${sc.enabled?C.g200:"#eee"}`,opacity:sc.enabled?1:0.5}}>
<button onClick={()=>{const u=[...shortcuts];u[i]={...u[i],showOnTop:!u[i].showOnTop};setShortcuts(u)}} style={{padding:"2px 6px",borderRadius:6,border:sc.showOnTop?`2px solid ${C.p}`:`1px solid ${C.g200}`,background:sc.showOnTop?C.pLL:C.w,fontSize:11,color:sc.showOnTop?C.pD:C.g400,fontFamily:"inherit",cursor:"pointer",flexShrink:0}} title="ãƒˆãƒƒãƒ—ç”»é¢ã«è¡¨ç¤º">{sc.showOnTop?"â­":"â˜†"}</button>
<span style={{flex:1,fontSize:mob?13:14,fontWeight:600,color:C.g700}}>{sc.label}</span>
<span style={{padding:"4px 12px",borderRadius:8,background:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:mob?11:12,fontWeight:700,fontFamily:"monospace",letterSpacing:0.5,minWidth:50,textAlign:"center"}}>{sc.key}</span>
<button onClick={()=>{const u=[...shortcuts];u[i]={...u[i],enabled:!u[i].enabled};setShortcuts(u)}} style={{padding:"4px 10px",borderRadius:8,border:"none",background:sc.enabled?C.rG:C.g200,color:sc.enabled?C.w:C.g500,fontSize:11,fontWeight:700,fontFamily:"inherit",cursor:"pointer",flexShrink:0}}>{sc.enabled?"ON":"OFF"}</button>
</div>))}
</div>
<div style={{marginTop:16,padding:12,borderRadius:10,background:C.pLL,border:`1px solid ${C.p}33`}}>
<div style={{fontSize:12,fontWeight:700,color:C.pD,marginBottom:6}}>ðŸ’¡ ãƒ’ãƒ³ãƒˆ</div>
<div style={{fontSize:12,color:C.g500,lineHeight:1.8}}>
ãƒ»â­ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒˆãƒƒãƒ—ç”»é¢ã«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™<br/>
ãƒ»ON/OFFã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™<br/>
ãƒ»è¨­å®šç”»é¢ã§ã‚­ãƒ¼ã®å‰²ã‚Šå½“ã¦ã‚’å¤‰æ›´ã§ãã¾ã™<br/>
ãƒ»å°çª“ï¼ˆPiPï¼‰ã«ã‚‚â­ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
</div>
</div>
</div></div>);

// === ROOM SELECT ===
// === HELP PAGE ===
if(page==="help")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>ðŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2><button onClick={()=>{setPage("main")}} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<div style={{fontSize:14,color:C.g700,lineHeight:2}}>
<h3 style={{color:C.pD,fontSize:15}}>1. éƒ¨å±‹ã‚’é¸æŠž</h3>
<p>ãƒˆãƒƒãƒ—ç”»é¢ã§è¨ºå¯Ÿå®¤ãƒ»å‡¦ç½®å®¤ãªã©ã‚’é¸æŠžã—ã¾ã™ã€‚éƒ¨å±‹æƒ…å ±ã¯å±¥æ­´ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>2. æ‚£è€…æƒ…å ±ã‚’å…¥åŠ›</h3>
<p>æ‚£è€…åãƒ»æ‚£è€…IDã‚’å…¥åŠ›æ¬„ã«è¨˜å…¥ã—ã¾ã™ã€‚å±¥æ­´æ¤œç´¢ã«ä½¿ãˆã¾ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠž</h3>
<p>ASOPãƒ»ç–¾æ‚£åãƒ»ç¾Žå®¹ãƒ»å‡¦ç½®ãƒ»çµŒéŽãƒ»ãƒ•ãƒªãƒ¼ã®6ç¨®é¡žã‹ã‚‰é¸ã¹ã¾ã™ã€‚ç”¨é€”ã«åˆã‚ã›ã¦åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>4. éŒ²éŸ³é–‹å§‹</h3>
<p>ðŸŽ™ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨éŒ²éŸ³ãŒå§‹ã¾ã‚Šã¾ã™ã€‚5ç§’ã”ã¨ã«è‡ªå‹•ã§æ›¸ãèµ·ã“ã—ã•ã‚Œã¾ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>5. è¦ç´„</h3>
<p>âœ“è¦ç´„ãƒœã‚¿ãƒ³ã§éŒ²éŸ³ã‚’åœæ­¢ã—ã€AIãŒã‚«ãƒ«ãƒ†å½¢å¼ã§è¦ç´„ã—ã¾ã™ã€‚çµæžœã¯è‡ªå‹•ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>6. å°çª“ï¼ˆPiPï¼‰</h3>
<p>ðŸŒŸãƒœã‚¿ãƒ³ã§æœ€å‰é¢ã«å›ºå®šã•ã‚Œã‚‹å°çª“ã‚’è¡¨ç¤ºã€‚é›»å­ã‚«ãƒ«ãƒ†ã‚’æ“ä½œã—ãªãŒã‚‰éŒ²éŸ³ãƒ»è¦ç´„ãŒã§ãã¾ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>7. å±¥æ­´</h3>
<p>éŽåŽ»ã®è¦ç´„ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚ðŸ“‚å±¥æ­´ãƒœã‚¿ãƒ³ã‹ã‚‰æ¤œç´¢ãƒ»å¾©å…ƒãƒ»å‰Šé™¤ãŒå¯èƒ½ã§ã™ã€‚</p>
<h3 style={{color:C.pD,fontSize:15}}>8. è¨­å®š</h3>
<p>âš™ï¸ã‹ã‚‰èª¤å­—è„±å­—ä¿®æ­£è¾žæ›¸ã®ç®¡ç†ãŒã§ãã¾ã™ã€‚çš®è†šç§‘ã®è–¬å‰¤åãƒ»æ–½è¡“åãŒäº‹å‰ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
</div></div></div>);

// === ABOUT PAGE ===
if(page==="about")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>â„¹ï¸ æ©Ÿèƒ½ç´¹ä»‹</h2><button onClick={()=>{setPage("main")}} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<div style={{fontSize:14,color:C.g700,lineHeight:2}}>
<h3 style={{color:C.pD}}>ðŸŽ™ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°æ›¸ãèµ·ã“ã—</h3><p>OpenAI Whisper APIã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªæ—¥æœ¬èªžéŸ³å£°èªè­˜ã€‚5ç§’é–“éš”ã§è‡ªå‹•æ›¸ãèµ·ã“ã—ã€‚</p>
<h3 style={{color:C.pD}}>ðŸ¤– AIè¦ç´„</h3><p>Gemini 2.5 Flashã§ã‚«ãƒ«ãƒ†å½¢å¼ã«è‡ªå‹•è¦ç´„ã€‚è¤‡æ•°ç–¾æ‚£ã®è‡ªå‹•åˆ†é›¢ã«ã‚‚å¯¾å¿œã€‚</p>
<h3 style={{color:C.pD}}>ðŸ“‹ 6ç¨®é¡žã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3><p>ASOPãƒ»ç–¾æ‚£åãƒ»ç¾Žå®¹ãƒ»å‡¦ç½®ãƒ»çµŒéŽãƒ»ãƒ•ãƒªãƒ¼ã€‚è¤‡æ•°ç–¾æ‚£ã®è‡ªå‹•åˆ†é›¢ã«ã‚‚å¯¾å¿œã€‚</p>
<h3 style={{color:C.pD}}>ðŸ—£ è©±è€…åˆ†é›¢</h3><p>ä¼šè©±å†…å®¹ã‹ã‚‰åŒ»å¸«ã¨æ‚£è€…ã®ç™ºè¨€ã‚’è‡ªå‹•åˆ¤åˆ¥ã—ã€é©åˆ‡ãªé …ç›®ã«æŒ¯ã‚Šåˆ†ã‘ã¾ã™ã€‚</p>
<h3 style={{color:C.pD}}>ðŸ“– èª¤å­—è„±å­—ä¿®æ­£è¾žæ›¸</h3><p>çš®è†šç§‘ã®è–¬å‰¤åãƒ»æ–½è¡“åãƒ»ç–¾æ‚£åã‚’äº‹å‰ç™»éŒ²ã€‚æ›¸ãèµ·ã“ã—æ™‚ã«è‡ªå‹•ä¿®æ­£ã€‚</p>
<h3 style={{color:C.pD}}>ðŸŒŸ PiPå°çª“</h3><p>æœ€å‰é¢å›ºå®šã®å°çª“ã§ã€é›»å­ã‚«ãƒ«ãƒ†æ“ä½œä¸­ã‚‚éŒ²éŸ³ãƒ»è¦ç´„ãŒå¯èƒ½ã€‚</p>
<h3 style={{color:C.pD}}>ðŸ’¾ ã‚¯ãƒ©ã‚¦ãƒ‰å±¥æ­´</h3><p>Supabaseã«ã‚ˆã‚‹è‡ªå‹•ä¿å­˜ã€‚æ‚£è€…åãƒ»IDã§æ¤œç´¢å¯èƒ½ã€‚</p>
</div></div></div>);

// === HISTORY ===
if(page==="hist")return(<div style={{maxWidth:900,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
<h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>ðŸ“‚ è¨ºç™‚å±¥æ­´</h2>
<button onClick={()=>setPage("main")} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ðŸ” æ‚£è€…åãƒ»IDãƒ»å†…å®¹ã§æ¤œç´¢..." style={{...ib,width:"100%",marginBottom:12,padding:"10px 14px",boxSizing:"border-box"}}/>
{filteredHist.length===0?<p style={{color:C.g400,textAlign:"center",padding:40}}>è©²å½“ã™ã‚‹å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>:
filteredHist.map(h=>(<div key={h.id} style={{...card,marginBottom:10,padding:16,borderLeft:`3px solid ${C.p}`}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,flexWrap:"wrap",gap:6}}>
<div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
<span style={{fontSize:12,color:C.g500,fontWeight:500}}>{fmD(h.created_at)}</span>
{(h.patient_name||h.patient_id)&&<span style={{fontSize:12,padding:"2px 8px",borderRadius:8,background:"#fef3c7",color:"#92400e",fontWeight:600}}>{h.patient_name||""}{h.patient_id?` (${h.patient_id})`:""}</span>}
<span style={{fontSize:11,padding:"2px 8px",borderRadius:8,background:C.pLL,color:C.pD,fontWeight:600}}>{rn(h.room)}</span>
<span style={{fontSize:11,padding:"2px 8px",borderRadius:8,background:"#f0fdf4",color:C.rG,fontWeight:600}}>{tn(h.template)}</span></div>
<div style={{display:"flex",gap:4}}>
<button onClick={()=>{sInp(h.input_text);sOut(h.output_text);sPName(h.patient_name||"");sPId(h.patient_id||"");setPage("main")}} style={{padding:"4px 10px",borderRadius:8,border:`1px solid ${C.g200}`,background:C.w,fontSize:11,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‚ é–‹ã</button>
<button onClick={()=>cp(h.output_text)} style={{padding:"4px 10px",borderRadius:8,border:`1px solid ${C.g200}`,background:C.w,fontSize:11,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹</button>
<button onClick={()=>delRecord(h.id)} style={{padding:"4px 10px",borderRadius:8,border:"1px solid #fecaca",background:C.w,fontSize:11,fontFamily:"inherit",cursor:"pointer",color:C.err}}>ðŸ—‘</button></div></div>
<div style={{fontSize:13,color:C.g700,lineHeight:1.6,whiteSpace:"pre-wrap",maxHeight:80,overflow:"hidden"}}>{h.output_text}</div></div>))}
</div>);

// === DOC GENERATION ===
if(page==="doc")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>ðŸ“„ èª¬æ˜Žè³‡æ–™ã®ä½œæˆ</h2><button onClick={()=>setPage("main")} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<p style={{fontSize:13,color:C.g500,marginBottom:12}}>ç–¾æ‚£åã‚„æ–½è¡“åã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å½“é™¢ã®è¨ºç™‚å±¥æ­´ã‚’AIãŒå‚ç…§ã—ã¦æ‚£è€…å‘ã‘èª¬æ˜Žè³‡æ–™ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</p>
<div style={{display:"flex",gap:8,marginBottom:12,flexDirection:mob?"column":"row"}}>
<input value={docDisease} onChange={e=>setDocDisease(e.target.value)} placeholder="ç–¾æ‚£åãƒ»æ–½è¡“åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Žã€ãƒãƒ†ãƒ³ãƒ„ã‚¡ï¼‰" style={{...ib,flex:1,padding:"10px 14px",fontSize:14}}/>
<button onClick={generateDoc} disabled={docLd||!docDisease.trim()} style={{padding:"10px 20px",borderRadius:14,border:"none",background:docLd?C.g200:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer",opacity:!docDisease.trim()?.45:1}}>
{docLd?"â³ ç”Ÿæˆä¸­...":"âœ¨ ç”Ÿæˆ"}</button></div>
<div style={{display:"flex",gap:6,marginBottom:8,flexWrap:"wrap"}}>
{["ã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Ž","ã–ç˜¡ï¼ˆãƒ‹ã‚­ãƒ“ï¼‰","è•éº»ç–¹","ä¹¾ç™¬","å¸¯çŠ¶ç–±ç–¹","å°‹å¸¸æ€§ç–£è´…","è„‚æ¼æ€§çš®è†šç‚Ž","å††å½¢è„±æ¯›ç—‡","ç™½æ–‘","é…’ã•","ã‚·ãƒŸãƒ»è‚æ–‘","åŒ»ç™‚è„±æ¯›","ãƒãƒ†ãƒ³ãƒ„ã‚¡","ãƒŽãƒ¼ãƒªã‚¹ï¼ˆIPLï¼‰","ã‚¼ã‚ªã‚¹ã‚­ãƒ³","ãƒ”ãƒ¼ãƒªãƒ³ã‚°","å¤–ç”¨æ–¹æ³•ã®èª¬æ˜Ž","çš®è†šè…«ç˜åˆ‡é™¤è¡“å¾Œã®æ³¨æ„ç‚¹","ãƒ¬ãƒ¼ã‚¶ãƒ¼æ–½è¡“å¾Œã®æ³¨æ„ç‚¹","ãƒ”ãƒ¼ãƒªãƒ³ã‚°å¾Œã®æ³¨æ„ç‚¹"].map(d=>(<button key={d} onClick={()=>{setDocDisease(d)}} style={{padding:"3px 10px",borderRadius:8,border:`1px solid ${C.p}44`,background:C.pLL,fontSize:11,fontWeight:500,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>{d}</button>))}
</div>
<textarea value={docFreePrompt} onChange={e=>setDocFreePrompt(e.target.value)} placeholder="è¿½åŠ æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰ï¼šä¾‹ã€Œå°å…å‘ã‘ã«å¹³æ˜“ãªè¡¨ç¾ã§ã€ã€Œæ²»ç™‚è²»ã®ç›®å®‰æ¬„ã‚‚è¿½åŠ ã—ã¦ã€ã€Œè‹±èªžä½µè¨˜ã§ã€" rows={2} style={{...ib,width:"100%",padding:"8px 12px",fontSize:13,marginBottom:12,resize:"vertical",boxSizing:"border-box"}}/>
{docLd&&<div style={{textAlign:"center",padding:20}}><div style={{width:32,height:32,border:`3px solid ${C.g200}`,borderTop:`3px solid ${C.p}`,borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 10px"}}/><span style={{color:C.g500}}>AIãŒå±¥æ­´ã‚’åˆ†æžã—ã¦èª¬æ˜Žè³‡æ–™ã‚’ä½œæˆä¸­...</span></div>}
{docOut&&<div>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
<span style={{fontSize:13,fontWeight:700,color:C.pD}}>ðŸ“‹ {docDisease} èª¬æ˜Žè³‡æ–™</span>
<button onClick={()=>{navigator.clipboard.writeText(docOut)}} style={{padding:"4px 12px",borderRadius:10,border:`1px solid ${C.p}44`,background:C.w,fontSize:12,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
<textarea value={docOut} onChange={e=>setDocOut(e.target.value)} style={{width:"100%",height:400,padding:14,borderRadius:12,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.8,boxSizing:"border-box"}}/>
</div>}
</div></div>);

// === MINUTES ===
if(page==="minutes")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>ðŸ“ è­°äº‹éŒ²ã¾ã¨ã‚</h2><button onClick={()=>{minStop();setPage("main")}} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<p style={{fontSize:13,color:C.g500,marginBottom:12}}>ä¼šè­°ã‚„ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’éŒ²éŸ³ãƒ»æ›¸ãèµ·ã“ã—ã—ã€AIãŒè­°äº‹éŒ²ã‚’è‡ªå‹•ä½œæˆã—ã¾ã™ã€‚</p>
<textarea value={minPrompt} onChange={e=>setMinPrompt(e.target.value)} placeholder="AIã¸ã®è¿½åŠ æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰ï¼šä¾‹ã€Œé™¢å†…å‹‰å¼·ä¼šã®å½¢å¼ã§ã€ã€Œã‚¹ã‚¿ãƒƒãƒ•ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ã«ç°¡æ½”ã«ã€" rows={2} style={{...ib,width:"100%",padding:"8px 12px",fontSize:13,marginBottom:10,resize:"vertical",boxSizing:"border-box"}}/>
<div style={{display:"flex",alignItems:"center",gap:12,marginBottom:12}}>
<span style={{fontSize:24,fontWeight:700,fontVariantNumeric:"tabular-nums",color:C.pD}}>{String(Math.floor(minEl/60)).padStart(2,"0")}:{String(minEl%60).padStart(2,"0")}</span>
{minRS==="inactive"?<button onClick={minGo} style={{padding:"10px 24px",borderRadius:14,border:"none",background:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>ðŸŽ™ éŒ²éŸ³é–‹å§‹</button>:
<><button onClick={minSum} style={{padding:"10px 20px",borderRadius:14,border:"none",background:`linear-gradient(135deg,${C.pDD},${C.pD})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>âœ“ è¦ç´„</button>
<button onClick={minStop} style={{padding:"10px 16px",borderRadius:14,border:"none",background:C.err,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>â¹ åœæ­¢</button></>}
<span style={{fontSize:12,color:minRS==="recording"?C.rG:C.g400,fontWeight:600}}>{minRS==="recording"?"â— éŒ²éŸ³ä¸­":"åœæ­¢"}</span></div>
<div style={{marginBottom:12}}>
<div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{fontSize:12,fontWeight:600,color:C.g500}}>æ›¸ãèµ·ã“ã—ï¼ˆ10ç§’é–“éš”ï¼‰</span><span style={{fontSize:11,color:C.g400}}>{minInp.length>0?Math.ceil(minInp.length/40)+"è¡Œ":"æœªå…¥åŠ›"}</span></div>
<textarea value={minInp} onChange={e=>setMinInp(e.target.value)} placeholder="éŒ²éŸ³é–‹å§‹ã™ã‚‹ã¨è‡ªå‹•ã§æ›¸ãèµ·ã“ã•ã‚Œã¾ã™ã€‚æ‰‹å‹•å…¥åŠ›ã‚‚å¯èƒ½ã§ã™ã€‚" style={{width:"100%",height:120,padding:10,borderRadius:12,border:`1px solid ${C.g200}`,background:C.g50,fontSize:13,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.6,boxSizing:"border-box"}}/></div>
{minLd&&<div style={{textAlign:"center",padding:20}}><div style={{width:32,height:32,border:`3px solid ${C.g200}`,borderTop:`3px solid ${C.p}`,borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 10px"}}/><span style={{color:C.g500}}>AIãŒè­°äº‹éŒ²ã‚’ä½œæˆä¸­...</span></div>}
{minOut&&<div>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
<span style={{fontSize:13,fontWeight:700,color:C.pD}}>ðŸ“‹ è­°äº‹éŒ²</span>
<button onClick={()=>{navigator.clipboard.writeText(minOut)}} style={{padding:"4px 12px",borderRadius:10,border:`1px solid ${C.p}44`,background:C.w,fontSize:12,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
<textarea value={minOut} onChange={e=>setMinOut(e.target.value)} style={{width:"100%",height:300,padding:14,borderRadius:12,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.8,boxSizing:"border-box"}}/>
</div>}
</div></div>);

// === COUNSELING ANALYSIS ===
if(page==="counsel")return(<div style={{maxWidth:mob?"100%":700,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}><div style={card}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}><h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>ðŸ§  ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°åˆ†æž</h2><button onClick={()=>setPage("main")} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div>
<p style={{fontSize:13,color:C.g500,marginBottom:12}}>ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å†…å®¹ã‚’AIãŒå¤šè§’çš„ã«åˆ†æžã€‚å‚¾è´åŠ›ãƒ»ãƒ‹ãƒ¼ã‚ºæŠŠæ¡ãƒ»ææ¡ˆåŠ›ã®æ”¹å–„ã‚„ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆææ¡ˆã€å¹´é–“è¨ˆç”»ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<br/><span style={{fontSize:12,color:C.pD,fontWeight:600}}>ðŸ’¬ ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å±¥æ­´: {csCount}ä»¶ä¿å­˜æ¸ˆã¿ï¼ˆã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å®¤ã®è¨˜éŒ²ã‚’è‡ªå‹•è“„ç©ï¼‰</span></p>
<div style={{display:"flex",gap:4,marginBottom:10,flexWrap:"wrap"}}>
{[{k:"full",l:"ðŸ“Š ç·åˆåˆ†æž"},{k:"listening",l:"ðŸ‘‚ å‚¾è´ãƒ»å…±æ„Ÿ"},{k:"needs",l:"ðŸŽ¯ ãƒ‹ãƒ¼ã‚ºæŠŠæ¡"},{k:"marketing",l:"ðŸ’¡ ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°"},{k:"plan",l:"ðŸ“… å¹´é–“è¨ˆç”»"}].map(m=>(<button key={m.k} onClick={()=>setCsMode(m.k)} style={{padding:"5px 12px",borderRadius:10,border:csMode===m.k?`2px solid ${C.p}`:`1px solid ${C.g200}`,background:csMode===m.k?C.pLL:C.w,fontSize:12,fontWeight:csMode===m.k?700:500,color:csMode===m.k?C.pD:C.g500,fontFamily:"inherit",cursor:"pointer"}}>{m.l}</button>))}
</div>
<div style={{marginBottom:10}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
<span style={{fontSize:12,fontWeight:600,color:C.g500}}>åˆ†æžãƒ†ã‚­ã‚¹ãƒˆ</span>
<button onClick={()=>setCsTx(iR.current||"")} style={{padding:"3px 10px",borderRadius:8,border:`1px solid ${C.p}44`,background:C.pLL,fontSize:11,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹ æ›¸ãèµ·ã“ã—ã‹ã‚‰å–å¾—</button></div>
<textarea value={csTx} onChange={e=>setCsTx(e.target.value)} placeholder="ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å†…å®¹ã‚’å…¥åŠ›ã€ã¾ãŸã¯ã€Œæ›¸ãèµ·ã“ã—ã‹ã‚‰å–å¾—ã€ãƒœã‚¿ãƒ³ã§å–å¾—" style={{width:"100%",height:100,padding:10,borderRadius:10,border:`1px solid ${C.g200}`,fontSize:13,color:C.g700,fontFamily:"inherit",resize:"vertical",lineHeight:1.6,boxSizing:"border-box"}}/></div>
<button onClick={analyzeCounseling} disabled={csLd} style={{padding:"10px 24px",borderRadius:14,border:"none",background:csLd?C.g200:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer",marginBottom:12,width:"100%"}}>{csLd?"â³ AIåˆ†æžä¸­...":"ðŸ§  åˆ†æžé–‹å§‹"}</button>
{csLd&&<div style={{textAlign:"center",padding:20}}><div style={{width:32,height:32,border:`3px solid ${C.g200}`,borderTop:`3px solid ${C.p}`,borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 10px"}}/><span style={{color:C.g500}}>AIãŒåˆ†æžä¸­...</span></div>}
{csOut&&<div>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
<span style={{fontSize:13,fontWeight:700,color:C.pD}}>ðŸ“‹ åˆ†æžçµæžœ</span>
<button onClick={()=>navigator.clipboard.writeText(csOut)} style={{padding:"4px 12px",borderRadius:10,border:`1px solid ${C.p}44`,background:C.w,fontSize:12,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
<textarea value={csOut} onChange={e=>setCsOut(e.target.value)} style={{width:"100%",height:400,padding:14,borderRadius:12,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.8,boxSizing:"border-box"}}/>
</div>}
</div></div>);

// === SETTINGS ===
if(page==="settings")return(<div style={{maxWidth:900,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,flexWrap:"wrap",gap:8}}>
<h2 style={{fontSize:18,fontWeight:700,color:C.pDD,margin:0}}>âš™ï¸ è¨­å®š</h2>
<div style={{display:"flex",gap:8,alignItems:"center"}}>
{savedMsg&&<span style={{fontSize:12,color:C.rG,fontWeight:600}}>{savedMsg}</span>}
<button onClick={()=>{try{localStorage.setItem("mk_logo",logoUrl);localStorage.setItem("mk_logoSize",String(logoSize));localStorage.setItem("mk_dict",JSON.stringify(dict));localStorage.setItem("mk_snippets",JSON.stringify(snippets));localStorage.setItem("mk_pipSnippets",JSON.stringify(pipSnippets));localStorage.setItem("mk_audioSave",audioSave?"1":"0");localStorage.setItem("mk_dictEnabled",dictEnabled?"1":"0");localStorage.setItem("mk_shortcuts",JSON.stringify(shortcuts));setSavedMsg("âœ“ ä¿å­˜ã—ã¾ã—ãŸ");setTimeout(()=>setSavedMsg(""),3000)}catch(e){setSavedMsg("ä¿å­˜ã‚¨ãƒ©ãƒ¼")}}} style={{padding:"8px 20px",borderRadius:12,border:"none",background:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer",boxShadow:`0 2px 8px rgba(0,0,0,.1)`}}>ðŸ’¾ ä¿å­˜</button>
<button onClick={()=>setPage("main")} style={btn(C.p,C.pDD)}>âœ• é–‰ã˜ã‚‹</button></div></div>
{/* Logo */}
<div style={{...card,marginBottom:16}}>
<h3 style={{fontSize:15,fontWeight:700,color:C.pDD,marginBottom:8}}>ðŸ¥ éŽåŽ»ã‚«ãƒ«ãƒ†æƒ…å ±ï¼ˆ{pastCount}ä»¶ä¿å­˜æ¸ˆã¿ï¼‰</h3>
<p style={{fontSize:12,color:C.g400,marginBottom:8}}>é›»å­ã‚«ãƒ«ãƒ†ã®éŽåŽ»è¨˜éŒ²ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨ã€è¦ç´„ãƒ»èª¬æ˜Žè³‡æ–™ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆææ¡ˆã®ç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚</p>
<div style={{display:"flex",gap:8,marginBottom:8,alignItems:"center"}}>
<input value={pastDisease} onChange={e=>setPastDisease(e.target.value)} placeholder="ç–¾æ‚£åï¼ˆä»»æ„ï¼šçµžã‚Šè¾¼ã¿ç”¨ï¼‰" style={{...ib,width:160}}/>
<input value={pastSource} onChange={e=>setPastSource(e.target.value)} placeholder="å‡ºå…¸ï¼ˆä¾‹ï¼šORCAã€ãƒ¡ãƒ‡ã‚£ã‚³ãƒ ï¼‰" style={{...ib,width:160}}/>
<div onDragOver={e=>e.preventDefault()} onDrop={e=>{e.preventDefault();const f=e.dataTransfer.files[0];if(f)importPastFile(f)}} onClick={()=>{const i=document.createElement("input");i.type="file";i.accept=".txt,.csv,.tsv,.text";i.onchange=e=>{const f=e.target.files[0];if(f)importPastFile(f)};i.click()}} style={{padding:"6px 14px",borderRadius:10,border:`2px dashed ${C.g200}`,background:C.g50,fontSize:11,color:C.g500,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“ ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼</div></div>
<textarea value={pastInput} onChange={e=>setPastInput(e.target.value)} placeholder={"é›»å­ã‚«ãƒ«ãƒ†ã®å†…å®¹ã‚’ãƒšãƒ¼ã‚¹ãƒˆï¼ˆè¤‡æ•°ä»¶ã¯ç©ºè¡Œã§åŒºåˆ‡ã‚‹ï¼‰\n\nä¾‹ï¼š\nS: 2é€±é–“å‰ã‹ã‚‰é¡”é¢ã«ç´…æ–‘ã€ç—’ã¿\nO: ä¸¡é ¬ã«ç´…æ–‘ã€ä¸˜ç–¹æ•£åœ¨\nA: ã‚¢ãƒˆãƒ”ãƒ¼æ€§çš®è†šç‚Žã®å¢—æ‚ª\nP: ã‚¢ãƒ³ãƒ†ãƒ™ãƒ¼ãƒˆè»Ÿè† f/u 2w\n\nï¼ˆç©ºè¡Œï¼‰\n\nS: è¶³åº•ã®ã‚¤ãƒœã€å¢—å¤§å‚¾å‘\nO: å³è¶³åº•ã«ç–£è´… 5mm\nA: å°‹å¸¸æ€§ç–£è´…\nP: æ¶²ä½“çª’ç´ å‡çµ f/u 2w"} style={{width:"100%",height:120,padding:10,borderRadius:10,border:`1px solid ${C.g200}`,fontSize:12,color:C.g700,fontFamily:"inherit",resize:"vertical",lineHeight:1.6,boxSizing:"border-box",marginBottom:8}}/>
<div style={{display:"flex",gap:8,alignItems:"center"}}>
<button onClick={savePastRecords} disabled={pastLd||!pastInput.trim()} style={{padding:"8px 20px",borderRadius:10,border:"none",background:pastLd?C.g200:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:13,fontWeight:700,fontFamily:"inherit",cursor:"pointer",opacity:!pastInput.trim()?.45:1}}>{pastLd?"â³ ä¿å­˜ä¸­...":"ðŸ’¾ ã‚«ãƒ«ãƒ†ä¿å­˜"}</button>
{pastMsg&&<span style={{fontSize:12,color:pastMsg.includes("âœ“")?C.rG:C.err,fontWeight:600}}>{pastMsg}</span>}
</div></div>
<div style={{...card,marginBottom:16}}>
<h3 style={{fontSize:15,fontWeight:700,color:C.pDD,marginBottom:8}}>ðŸ”Š éŸ³å£°ä¿å­˜</h3>
<p style={{fontSize:12,color:C.g400,marginBottom:8}}>ONã«ã™ã‚‹ã¨è¨ºå¯Ÿã®éŸ³å£°ã‚’Supabase Storageã«ä¿å­˜ã—ã¾ã™ã€‚ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°åˆ†æžã‚„ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹å–„ã«æ´»ç”¨ã§ãã¾ã™ã€‚</p>
<div style={{display:"flex",alignItems:"center",gap:12}}>
<button onClick={()=>setAudioSave(!audioSave)} style={{padding:"6px 20px",borderRadius:10,border:"none",background:audioSave?C.rG:C.g200,color:audioSave?C.w:C.g500,fontSize:13,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>{audioSave?"ON":"OFF"}</button>
<span style={{fontSize:12,color:audioSave?C.rG:C.g400}}>{audioSave?"éŒ²éŸ³åœæ­¢æ™‚ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™":"éŸ³å£°ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“"}</span>
</div></div>
<div style={{...card,marginBottom:16}}>
<h3 style={{fontSize:mob?14:15,fontWeight:700,color:C.pDD,marginBottom:8}}>âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼è¨­å®š</h3>
<p style={{fontSize:12,color:C.g400,marginBottom:10}}>å„æ©Ÿèƒ½ã®ã‚­ãƒ¼å‰²ã‚Šå½“ã¦ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚â­=ãƒˆãƒƒãƒ—ç”»é¢ï¼‹å°çª“ã«è¡¨ç¤º</p>
<div style={{display:"flex",flexDirection:"column",gap:4}}>
{shortcuts.map((sc,i)=>(<div key={sc.id} style={{display:"flex",gap:6,alignItems:"center",padding:"4px 0",borderBottom:`1px solid ${C.g100}`}}>
<button onClick={()=>{const u=[...shortcuts];u[i]={...u[i],showOnTop:!u[i].showOnTop};setShortcuts(u)}} style={{padding:"2px 5px",borderRadius:6,border:sc.showOnTop?`2px solid ${C.p}`:`1px solid ${C.g200}`,background:sc.showOnTop?C.pLL:C.w,fontSize:9,color:sc.showOnTop?C.pD:C.g400,fontFamily:"inherit",cursor:"pointer",flexShrink:0}}>{sc.showOnTop?"â­":"â˜†"}</button>
<span style={{width:mob?100:140,fontSize:12,fontWeight:600,color:C.g700,flexShrink:0}}>{sc.label}</span>
<input value={sc.key} onChange={e=>{const u=[...shortcuts];u[i]={...u[i],key:e.target.value};setShortcuts(u)}} style={{width:80,padding:"3px 8px",borderRadius:8,border:`1.5px solid ${C.g200}`,fontSize:12,fontFamily:"monospace",fontWeight:700,color:C.pD,background:C.w,textAlign:"center",outline:"none"}}/>
<button onClick={()=>{const u=[...shortcuts];u[i]={...u[i],enabled:!u[i].enabled};setShortcuts(u)}} style={{padding:"3px 10px",borderRadius:6,border:"none",background:sc.enabled?C.rG:C.g200,color:sc.enabled?C.w:C.g500,fontSize:10,fontWeight:700,fontFamily:"inherit",cursor:"pointer",flexShrink:0}}>{sc.enabled?"ON":"OFF"}</button>
</div>))}
</div>
<div style={{display:"flex",gap:8,marginTop:8}}>
<button onClick={()=>setShortcuts(DEFAULT_SHORTCUTS)} style={{padding:"6px 14px",borderRadius:8,border:`1px solid ${C.g200}`,background:C.w,fontSize:11,fontWeight:600,color:C.g500,fontFamily:"inherit",cursor:"pointer"}}>åˆæœŸå€¤ã«æˆ»ã™</button>
</div>
</div>
<div style={{...card,marginBottom:16}}>
<h3 style={{fontSize:15,fontWeight:700,color:C.pDD,marginBottom:8}}>ðŸ–¼ ãƒ­ã‚´è¨­å®š</h3>
<p style={{fontSize:12,color:C.g400,marginBottom:8}}>ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
<div style={{display:"flex",gap:12,alignItems:"flex-start",marginBottom:8}}>
<div onDragOver={e=>{e.preventDefault()}} onDrop={e=>{e.preventDefault();const f=e.dataTransfer.files[0];if(f&&f.type.startsWith("image/")){const r=new FileReader();r.onload=ev=>setLogoUrl(ev.target.result);r.readAsDataURL(f)}}} onClick={()=>{const i=document.createElement("input");i.type="file";i.accept="image/*";i.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>setLogoUrl(ev.target.result);r.readAsDataURL(f)}};i.click()}} style={{width:80,height:80,borderRadius:12,border:"2px dashed "+C.g200,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",overflow:"hidden",flexShrink:0}}>
{logoUrl?<img src={logoUrl} alt="logo" style={{width:"100%",height:"100%",objectFit:"contain"}}/>:<span style={{fontSize:11,color:C.g400,textAlign:"center"}}>ã‚¯ãƒªãƒƒã‚¯<br/>or<br/>ãƒ‰ãƒ­ãƒƒãƒ—</span>}
</div>
<div>{logoUrl&&<button onClick={()=>setLogoUrl("")} style={{padding:"4px 12px",borderRadius:8,border:"1px solid "+C.g200,background:C.w,fontSize:12,color:C.err,fontFamily:"inherit",cursor:"pointer",marginBottom:6,display:"block"}}>ãƒ­ã‚´å‰Šé™¤</button>}
<div style={{display:"flex",gap:6,alignItems:"center"}}>
<span style={{fontSize:11,color:C.g500}}>ã‚µã‚¤ã‚º:</span>
{[24,32,40,48].map(s=>(<button key={s} onClick={()=>setLogoSize(s)} style={{padding:"3px 10px",borderRadius:6,border:logoSize===s?`2px solid ${C.p}`:`1px solid ${C.g200}`,background:logoSize===s?C.pLL:C.w,fontSize:11,fontWeight:logoSize===s?700:400,color:logoSize===s?C.pD:C.g500,fontFamily:"inherit",cursor:"pointer"}}>{s}px</button>))}
</div></div></div></div>
{/* Snippets */}
<div style={{...card,marginBottom:16}}>
<h3 style={{fontSize:15,fontWeight:700,color:C.pDD,marginBottom:8}}>ðŸ“Œ è¿½è¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ{snippets.length}ä»¶ï¼‰</h3>
<p style={{fontSize:12,color:C.g400,marginBottom:10}}>â­=å¸¸æ™‚è¡¨ç¤ºï¼‹å°çª“ / ä»–ã¯ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³</p>
<div style={{display:"flex",gap:8,marginBottom:10,alignItems:"center"}}>
<button onClick={suggestSnippets} disabled={suggestLd} style={{padding:"6px 16px",borderRadius:10,border:"none",background:suggestLd?C.g200:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:12,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>{suggestLd?"â³ åˆ†æžä¸­...":"ðŸ¤– AIãŒå±¥æ­´ã‹ã‚‰ææ¡ˆ"}</button>
<span style={{fontSize:11,color:C.g400}}>éŽåŽ»ã®è¦ç´„ã‹ã‚‰ã‚ˆãä½¿ã†ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è‡ªå‹•æŠ½å‡º</span></div>
{suggestedSnippets.length>0&&<div style={{marginBottom:12,padding:10,borderRadius:10,border:`1.5px solid ${C.p}44`,background:C.pLL}}>
<div style={{fontSize:12,fontWeight:700,color:C.pD,marginBottom:6}}>ðŸ¤– AIææ¡ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ ï¼‰</div>
<div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{suggestedSnippets.map((s,i)=>(<button key={i} onClick={()=>{if(s.title!=="ã‚¨ãƒ©ãƒ¼"&&s.title!=="å±¥æ­´ä¸è¶³"&&s.title!=="è§£æžã‚¨ãƒ©ãƒ¼"){setSnippets(prev=>[...prev,{title:s.title,text:s.text,cat:s.cat||"ãã®ä»–"}]);setSuggestedSnippets(prev=>prev.filter((_,j)=>j!==i))}}} style={{padding:"4px 10px",borderRadius:8,border:`1px solid ${C.p}`,background:C.w,fontSize:11,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}} title={s.text}>{s.cat?`[${s.cat}] `:""}{s.title}</button>))}</div>
<button onClick={()=>setSuggestedSnippets([])} style={{marginTop:6,padding:"2px 10px",borderRadius:6,border:`1px solid ${C.g200}`,background:C.w,fontSize:10,color:C.g400,fontFamily:"inherit",cursor:"pointer"}}>é–‰ã˜ã‚‹</button>
</div>}
<div style={{display:"flex",gap:4,marginBottom:6,flexWrap:"wrap"}}>
<input value={newSnTitle} onChange={e=>setNewSnTitle(e.target.value)} placeholder="ã‚¿ã‚¤ãƒˆãƒ«" style={{...ib,width:100}}/>
<input id="newSnCat" placeholder="ã‚«ãƒ†ã‚´ãƒª" style={{...ib,width:80}}/>
<input value={newSnText} onChange={e=>setNewSnText(e.target.value)} placeholder="è¿½è¨˜ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹" style={{...ib,flex:1}}/>
<button onClick={()=>{if(newSnTitle.trim()&&newSnText.trim()){const catEl=document.getElementById("newSnCat");setSnippets([...snippets,{title:newSnTitle.trim(),text:newSnText.trim(),cat:catEl?.value?.trim()||"ãã®ä»–"}]);setNewSnTitle("");setNewSnText("");if(catEl)catEl.value=""}}} style={btn(C.p,"#fff",{padding:"6px 14px",fontSize:13})}>è¿½åŠ </button></div>
<div style={{maxHeight:400,overflow:"auto"}}>
{snippets.map((sn,i)=>(<div key={i} style={{display:"flex",gap:3,alignItems:"flex-start",padding:"4px 0",borderBottom:"1px solid "+C.g100}}>
<button onClick={()=>{if(pipSnippets.includes(i)){setPipSnippets(pipSnippets.filter(x=>x!==i))}else{setPipSnippets([...pipSnippets,i])}}} style={{padding:"3px 5px",borderRadius:6,border:pipSnippets.includes(i)?`2px solid ${C.p}`:`1px solid ${C.g200}`,background:pipSnippets.includes(i)?C.pLL:C.w,fontSize:9,color:pipSnippets.includes(i)?C.pD:C.g400,fontFamily:"inherit",cursor:"pointer",flexShrink:0}} title="å¸¸æ™‚è¡¨ç¤º+å°çª“">{pipSnippets.includes(i)?"â­":"â˜†"}</button>
<input value={sn.cat||""} onChange={e=>{const u=[...snippets];u[i]={...u[i],cat:e.target.value};setSnippets(u)}} style={{...ib,width:60,padding:"3px 5px",fontSize:10,color:C.g500}} title="ã‚«ãƒ†ã‚´ãƒª"/>
<input value={sn.title} onChange={e=>{const u=[...snippets];u[i]={...u[i],title:e.target.value};setSnippets(u)}} style={{...ib,width:80,padding:"3px 5px",fontSize:11,fontWeight:700,color:C.pD}}/>
<textarea value={sn.text} onChange={e=>{const u=[...snippets];u[i]={...u[i],text:e.target.value};setSnippets(u)}} rows={1} onFocus={e=>{e.target.rows=Math.max(2,e.target.value.split("\n").length)}} onBlur={e=>{e.target.rows=1}} style={{...ib,flex:1,padding:"3px 5px",fontSize:10,color:C.g700,resize:"vertical",lineHeight:1.5}}/>
<button onClick={()=>{setSnippets(snippets.filter((_,j)=>j!==i));setPipSnippets(pipSnippets.filter(x=>x!==i).map(x=>x>i?x-1:x))}} style={{padding:"3px 6px",borderRadius:6,border:"1px solid #fecaca",background:C.w,fontSize:9,color:C.err,fontFamily:"inherit",cursor:"pointer",flexShrink:0}}>âœ•</button></div>))}</div></div>
{/* Dict */}
<div style={{...card,marginBottom:16}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
<h3 style={{fontSize:15,fontWeight:700,color:C.pDD,margin:0}}>ðŸ“– èª¤å­—è„±å­—ä¿®æ­£è¾žæ›¸ï¼ˆ{dict.length}ä»¶ï¼‰</h3>
<button onClick={()=>setDictEnabled(!dictEnabled)} style={{padding:"4px 14px",borderRadius:10,border:"none",background:dictEnabled?C.rG:C.g200,color:dictEnabled?C.w:C.g500,fontSize:12,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>{dictEnabled?"ON":"OFF"}</button></div>
<p style={{fontSize:12,color:C.g400,marginBottom:12}}>æ›¸ãèµ·ã“ã—çµæžœã«è‡ªå‹•é©ç”¨ã€‚å·¦ã®æ–‡å­—åˆ—ã‚’å³ã«ç½®æ›ã—ã¾ã™ã€‚</p>
<div style={{display:"flex",gap:6,marginBottom:12}}>
<input value={newFrom} onChange={e=>setNewFrom(e.target.value)} placeholder="å¤‰æ›å‰" style={{...ib,flex:1}}/>
<span style={{alignSelf:"center",color:C.g400}}>â†’</span>
<input value={newTo} onChange={e=>setNewTo(e.target.value)} placeholder="å¤‰æ›å¾Œ" style={{...ib,flex:1}}/>
<button onClick={()=>{if(newFrom.trim()&&newTo.trim()){setDict([[newFrom.trim(),newTo.trim()],...dict]);setNewFrom("");setNewTo("")}}} style={btn(C.p,C.pDD,{padding:"6px 14px",fontSize:13})}>è¿½åŠ </button></div>
<div style={{maxHeight:400,overflow:"auto"}}>
{dict.map((d,i)=>(<div key={i} style={{display:"flex",gap:6,alignItems:"center",padding:"4px 0",borderBottom:`1px solid ${C.g100}`}}>
<span style={{flex:1,fontSize:12,color:C.g500}}>{d[0]}</span>
<span style={{color:C.g400,fontSize:11}}>â†’</span>
<span style={{flex:1,fontSize:12,color:C.g900,fontWeight:600}}>{d[1]}</span>
<button onClick={()=>setDict(dict.filter((_,j)=>j!==i))} style={{padding:"2px 8px",borderRadius:6,border:"1px solid #fecaca",background:C.w,fontSize:10,color:C.err,fontFamily:"inherit",cursor:"pointer"}}>âœ•</button></div>))}</div></div>
</div>);

// === MAIN ===
return(<div style={{maxWidth:900,margin:"0 auto",padding:mob?"10px 8px":"20px 16px"}}>
<header style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,padding:mob?"8px 10px":"10px 16px",background:`linear-gradient(135deg,${C.pD},${C.p})`,borderRadius:16,boxShadow:`0 4px 16px rgba(13,148,136,.15)`}}>
<div style={{display:"flex",alignItems:"center",gap:8}}>{logoUrl?<img src={logoUrl} alt="logo" style={{width:logoSize,height:logoSize,borderRadius:6,objectFit:"contain"}}/>:<span style={{fontSize:18}}>ðŸ©º</span>}<span style={{fontWeight:700,fontSize:mob?12:14,color:C.w}}>å—è‰æ´¥çš®ãƒ•ç§‘AIã‚«ãƒ«ãƒ†è¦ç´„</span></div>
<div style={{display:"flex",alignItems:"center",gap:5}}><span style={{fontSize:9,color:"rgba(255,255,255,.45)",fontWeight:500}}>Gemini 2.5 Flash</span>{pc>0&&<span style={{fontSize:12,color:C.warn,fontWeight:600}}>â³</span>}<span style={{fontSize:11,color:st.includes("âœ“")?"#86efac":"rgba(255,255,255,.7)",fontWeight:st.includes("âœ“")?600:400}}>{st}</span></div></header>
<div style={{display:"flex",gap:4,marginBottom:8,flexWrap:"wrap"}}>
{[{p:"hist",i:"ðŸ“‚",t:"å±¥æ­´",f:()=>{loadHist();setPage("hist")}},{p:"settings",i:"âš™ï¸",t:"è¨­å®š"},{p:"doc",i:"ðŸ“„",t:"è³‡æ–™ä½œæˆ"},{p:"minutes",i:"ðŸ“",t:"è­°äº‹éŒ²"},{p:"counsel",i:"ðŸ§ ",t:"åˆ†æž"},{p:"shortcuts",i:"âŒ¨ï¸",t:"ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ"},{p:"help",i:"â“",t:"ãƒ˜ãƒ«ãƒ—"}].map(m=>(<button key={m.p} onClick={m.f||(()=>setPage(m.p))} style={{padding:mob?"4px 7px":"5px 10px",borderRadius:10,border:`1.5px solid ${C.g200}`,background:C.w,fontSize:mob?10:11,fontWeight:600,fontFamily:"inherit",cursor:"pointer",color:C.pD,display:"flex",alignItems:"center",gap:3}}><span style={{fontSize:14}}>{m.i}</span>{m.t}</button>))}</div>
<div style={{display:"flex",gap:4,marginBottom:8,flexWrap:mob?"nowrap":"wrap",overflowX:mob?"auto":"visible",WebkitOverflowScrolling:"touch",paddingBottom:mob?4:0}}>{R.map(rm=>(<button key={rm.id} onClick={()=>sRid(rm.id)} style={{padding:"5px 10px",borderRadius:10,fontSize:12,fontFamily:"inherit",cursor:"pointer",border:rid===rm.id?`2px solid ${C.pD}`:`1.5px solid ${C.g200}`,background:rid===rm.id?C.pL:C.w,fontWeight:rid===rm.id?700:500,color:rid===rm.id?C.pDD:C.g500,whiteSpace:"nowrap",flexShrink:0}}>{rm.l}</button>))}</div>
<div style={{display:"flex",gap:8,marginBottom:8,alignItems:"center"}}>
<span style={{fontSize:12,color:C.g500,flexShrink:0}}>ðŸŽ¤</span>
<select value={selectedMic} onChange={e=>setSelectedMic(e.target.value)} style={{flex:1,padding:"6px 10px",borderRadius:10,border:`1.5px solid ${C.g200}`,fontSize:12,fontFamily:"inherit",color:C.g700,background:C.w,cursor:"pointer"}}>
{micDevices.length===0?<option value="">ãƒžã‚¤ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>:micDevices.map((d,i)=>(<option key={d.deviceId} value={d.deviceId}>{d.label||`ãƒžã‚¤ã‚¯ ${i+1}`}</option>))}
</select>
<button onClick={loadMics} style={{padding:"5px 10px",borderRadius:8,border:`1px solid ${C.g200}`,background:C.w,fontSize:11,fontFamily:"inherit",cursor:"pointer",color:C.g500,flexShrink:0}}>ðŸ”„</button>
</div>
<div style={{display:"flex",gap:8,marginBottom:10,flexDirection:mob?"column":"row"}}>
<input value={pName} onChange={e=>sPName(e.target.value)} placeholder="ðŸ‘¤ æ‚£è€…å" style={{...ib,flex:1}}/>
<input value={pId} onChange={e=>sPId(e.target.value)} placeholder="ðŸ”¢ æ‚£è€…ID" style={{...ib,width:120}}/>
</div>
<div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:10}}>{T.map(t=>(<button key={t.id} onClick={()=>sTid(t.id)} style={{padding:mob?"4px 10px":"5px 12px",borderRadius:20,fontSize:mob?11:12,fontFamily:"inherit",cursor:"pointer",border:tid===t.id?`2px solid ${C.p}`:"2px solid transparent",background:tid===t.id?C.pLL:C.g100,fontWeight:tid===t.id?700:500,color:tid===t.id?C.pD:C.g500,transition:"all 0.15s"}}>{t.name}</button>))}</div>
{shortcuts.some(s=>s.showOnTop&&s.enabled)&&<div style={{display:"flex",gap:4,marginBottom:8,flexWrap:"wrap",padding:"6px 10px",borderRadius:12,background:C.pLL,border:`1px solid ${C.p}22`}}>
<span style={{fontSize:10,color:C.pD,fontWeight:600,alignSelf:"center",marginRight:4}}>âŒ¨ï¸</span>
{shortcuts.filter(s=>s.showOnTop&&s.enabled).map(sc=>(<button key={sc.id} onClick={()=>{
const actions={rec:()=>{if(rsRef.current==="recording"){stop()}else{go()}},sum:()=>sum(),clear:()=>{saveUndo();sInp("");sOut("");sSt("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")},next:()=>clr(),copy:()=>{if(out)cp(out)},pip:()=>{pipActive?closePip():openPip()},doc:()=>setPage("doc"),counsel:()=>setPage("counsel"),undo:()=>undo(),room1:()=>sRid("r1"),room2:()=>sRid("r2"),room3:()=>sRid("r3"),room4:()=>sRid("r4"),room5:()=>sRid("r5"),room6:()=>sRid("r6"),room7:()=>sRid("r7")};
const fn=actions[sc.id];if(fn)fn();
}} style={{padding:"3px 8px",borderRadius:8,border:`1px solid ${C.p}55`,background:C.w,fontSize:mob?10:11,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:3}}>
<span>{sc.label.split(" ")[0]}</span>
<span style={{fontSize:9,padding:"1px 4px",borderRadius:4,background:C.pD,color:C.w,fontFamily:"monospace",fontWeight:700}}>{sc.key}</span>
</button>))}
</div>}
<div style={{...card,position:"relative"}}>
<button onClick={pipActive?closePip:openPip} style={{position:"absolute",top:16,right:16,width:50,height:50,borderRadius:"50%",border:"none",background:pipActive?C.rG:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:11,fontWeight:700,fontFamily:"inherit",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,boxShadow:pipActive?`0 0 0 3px rgba(34,197,94,.3)`:`0 2px 8px rgba(13,148,136,.25)`}}>
<span style={{fontSize:18}}>ðŸŒŸ</span><span style={{fontSize:9}}>{pipActive?"OFF":"å°çª“"}</span></button>
<div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:10,marginBottom:16}}>
{rs!=="inactive"&&<span style={{fontSize:28,fontWeight:700,color:rs==="recording"?C.rG:C.warn,fontVariantNumeric:"tabular-nums"}}>{fm(el)}</span>}
{rs==="recording"&&<div style={{width:"60%",height:6,borderRadius:3,background:C.g200,overflow:"hidden"}}><div style={{width:`${lv}%`,height:"100%",background:`linear-gradient(90deg,${C.rG},${C.p})`,borderRadius:3,transition:"width 0.1s"}}/></div>}
<div style={{display:"flex",gap:12,alignItems:"center"}}>
{rs==="inactive"?(<button onClick={go} style={{...rb,width:mob?76:90,height:mob?76:90,background:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,boxShadow:`0 4px 14px rgba(13,148,136,.25)`}}><span style={{fontSize:30}}>ðŸŽ™</span><span style={{fontSize:12}}>éŒ²éŸ³é–‹å§‹</span></button>):(<>
{rs==="recording"?(<button onClick={pause} style={{...rb,width:60,height:60,background:C.warn,color:"#78350f"}}><span style={{fontSize:22}}>â¸</span></button>):(<button onClick={resume} style={{...rb,width:60,height:60,background:C.rG,color:C.w}}><span style={{fontSize:22}}>â–¶</span></button>)}
<button onClick={stopSum} style={{...rb,width:80,height:80,background:`linear-gradient(135deg,${C.pDD},${C.pD})`,color:C.w,boxShadow:`0 4px 14px rgba(13,148,136,.25)`}}><span style={{fontSize:20}}>âœ“</span><span style={{fontSize:12}}>è¦ç´„</span></button>
<button onClick={stop} style={{...rb,width:60,height:60,background:C.err,color:C.w}}><span style={{fontSize:22}}>â¹</span></button></>)}
</div>
{rs==="recording"&&<div style={{fontSize:12,color:C.g400}}>ðŸŽ™ 5ç§’ã”ã¨ã«è‡ªå‹•æ›¸ãèµ·ã“ã—</div>}
</div>
<div style={{marginBottom:14}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><label style={{fontSize:13,fontWeight:700,color:C.g500}}>ðŸ“ æ›¸ãèµ·ã“ã—</label><span style={{fontSize:12,color:C.g400}}>{inp.length}æ–‡å­—</span></div>
<textarea value={inp} onChange={e=>sInp(e.target.value)} placeholder="éŒ²éŸ³ãƒœã‚¿ãƒ³ã§éŸ³å£°ã‚’æ›¸ãèµ·ã“ã—ã€ã¾ãŸã¯ç›´æŽ¥å…¥åŠ›..." style={{width:"100%",height:mob?100:140,padding:mob?10:12,borderRadius:mob?10:14,border:`1.5px solid ${C.g200}`,background:C.g50,fontSize:14,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.7,boxSizing:"border-box"}}/></div>
<div style={{display:"flex",gap:mob?4:8,marginBottom:14,flexWrap:mob?"wrap":"nowrap"}}>
<button onClick={()=>sum()} disabled={ld||!inp.trim()} style={{flex:1,padding:"10px 0",borderRadius:14,border:"none",background:ld?C.g200:`linear-gradient(135deg,${C.pD},${C.p})`,color:C.w,fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer",opacity:!inp.trim()?.45:1,boxShadow:!ld&&inp.trim()?`0 4px 12px rgba(13,148,136,.25)`:"none"}}>{ld?"â³ å‡¦ç†ä¸­...":"âš¡ è¦ç´„"}</button>
<button onClick={()=>{saveUndo();sInp("");sOut("");sSt("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")}} style={{padding:"10px 16px",borderRadius:14,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,fontWeight:600,color:C.g500,fontFamily:"inherit",cursor:"pointer"}}>ðŸ—‘</button>
<button onClick={undo} style={{padding:"10px 14px",borderRadius:14,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,fontWeight:600,color:C.g500,fontFamily:"inherit",cursor:"pointer",opacity:undoRef.current?1:.35}} title="å…ƒã«æˆ»ã™ (Ctrl+Z)">â†©</button>
<button onClick={clr} style={{padding:"10px 20px",borderRadius:14,border:`2px solid ${C.p}`,background:C.w,fontSize:14,fontWeight:700,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>æ¬¡ã¸ â–¶</button></div>
{out&&<div style={{borderRadius:14,border:`2px solid ${C.pL}`,padding:16,background:`linear-gradient(135deg,${C.pLL},#f0fdf4)`}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><span style={{fontSize:13,fontWeight:700,color:C.pD}}>{ct.name} è¦ç´„çµæžœ</span><button onClick={()=>cp(out)} style={{padding:"4px 12px",borderRadius:10,border:`1px solid ${C.p}44`,background:C.w,fontSize:12,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>ðŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
<textarea value={out} onChange={e=>sOut(e.target.value)} style={{width:"100%",height:mob?140:180,padding:mob?10:12,borderRadius:mob?10:12,border:`1px solid ${C.g200}`,background:C.w,fontSize:14,color:C.g900,fontFamily:"inherit",resize:"vertical",lineHeight:1.7,boxSizing:"border-box"}}/>
{snippets.length>0&&<div style={{marginTop:8}}>
<div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:4}}>{snippets.map((sn,i)=>(pipSnippets.includes(i)?<button key={i} onClick={()=>sOut(o=>o+(o?"\n":"")+sn.text)} style={{padding:"4px 10px",borderRadius:10,border:`1.5px solid ${C.p}`,background:C.pLL,fontSize:12,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>â­{sn.title}</button>:null))}</div>
{[...new Set(snippets.map(s=>s.cat||"ãã®ä»–"))].map(cat=>{const items=snippets.map((s,i)=>({...s,idx:i})).filter(s=>(s.cat||"ãã®ä»–")===cat&&!pipSnippets.includes(s.idx));if(!items.length)return null;const isOpen=openCats.includes(cat);return(<div key={cat} style={{marginBottom:2}}>
<button onClick={()=>setOpenCats(o=>o.includes(cat)?o.filter(c=>c!==cat):[...o,cat])} style={{width:"100%",padding:"3px 8px",borderRadius:6,border:`1px solid ${C.g200}`,background:isOpen?C.pLL:C.g50,fontSize:11,fontWeight:600,color:C.pD,fontFamily:"inherit",cursor:"pointer",textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center"}}><span>{cat}ï¼ˆ{items.length}ï¼‰</span><span>{isOpen?"â–¼":"â–¶"}</span></button>
{isOpen&&<div style={{display:"flex",gap:4,flexWrap:"wrap",padding:"4px 0"}}>{items.map(sn=>(<button key={sn.idx} onClick={()=>sOut(o=>o+(o?"\n":"")+sn.text)} style={{padding:"3px 8px",borderRadius:8,border:`1px solid ${C.p}33`,background:C.w,fontSize:11,fontWeight:500,color:C.pD,fontFamily:"inherit",cursor:"pointer"}}>{sn.title}</button>))}</div>}
</div>)})}
</div>}
</div>}
{ld&&<div style={{textAlign:"center",padding:20}}><div style={{width:32,height:32,border:`3px solid ${C.g200}`,borderTop:`3px solid ${C.p}`,borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 10px"}}/><span style={{color:C.g500}}>AIãŒè¦ç´„ã‚’ä½œæˆä¸­...</span></div>}
</div></div>);}