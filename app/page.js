"use client";
import { useState, useRef, useEffect } from "react";
import { supabase } from "./lib/supabase";
const T=[{id:"soap",name:"ğŸ“‹ ASOP",prompt:"ã‚ãªãŸã¯çš®è†šç§‘å°‚é–€ã®åŒ»ç™‚ç§˜æ›¸ã§ã™ã€‚ASOPå½¢å¼ã§è¦ç´„ã€‚\nâ–  Aï¼ˆè©•ä¾¡ãƒ»è¨ºæ–­åï¼‰\nâ–  Sï¼ˆæ‚£è€…ã®ä¸»è¨´ï¼‰\nâ–  Oï¼ˆåŒ»å¸«ã®æ‰€è¦‹ï¼‰\nâ–  Pï¼ˆæ²»ç™‚è¨ˆç”»ãƒ»å‡¦æ–¹ï¼‰\nâ–  æ‚£è€…æƒ…å ±ï¼ˆè¨€åŠã‚ã‚Œã°ï¼‰\nä¼šè©±ã®æƒ…å ±ã®ã¿è¨˜è¼‰ã€‚æ¨æ¸¬ã—ãªã„ã€‚è¨€åŠãªã—ã¯ã€Œè¨€åŠãªã—ã€ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚"},{id:"disease",name:"ğŸ¥ ç–¾æ‚£å",prompt:"çš®è†šç§‘åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦ç–¾æ‚£æƒ…å ±ã‚’æŠ½å‡ºã€‚\nâ–  ç–¾æ‚£åï¼ˆæ­£å¼åç§°ï¼‰\nâ–  éƒ¨ä½\nâ–  é‡ç—‡åº¦\nâ–  æ—¢å¾€æ­´\nâ–  é‘‘åˆ¥è¨ºæ–­ï¼ˆè¨€åŠæ™‚ã®ã¿ï¼‰\næ¨æ¸¬ã—ãªã„ã€‚åŒ»å­¦ç”¨èªä½¿ç”¨ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚"},{id:"cosmetic",name:"âœ¨ ç¾å®¹",prompt:"ç¾å®¹çš®è†šç§‘ã®åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦æ–½è¡“è¨˜éŒ²ã‚’è¦ç´„ã€‚\nâ–  æ–½è¡“å\nâ–  æ–½è¡“éƒ¨ä½\nâ–  æ‚£è€…ã®å¸Œæœ›\nâ–  æ–½è¡“å†…å®¹ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿\nâ–  ä½¿ç”¨è–¬å‰¤ãƒ»æ©Ÿå™¨\nâ–  è¡“å¾Œæ³¨æ„äº‹é …\nâ–  æ¬¡å›äºˆå®š\nä¼šè©±ã®æƒ…å ±ã®ã¿ã€‚ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã€‚"},{id:"procedure",name:"ğŸ”§ å‡¦ç½®",prompt:"çš®è†šç§‘åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦å‡¦ç½®è¨˜éŒ²ã‚’è¦ç´„ã€‚\nâ–  å‡¦ç½®å\nâ–  éƒ¨ä½ãƒ»ç¯„å›²\nâ–  éº»é…”\nâ–  å‡¦ç½®å†…å®¹\nâ–  ä½¿ç”¨å™¨å…·\nâ–  æ¤œä½“æå‡º\nâ–  è¡“å¾ŒæŒ‡ç¤ºãƒ»å‡¦æ–¹\nâ–  æ¬¡å›äºˆå®š\næ‰‹é †ã¯æ™‚ç³»åˆ—ã€‚æ•°å€¤ã¯æ­£ç¢ºã«ã€‚"},{id:"followup",name:"ğŸ”„ çµŒé",prompt:"çš®è†šç§‘åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦çµŒéè¨˜éŒ²ã‚’è¦ç´„ã€‚\nâ–  ç–¾æ‚£å\nâ–  å‰å›ã‹ã‚‰ã®çµŒé\nâ–  ç¾åœ¨ã®ç—‡çŠ¶\nâ–  ç¾åœ¨ã®æ‰€è¦‹\nâ–  æ²»ç™‚åŠ¹æœåˆ¤å®š\nâ–  ä»Šå¾Œã®æ–¹é‡\nâ–  æ¬¡å›äºˆå®š\nå‰å›æ¯”è¼ƒã‚’æ˜è¨˜ã€‚"},{id:"free",name:"ğŸ“ ãƒ•ãƒªãƒ¼",prompt:"çš®è†šç§‘åŒ»ç™‚ç§˜æ›¸ã¨ã—ã¦ç°¡æ½”ã«è¦ç´„ã€‚åŒ»å­¦ç”¨èªã¯æ­£å¼åç§°ã€‚æ™‚ç³»åˆ—ã§æ•´ç†ã€‚æ¨æ¸¬ã—ãªã„ã€‚"}];
const R=[{id:"r1",l:"è¨ºå¯Ÿå®¤1",i:"1ï¸âƒ£"},{id:"r2",l:"è¨ºå¯Ÿå®¤2",i:"2ï¸âƒ£"},{id:"r3",l:"è¨ºå¯Ÿå®¤3",i:"3ï¸âƒ£"},{id:"r4",l:"å‡¦ç½®å®¤",i:"ğŸ”§"},{id:"r5",l:"ç¾å®¹å®¤",i:"âœ¨"},{id:"r6",l:"ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°",i:"ğŸ’¬"},{id:"r7",l:"ãã®ä»–",i:"ğŸ“‹"}];
export default function Home(){
const[rs,sRS]=useState("inactive"),[inp,sInp]=useState(""),[out,sOut]=useState(""),[st,sSt]=useState("å¾…æ©Ÿä¸­"),[el,sEl]=useState(0),[ld,sLd]=useState(false),[lv,sLv]=useState(0),[md,sMd]=useState("gemini"),[pc,sPC]=useState(0),[tid,sTid]=useState("soap"),[rid,sRid]=useState("");
const[hist,sHist]=useState([]),[showHist,setShowHist]=useState(false),[search,setSearch]=useState("");
const[pName,sPName]=useState(""),[pId,sPId]=useState("");
const mR=useRef(null),msR=useRef(null),acR=useRef(null),anR=useRef(null),laR=useRef(null),tR=useRef(null),cR=useRef(null),iR=useRef("");
useEffect(()=>{iR.current=inp},[inp]);
useEffect(()=>{if(rs==="recording"){tR.current=setInterval(()=>sEl(t=>t+1),1000)}else{clearInterval(tR.current);if(rs==="inactive")sEl(0)}return()=>clearInterval(tR.current)},[rs]);
const fm=s=>`${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
const ct=T.find(t=>t.id===tid)||T[0],cr=R.find(r=>r.id===rid);
const saveRecord=async(input,output)=>{if(!supabase)return;try{await supabase.from("records").insert({room:rid,template:tid,ai_model:md,input_text:input,output_text:output,patient_name:pName,patient_id:pId})}catch(e){console.error("Save error:",e)}};
const loadHist=async()=>{if(!supabase)return;try{let q=supabase.from("records").select("*").order("created_at",{ascending:false}).limit(50);const{data}=await q;if(data)sHist(data)}catch(e){console.error("Load error:",e)}};
const delRecord=async(id)=>{if(!supabase)return;try{await supabase.from("records").delete().eq("id",id);sHist(h=>h.filter(r=>r.id!==id))}catch(e){console.error("Delete error:",e)}};
const filteredHist=hist.filter(h=>{if(!search.trim())return true;const s=search.toLowerCase();return(h.patient_name||"").toLowerCase().includes(s)||(h.patient_id||"").toLowerCase().includes(s)||(h.output_text||"").toLowerCase().includes(s)});
const sAM=async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:true});msR.current=s;const c=new(window.AudioContext||window.webkitAudioContext)(),sr=c.createMediaStreamSource(s),a=c.createAnalyser();a.fftSize=256;a.smoothingTimeConstant=0.7;sr.connect(a);acR.current=c;anR.current=a;const d=new Uint8Array(a.frequencyBinCount),tk=()=>{if(!anR.current)return;anR.current.getByteFrequencyData(d);let sm=0;for(let i=0;i<d.length;i++)sm+=d[i];sLv(Math.min(100,Math.round((sm/d.length/128)*100)));laR.current=requestAnimationFrame(tk)};laR.current=requestAnimationFrame(tk);return s}catch{sSt("ãƒã‚¤ã‚¯å–å¾—å¤±æ•—");return null}};
const xAM=()=>{if(laR.current)cancelAnimationFrame(laR.current);laR.current=null;if(acR.current){try{acR.current.close()}catch{}}acR.current=null;if(msR.current){msR.current.getTracks().forEach(t=>t.stop())}msR.current=null;anR.current=null;sLv(0)};
const tc=async(b)=>{if(b.size<500)return;sPC(p=>p+1);sSt("ğŸ”„ æ›¸ãèµ·ã“ã—ä¸­...");try{const f=new FormData();f.append("audio",b,"audio.webm");const r=await fetch("/api/transcribe",{method:"POST",body:f}),d=await r.json();if(d.text&&d.text.trim()){sInp(p=>p+(p?"\n":"")+d.text.trim());sSt("éŒ²éŸ³ä¸­ âœ“")}else{sSt("éŒ²éŸ³ä¸­")}}catch{sSt("éŒ²éŸ³ä¸­ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰")}finally{sPC(p=>Math.max(0,p-1))}};
const cMR=(s)=>{const m=new MediaRecorder(s,{mimeType:MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":"audio/webm"});m.ondataavailable=(e)=>{if(e.data.size>0)tc(e.data)};return m};
const go=async()=>{const s=await sAM();if(!s)return;sRS("recording");sSt("éŒ²éŸ³ä¸­");const m=cMR(s);m.start();mR.current=m;cR.current=setInterval(()=>{if(mR.current&&mR.current.state==="recording"){mR.current.stop();const m2=cMR(s);m2.start();mR.current=m2}},5000)};
const stop=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording")mR.current.stop();mR.current=null;xAM();sRS("inactive");sSt("å¾…æ©Ÿä¸­")};
const pause=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording")mR.current.stop();sRS("paused");sSt("ä¸€æ™‚åœæ­¢")};
const resume=()=>{if(!msR.current)return;sRS("recording");sSt("éŒ²éŸ³ä¸­");const m=cMR(msR.current);m.start();mR.current=m;cR.current=setInterval(()=>{if(mR.current&&mR.current.state==="recording"){mR.current.stop();const m2=cMR(msR.current);m2.start();mR.current=m2}},5000)};
const sum=async(tx)=>{const t=tx||iR.current;if(!t.trim()){sSt("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}sLd(true);sSt(md==="claude"?"Claude ã§è¦ç´„ä¸­...":"Gemini ã§è¦ç´„ä¸­...");try{const r=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,mode:md,prompt:ct.prompt})}),d=await r.json();if(d.error){sSt("ã‚¨ãƒ©ãƒ¼: "+d.error);return}sOut(d.summary);await saveRecord(t,d.summary);try{await navigator.clipboard.writeText(d.summary);sSt("è¦ç´„å®Œäº†ãƒ»ä¿å­˜æ¸ˆã¿ âœ“")}catch{sSt("è¦ç´„å®Œäº†ãƒ»ä¿å­˜æ¸ˆã¿")}}catch{sSt("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{sLd(false)}};
const stopSum=()=>{clearInterval(cR.current);if(mR.current&&mR.current.state==="recording"){const cr2=mR.current;cr2.ondataavailable=async(e)=>{if(e.data.size>0){const f=new FormData();f.append("audio",e.data,"audio.webm");try{const r=await fetch("/api/transcribe",{method:"POST",body:f}),d=await r.json();if(d.text&&d.text.trim()){const ft=iR.current+(iR.current?"\n":"")+d.text.trim();sInp(ft);setTimeout(()=>sum(ft),300)}else{sum()}}catch{sum()}}else{sum()}};cr2.stop()}else{sum()}mR.current=null;xAM();sRS("inactive")};
const clr=()=>{sInp("");sOut("");sSt("å¾…æ©Ÿä¸­");sEl(0);sPName("");sPId("")};
const cp=async(t)=>{try{await navigator.clipboard.writeText(t);sSt("ã‚³ãƒ”ãƒ¼æ¸ˆã¿ âœ“")}catch{}};
const ac="#6366f1",aD="#4338ca",aS="#eef2ff",rG="#22c55e";
const rb={width:74,height:74,borderRadius:"50%",border:"none",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,fontFamily:"inherit",fontWeight:700,fontSize:10,boxShadow:"0 4px 14px rgba(99,102,241,.25)",cursor:"pointer"};
const fmD=(d)=>{const dt=new Date(d);return `${dt.getMonth()+1}/${dt.getDate()} ${dt.getHours()}:${String(dt.getMinutes()).padStart(2,"0")}`};
const tn=(id)=>{const t=T.find(x=>x.id===id);return t?t.name:id};
const rn=(id)=>{const r=R.find(x=>x.id===id);return r?`${r.i}${r.l}`:id};
const ib={padding:"8px 12px",borderRadius:10,border:"1px solid #e2e8f0",fontSize:13,fontFamily:"inherit",outline:"none",background:"#fff",color:"#1a1a1a"};
if(!rid)return(<div style={{maxWidth:600,margin:"0 auto",padding:"40px 16px"}}><div style={{background:"linear-gradient(135deg,#6366f1 0%,#8b5cf6 100%)",borderRadius:24,padding:"40px 24px",boxShadow:"0 8px 32px rgba(99,102,241,.25)",textAlign:"center"}}>
<div style={{width:48,height:48,borderRadius:16,background:"rgba(255,255,255,.2)",margin:"0 auto 16px",display:"flex",alignItems:"center",justifyContent:"center"}}><span style={{fontSize:24}}>ğŸ©º</span></div>
<h1 style={{fontSize:22,fontWeight:700,color:"#fff",marginBottom:4}}>AIè¨ºç™‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h1><p style={{fontSize:14,color:"rgba(255,255,255,.8)",marginBottom:28}}>éƒ¨å±‹ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
<div style={{display:"flex",flexWrap:"wrap",gap:10,justifyContent:"center"}}>{R.map(rm=>(<button key={rm.id} onClick={()=>sRid(rm.id)} style={{padding:"14px 20px",borderRadius:14,border:"none",background:"rgba(255,255,255,.95)",fontSize:14,fontWeight:600,fontFamily:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:8,minWidth:140,boxShadow:"0 2px 8px rgba(0,0,0,.1)",transition:"transform 0.15s"}} onMouseEnter={e=>e.currentTarget.style.transform="scale(1.03)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}><span style={{fontSize:20}}>{rm.i}</span>{rm.l}</button>))}</div></div></div>);
if(showHist)return(<div style={{maxWidth:900,margin:"0 auto",padding:"20px 16px"}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
<h2 style={{fontSize:18,fontWeight:700,margin:0}}>ğŸ“‚ è¨ºç™‚å±¥æ­´</h2>
<button onClick={()=>setShowHist(false)} style={{padding:"8px 20px",borderRadius:12,border:"none",background:ac,color:"#fff",fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer"}}>âœ• é–‰ã˜ã‚‹</button></div>
<input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ğŸ” æ‚£è€…åãƒ»IDãƒ»å†…å®¹ã§æ¤œç´¢..." style={{...ib,width:"100%",marginBottom:12,padding:"10px 14px",boxSizing:"border-box"}}/>
{filteredHist.length===0?<p style={{color:"#94a3b8",textAlign:"center",padding:40}}>è©²å½“ã™ã‚‹å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>:
filteredHist.map(h=>(<div key={h.id} style={{background:"#fff",borderRadius:14,padding:16,marginBottom:10,boxShadow:"0 2px 8px rgba(0,0,0,.04)",borderLeft:`3px solid ${ac}`}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,flexWrap:"wrap",gap:6}}>
<div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
<span style={{fontSize:12,color:"#64748b",fontWeight:500}}>{fmD(h.created_at)}</span>
{(h.patient_name||h.patient_id)&&<span style={{fontSize:12,padding:"2px 8px",borderRadius:8,background:"#fef3c7",color:"#92400e",fontWeight:600}}>{h.patient_name||""}{h.patient_id?` (${h.patient_id})`:""}</span>}
<span style={{fontSize:11,padding:"2px 8px",borderRadius:8,background:aS,color:aD,fontWeight:600}}>{rn(h.room)}</span>
<span style={{fontSize:11,padding:"2px 8px",borderRadius:8,background:"#f0fdf4",color:"#16a34a",fontWeight:600}}>{tn(h.template)}</span></div>
<div style={{display:"flex",gap:4}}>
<button onClick={()=>{sInp(h.input_text);sOut(h.output_text);sPName(h.patient_name||"");sPId(h.patient_id||"");setShowHist(false)}} style={{padding:"4px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",fontSize:11,fontFamily:"inherit",cursor:"pointer"}}>ğŸ“‚ é–‹ã</button>
<button onClick={()=>cp(h.output_text)} style={{padding:"4px 10px",borderRadius:8,border:"1px solid #e2e8f0",background:"#fff",fontSize:11,fontFamily:"inherit",cursor:"pointer"}}>ğŸ“‹</button>
<button onClick={()=>delRecord(h.id)} style={{padding:"4px 10px",borderRadius:8,border:"1px solid #fecaca",background:"#fff",fontSize:11,fontFamily:"inherit",cursor:"pointer",color:"#ef4444"}}>ğŸ—‘</button></div></div>
<div style={{fontSize:13,color:"#374151",lineHeight:1.6,whiteSpace:"pre-wrap",maxHeight:80,overflow:"hidden"}}>{h.output_text}</div></div>))}
</div>);
return(<div style={{maxWidth:900,margin:"0 auto",padding:"20px 16px"}}>
<header style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,padding:"10px 16px",background:"linear-gradient(135deg,#6366f1,#8b5cf6)",borderRadius:16,boxShadow:"0 4px 16px rgba(99,102,241,.2)"}}>
<div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:18}}>ğŸ©º</span><span style={{fontWeight:700,fontSize:15,color:"#fff"}}>AIè¨ºç™‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</span><span style={{fontSize:11,padding:"2px 8px",borderRadius:10,background:"rgba(255,255,255,.2)",color:"#fff",fontWeight:600}}>{cr?.i} {cr?.l}</span><button onClick={()=>{stop();sRid("")}} style={{fontSize:11,padding:"2px 8px",borderRadius:10,border:"1px solid rgba(255,255,255,.3)",background:"transparent",color:"rgba(255,255,255,.9)",fontFamily:"inherit",cursor:"pointer"}}>å¤‰æ›´</button></div>
<div style={{display:"flex",alignItems:"center",gap:6}}>{pc>0&&<span style={{fontSize:12,color:"#fbbf24",fontWeight:600}}>â³</span>}<span style={{fontSize:12,color:st.includes("âœ“")?"#86efac":"rgba(255,255,255,.8)",fontWeight:st.includes("âœ“")?600:400}}>{st}</span>
<button onClick={()=>{loadHist();setShowHist(true)}} style={{fontSize:11,padding:"4px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,.3)",background:"rgba(255,255,255,.15)",color:"#fff",fontFamily:"inherit",cursor:"pointer",fontWeight:600}}>ğŸ“‚ å±¥æ­´</button></div></header>
<div style={{display:"flex",gap:8,marginBottom:10}}>
<input value={pName} onChange={e=>sPName(e.target.value)} placeholder="ğŸ‘¤ æ‚£è€…å" style={{...ib,flex:1}}/>
<input value={pId} onChange={e=>sPId(e.target.value)} placeholder="ğŸ”¢ æ‚£è€…ID" style={{...ib,width:120}}/>
</div>
<div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:10}}>{T.map(t=>(<button key={t.id} onClick={()=>sTid(t.id)} style={{padding:"5px 12px",borderRadius:20,fontSize:12,fontFamily:"inherit",cursor:"pointer",border:tid===t.id?`2px solid ${ac}`:"2px solid transparent",background:tid===t.id?aS:"#f1f5f9",fontWeight:tid===t.id?700:500,color:tid===t.id?aD:"#64748b",transition:"all 0.15s"}}>{t.name}</button>))}</div>
<div style={{background:"#fff",borderRadius:20,padding:"20px",boxShadow:"0 4px 24px rgba(0,0,0,.05)"}}>
<div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:10,marginBottom:16}}>
{rs!=="inactive"&&<span style={{fontSize:28,fontWeight:700,color:rs==="recording"?rG:"#d97706",fontVariantNumeric:"tabular-nums"}}>{fm(el)}</span>}
{rs==="recording"&&<div style={{width:"60%",height:6,borderRadius:3,background:"#e2e8f0",overflow:"hidden"}}><div style={{width:`${lv}%`,height:"100%",background:`linear-gradient(90deg,${rG},#4ade80)`,borderRadius:3,transition:"width 0.1s"}}/></div>}
<div style={{display:"flex",gap:12,alignItems:"center"}}>
{rs==="inactive"?(<button onClick={go} style={{...rb,background:`linear-gradient(135deg,${ac},#8b5cf6)`,color:"#fff"}}><span style={{fontSize:24}}>ğŸ™</span><span>ã‚¿ãƒƒãƒ—ã§é–‹å§‹</span></button>):(<>
{rs==="recording"?(<button onClick={pause} style={{...rb,width:56,height:56,background:"#fbbf24",color:"#78350f"}}><span style={{fontSize:22}}>â¸</span></button>):(<button onClick={resume} style={{...rb,width:56,height:56,background:rG,color:"#fff"}}><span style={{fontSize:22}}>â–¶</span></button>)}
<button onClick={stopSum} style={{...rb,background:`linear-gradient(135deg,${aD},#6d28d9)`,color:"#fff"}}><span style={{fontSize:16}}>âœ“</span><span>è¦ç´„</span></button>
<button onClick={stop} style={{...rb,width:56,height:56,background:"#ef4444",color:"#fff"}}><span style={{fontSize:22}}>â¹</span></button></>)}
</div>
<div style={{display:"flex",gap:2,background:"#f1f5f9",borderRadius:20,padding:2}}>
<button onClick={()=>sMd("gemini")} style={{padding:"6px 16px",borderRadius:18,border:"none",fontSize:13,fontWeight:md==="gemini"?700:400,background:md==="gemini"?"#fff":"transparent",color:md==="gemini"?aD:"#64748b",fontFamily:"inherit",cursor:"pointer",boxShadow:md==="gemini"?"0 1px 4px rgba(0,0,0,.08)":"none"}}>âš¡ Gemini</button>
<button onClick={()=>sMd("claude")} style={{padding:"6px 16px",borderRadius:18,border:"none",fontSize:13,fontWeight:md==="claude"?700:400,background:md==="claude"?"#fff":"transparent",color:md==="claude"?aD:"#64748b",fontFamily:"inherit",cursor:"pointer",boxShadow:md==="claude"?"0 1px 4px rgba(0,0,0,.08)":"none"}}>ğŸ§  Claude</button></div>
{rs==="recording"&&<div style={{fontSize:12,color:"#94a3b8"}}>ğŸ™ 5ç§’ã”ã¨ã«è‡ªå‹•æ›¸ãèµ·ã“ã—</div>}
</div>
<div style={{marginBottom:14}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><label style={{fontSize:13,fontWeight:700,color:"#64748b"}}>ğŸ“ æ›¸ãèµ·ã“ã—</label><span style={{fontSize:12,color:"#94a3b8"}}>{inp.length}æ–‡å­—</span></div>
<textarea value={inp} onChange={e=>sInp(e.target.value)} placeholder="éŒ²éŸ³ãƒœã‚¿ãƒ³ã§éŸ³å£°ã‚’æ›¸ãèµ·ã“ã—ã€ã¾ãŸã¯ç›´æ¥å…¥åŠ›..." style={{width:"100%",height:140,padding:12,borderRadius:14,border:"1px solid #e2e8f0",background:"#fafafa",fontSize:14,color:"#1a1a1a",fontFamily:"inherit",resize:"vertical",lineHeight:1.7,boxSizing:"border-box"}}/></div>
<div style={{display:"flex",gap:8,marginBottom:14}}>
<button onClick={()=>sum()} disabled={ld||!inp.trim()} style={{flex:1,padding:"10px 0",borderRadius:12,border:"none",background:ld?"#e2e8f0":`linear-gradient(135deg,${ac},#8b5cf6)`,color:"#fff",fontSize:14,fontWeight:700,fontFamily:"inherit",cursor:"pointer",opacity:!inp.trim()?.45:1,boxShadow:!ld&&inp.trim()?"0 4px 12px rgba(99,102,241,.3)":"none"}}>{ld?"â³ å‡¦ç†ä¸­...":`${md==="claude"?"ğŸ§  Claude":"âš¡ Gemini"} ã§è¦ç´„`}</button>
<button onClick={clr} style={{padding:"10px 20px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",fontSize:14,fontWeight:600,color:"#64748b",fontFamily:"inherit",cursor:"pointer"}}>ğŸ—‘</button></div>
{out&&<div style={{borderRadius:14,border:`2px solid ${ac}22`,padding:16,background:"linear-gradient(135deg,#eef2ff,#f5f3ff)"}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><span style={{fontSize:13,fontWeight:700,color:aD}}>{ct.name} è¦ç´„çµæœ</span><button onClick={()=>cp(out)} style={{padding:"4px 12px",borderRadius:10,border:`1px solid ${ac}44`,background:"#fff",fontSize:12,fontWeight:600,color:aD,fontFamily:"inherit",cursor:"pointer"}}>ğŸ“‹ ã‚³ãƒ”ãƒ¼</button></div>
<textarea value={out} onChange={e=>sOut(e.target.value)} style={{width:"100%",height:180,padding:12,borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",fontSize:14,color:"#1a1a1a",fontFamily:"inherit",resize:"vertical",lineHeight:1.7,boxSizing:"border-box"}}/></div>}
{ld&&<div style={{textAlign:"center",padding:20}}><div style={{width:32,height:32,border:"3px solid #e2e8f0",borderTop:`3px solid ${ac}`,borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 10px"}}/><span style={{color:"#64748b"}}>AIãŒè¦ç´„ã‚’ä½œæˆä¸­...</span></div>}
</div><style>{`@keyframes spin{to{transform:rotate(360deg)}}`}</style></div>);}
